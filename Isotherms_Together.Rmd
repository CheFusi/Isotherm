---
title: "All_Isotherms"
output: html_document
date: "2023-05-23"
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r, message=FALSE}


libs_1<-c("tidyverse","knitr","psych","reshape2","rmarkdown")

#data manipulation/exploration
libs_2<-c("readxl","readr","tidyr","GGally","naniar","readr")


# plotting
libs_3<-c("ggplot2","viridis","ggpubr","cowplot","gridExtra")

#ggpubr = package for publishing
#cowplot=  #to create compounded figures

#tables
libs_4<-c("dplyr","stargazer","xlsx","ggplot2","scales","extrafont","writexl")


#isothermFitting
#install.packages(PUPAIM)
library("PUPAIM")

#install.packages("devtools")



libs<-c(libs_1,libs_2,libs_3,libs_4)

lapply(libs,require, character.only=TRUE)
```

```{r}
AK<-readRDS("AK.RDS")
AK<-readRDS("AK.RDS")
AL<-readRDS("AL.RDS")
AM<-readRDS("AM.RDS")
AN<-readRDS("AN.RDS")
AO<-readRDS("AO.RDS")

AK_ALL<-readRDS("AK_ALL.rds")
AL_ALL<-readRDS("AL_ALL.rds")
AM_ALL<-readRDS("AM_ALL.rds")
AN_ALL<-readRDS("AN_ALL.rds")
AO_ALL<-readRDS("AO_ALL.rds")
int_ALL<-readRDS("int_ALL.rds")

#Renaming all the columns so I could rbind them later - they need to have the same name for this to be possible. 

new_column_names<-c("group","OX","ID",
                    "Sodium_moles_eq_avg", "Ammonium_moles_eq_avg","Potassium_moles_eq_avg", "Magnesium_moles_eq_avg",
                    "Acetate_moles_eq_avg","Chloride_moles_eq_avg","Phosphate_moles_eq_avg","Sulfate_moles_eq_avg","Carbonate_moles_eq_avg",
                    "pH","Ionic_str","NH4_Act","Na_Act","K_Act",
                    "Ammonium_moles_in_avg", "Magnesium_moles_in_avg","Potassium_moles_in_avg","Sodium_moles_in_avg",
                    "Ammonium_moles_in_sd","Magnesium_moles_in_sd","Potassium_moles_in_sd", "Sodium_moles_in_sd",
                    "Acetate_moles_in_avg","Carbonate_moles_in_avg", "Chloride_moles_in_avg","Phosphate_moles_in_avg","Sulfate_moles_in_avg",
                    "Acetate_moles_in_sd","Carbonate_moles_in_sd","Chloride_moles_in_sd","Phosphate_moles_in_sd","Sulfate_moles_in_sd",
                    "volume_avg","mass_biochar_avg",
                    "Sodium_moles_ctrl_avg","Ammonium_moles_ctrl_avg","Potassium_moles_ctrl_avg","Magnesium_moles_ctrl_avg",
                    "Sodium_moles_ctrl_sd" ,"Ammonium_moles_ctrl_sd","Potassium_moles_ctrl_sd","Magnesium_moles_ctrl_sd",
                    "Acetate_moles_ctrl_avg", "Chloride_moles_ctrl_avg", "Phosphate_moles_ctrl_avg","Sulfate_moles_ctrl_avg", "Carbonate_moles_ctrl_avg",
                    "Acetate_moles_ctrl_sd","Chloride_moles_ctrl_sd","Phosphate_moles_ctrl_sd", "Sulfate_moles_ctrl_sd", "Carbonate_moles_ctrl_sd",
                    "Na_Norm", "NH4_Norm", "K_Norm", "Mg_Norm",
                    "Ace_Norm", "Cl_Norm", "PO4_Norm","SO4_Norm", "Carb_Norm",
                    "Dose",
                    "Q_NH4_avg","Q_Na_avg","Q_K_avg","Q_Mg_avg", "Q_Cl_avg","Q_PO4_avg","Q_SO4_avg","Q_Ace_avg",
                    "Sodium_moles_eq_sd", "Ammonium_moles_eq_sd","Potassium_moles_eq_sd","Magnesium_moles_eq_sd",
                    "Acetate_moles_eq_sd","Chloride_moles_eq_sd","Phosphate_moles_eq_sd","Sulfate_moles_eq_sd","Carbonate_moles_eq_sd",
                    "pH_sd", "Ionic_str_sd","NH4_Act_sd", "Na_Act_sd", "K_Act_sd",
                    "Na_Norm_sd", "NH4_Norm_sd", "K_Norm_sd","Mg_Norm_sd",
                    "Ace_Norm_sd", "Cl_Norm_sd", "PO4_Norm_sd", "SO4_Norm_sd","Carb_Norm_sd",
                    "Q_NH4_sd", "Q_Na_sd","Q_K_sd","Q_Mg_sd", "Q_Cl_sd", "Q_PO4_sd", "Q_SO4_sd",
                    "Q_Ace_sd","Q_NH4_avg_sd_perc","Q_Na_avg_sd_perc","Q_K_avg_sd_perc", "Q_Mg_sd_perc",
                    "Q_Cl_sd_perc","Q_PO4_sd_perc","Q_S_sd_perc","Q_Ace_sd_perc")  
                    
                    #,"OC","Type")

names(AK_ALL)<-new_column_names
names(AL_ALL)<-new_column_names
names(AM_ALL)<-new_column_names
names(AN_ALL)<-new_column_names
names(AO_ALL)<-new_column_names

#updating int. iso column names 
#colnames(int_ALL)[colnames(int_ALL) == "ID"] <- "Sample_ID"
colnames(int_ALL)[colnames(int_ALL) == "Ox"] <- "OX"

old_column_names <- c("Act_NH4","Act_Na","Act_K", 
                      "Sodium", "Ammonium", "Potassium","Magnesium","Acetate",
                      "Chloride","Phosphate","Sulfate","Carbonate",
                      "NH4_std", "Mg_std","K_std", "Na_std",
                      "Ace_std","Carb_std","Cl_std","P_std","S_std",
                      "Q_S",
                       "Sodium_sd", "Ammonium_sd","Potassium_sd", "Magnesium_sd", "Acetate_sd", "Chloride_sd", "Phosphate_sd", "Sulfate_sd", "Carbonate_sd",
                      "Act_NH4_sd","Act_Na_sd","Act_K_sd",
                      "P_In","S_In",
                      "Na_ctrl_std","NH4_ctrl_std","K_ctrl_std","Mg_ctrl_std",
                      "P_ctrl", "S_ctrl",
                      "Ace_ctrl_std","Cl_ctrl_std", "P_ctrl_std", "S_ctrl_std", "Carb_ctrl_std",
                      "P_Norm", "S_Norm",
                      "K_Ace_Norm_sd", #typo - should just be Ace
                      "P_Norm_sd","S_Norm_sd",
                      "Q_S_sd"
                      )

new_column_names <- c("NH4_Act","Na_Act","K_Act",
                      #"Na_Conc", "NH4_Conc","K_Conc", "Mg_Conc",
                      "Sodium_moles_eq_avg", "Ammonium_moles_eq_avg","Potassium_moles_eq_avg", "Magnesium_moles_eq_avg",
                       #"Ace_Conc","Cl_Conc", "PO4_Conc", "SO4_Conc","Carb_Conc",
                      "Acetate_moles_eq_avg","Chloride_moles_eq_avg","Phosphate_moles_eq_avg","Sulfate_moles_eq_avg","Carbonate_moles_eq_avg",
                       #"NH4_In_sd","Mg_In_sd","K_In_sd","Na_In_sd",
                      "Ammonium_moles_in_sd","Magnesium_moles_in_sd","Potassium_moles_in_sd", "Sodium_moles_in_sd",
                       #"Ace_In_sd","Carb_In_sd","Cl_In_sd","PO4_In_sd","SO4_In_sd",
                      "Acetate_moles_in_sd","Carbonate_moles_in_sd","Chloride_moles_in_sd","Phosphate_moles_in_sd","Sulfate_moles_in_sd",
                       "Q_SO4_avg",
                       #"Na_Conc_sd","NH4_Conc_sd", "K_Conc_sd", "Mg_Conc_sd", "Ace_Conc_sd", "Cl_Conc_sd", "PO4_Conc_sd", "SO4_Conc_sd", "Carb_Conc_sd",
                      "Sodium_moles_eq_sd", "Ammonium_moles_eq_sd","Potassium_moles_eq_sd","Magnesium_moles_eq_sd",
                    "Acetate_moles_eq_sd","Chloride_moles_eq_sd","Phosphate_moles_eq_sd","Sulfate_moles_eq_sd","Carbonate_moles_eq_sd",
                      "NH4_Act_sd","Na_Act_sd","K_Act_sd",
                      #"PO4_In","S04_In",
                    "Phosphate_moles_in_avg","Sulfate_moles_in_avg",
                      #"Na_ctrl_sd", "NH4_ctrl_sd", "K_ctrl_sd", "Mg_ctrl_sd",
                    "Sodium_moles_ctrl_sd" ,"Ammonium_moles_ctrl_sd","Potassium_moles_ctrl_sd","Magnesium_moles_ctrl_sd",
                      #"PO4_ctrl", "SO4_ctrl",
                    "Phosphate_moles_ctrl_avg","Sulfate_moles_ctrl_avg",
                      #"Ace_ctrl_sd", "Cl_ctrl_sd", "PO4_ctrl_sd", "SO4_ctrl_sd", "Carb_ctrl_sd",
                    "Acetate_moles_ctrl_sd","Chloride_moles_ctrl_sd","Phosphate_moles_ctrl_sd", "Sulfate_moles_ctrl_sd", "Carbonate_moles_ctrl_sd",
                      "PO4_Norm", "SO4_Norm",
                      "Ace_Norm_sd",
                      "PO4_Norm_sd","SO4_Norm_sd",
                      "Q_SO4_sd"
                      )

# Change column names
colnames(int_ALL)[colnames(int_ALL) %in% old_column_names] <- new_column_names

  int_ALL <- int_ALL %>%
    rename(Ammonium_moles_in_avg = NH4_In,
           Magnesium_moles_in_avg = Mg_In,
           Potassium_moles_in_avg = K_In,
           Sodium_moles_in_avg = Na_In,
           Acetate_moles_in_avg = Ace_In,
           Carbonate_moles_in_avg = Carb_In,
           Chloride_moles_in_avg = Cl_In,
           Sodium_moles_ctrl_avg = Na_ctrl,
           Ammonium_moles_ctrl_avg = NH4_ctrl,
           Potassium_moles_ctrl_avg = K_ctrl,
           Magnesium_moles_ctrl_avg = Mg_ctrl,
           Acetate_moles_ctrl_avg = Ace_ctrl,
           Chloride_moles_ctrl_avg = Cl_ctrl,
           Carbonate_moles_ctrl_avg = Carb_ctrl,
           volume_avg = volume,
           mass_biochar_avg = mass_biochar,
           Q_NH4_avg = Q_NH4,
           Q_Na_avg = Q_Na,
           Q_K_avg = Q_K,
           Q_Mg_avg = Q_Mg,
           Q_Cl_avg = Q_Cl,
           Q_PO4_avg = Q_PO4,
           Q_Ace_avg = Q_Ace,
           #Q_NH4_avg_sd = Q_NH4_sd,
           #Q_Na_avg_sd = Q_Na_sd,
           #Q_K_avg_sd = Q_K_sd,
           #Q_Mg_avg_sd = Q_Mg_sd,
           #Q_Cl_avg_sd = Q_Cl_sd,
           #Q_PO4_avg_sd = Q_PO4_sd,
           #Q_Ace_avg_sd = Q_Ace_sd,
           #Q_SO4_avg_sd = Q_SO4_sd,
           Q_NH4_avg_sd_perc = Q_NH4_sd_perc,
           Q_Na_avg_sd_perc = Q_Na_sd_perc,
           Q_K_avg_sd_perc = Q_K_sd_perc
           )


#assigning H2O2 conc for int. data

int_ALL$OC <- c(05,10, 15, 20, 30, 30, 5, 10, 15, 20, 25, 30, 10, 12, 15, 20, 00)


#combining all the dataframes 
ALL_Biochars<-rbind(AK_ALL,AL_ALL,AM_ALL,AN_ALL,AO_ALL)
                    #,AM,AN,AO)


AK_O_C_EA<-(c(0.197,
0.234,
0.245,
0.272,
0.283,
0.302))


AK_O_C_EA_1<-rep(AK_O_C_EA,each=8)
Type_AK=rep("AK", each = 8*6)

AL_O_C_EA<-(c(0.167,
0.322,
0.493))
AL_O_C_EA_1<-rep(AL_O_C_EA,each=8)
Type_AL=rep("AL", each = 8*3)

AM_O_C_EA<-(c(0.133,
0.165,
0.184,
0.204,
0.205))
AM_O_C_EA_1<-rep(AM_O_C_EA,each=8)
Type_AM=rep("AM", each = 8*5)

AN_O_C_EA<-(0.138)
AN_O_C_EA_1<-rep(AN_O_C_EA,each=8)
Type_AN=rep("AN", each = 8)

#UPDATED O:C values with the reanalyzed values from June 2023
AO_O_C_EA<-(c(0.215,
0.200,
0.171,
0.245))
AO_O_C_EA_1<-rep(AO_O_C_EA,each=8)
Type_AO=rep("AO", each = 8*4)

EA_OC<-c(AK_O_C_EA_1, AL_O_C_EA_1, AM_O_C_EA_1, AN_O_C_EA_1, AO_O_C_EA_1)
Type <-c(Type_AK, Type_AL, Type_AM, Type_AN, Type_AO)

ALL_Biochars$OC<-EA_OC

#adding OC for int. iso
int_ALL$OC <- c(AM_O_C_EA,AN_O_C_EA,AK_O_C_EA,AO_O_C_EA,AL_O_C_EA[1]) ##int. iso doesn't have AL 05, or AL 10

# Adding in the Surface Area
#Note. values that are 100.0 are awaiting clarification 

SSA <- c(107.0, 100.0, 100.0, 100.0, 101.1, 90.1, 43.6, 41.5, 31.8, 119.0, 117.4, 119.8, 130.0, 167.1, 120.4, 99.2, 88.6, 83.9, 84.0)

SSA_rep=rep(SSA, each = 8)
ALL_Biochars$SSA <- SSA_rep
int_ALL$SSA <- c(119.0, 117.4, 119.8, 130.0, 167.1, #AM
                 120.4, #AN
                 107.0, 100.0, 100.0, 100.0, 101.1, 90.1, #AK
                 99.2, 88.6, 83.9, 84.0, #AO
                 43.6) #int. iso doesn't have AL 05, or AL 10 (SSA= 41.5, 31.8)

rep("AO", each = 8*4)

#Distinguishing Bichar Types
ALL_Biochars$Type<-Type
int_ALL$Type <- c(rep("AM", each = 5),
                      "AN",
                      rep("AK", each = 6),
                  rep("AO", each = 4),
                  "AL")

#Adding XPS O:C

AK_XPS_C<-c(80.93, 80.23,0, 79.41, 78.41, 76.10)
AK_XPS_O<-c(19.07,19.77,0, 20.59,21.59, 23.90 )
AK_XPS_O_C<-((AK_XPS_O/AK_XPS_C)*(12/16))
AK_XPS_O_C_1<-rep(AK_XPS_O_C,each=8)

AL_XPS_C<-c(63.49,56.03,46.22)
AL_XPS_O<-c(36.51,43.97,53.78)
AL_XPS_O_C<-((AL_XPS_O/AL_XPS_C)*(12/16))
AL_XPS_O_C_1<-rep(AL_XPS_O_C,each=8)

AM_XPS_C<-c(86.00, 82.48,79.99,84.16,82.72 )
AM_XPS_O<-c(14.00,17.52,20.01,15.84,17.28 )
AM_XPS_O_C<-((AM_XPS_O/AM_XPS_C)*(12/16))
AM_XPS_O_C_1<-rep(AM_XPS_O_C,each=8)

AN_XPS_C<-c(82.52)
AN_XPS_O<-c(17.48)
AN_XPS_O_C<-((AN_XPS_O/AN_XPS_C)*(12/16))
AN_XPS_O_C_1<-rep(AN_XPS_O_C,each=8)

AO_XPS_C<-c(81.50,72.77,77.55,79.83)
AO_XPS_O<-c(18.50,27.23,22.45,20.17)
AO_XPS_O_C<-((AO_XPS_O/AO_XPS_C)*(12/16))
AO_XPS_O_C_1<-rep(AO_XPS_O_C,each=8)

XPS_OC<-c(AK_XPS_O_C_1,AL_XPS_O_C_1,AM_XPS_O_C_1,AN_XPS_O_C_1,AO_XPS_O_C_1)
ALL_Biochars$XPS_OC<-XPS_OC

int_ALL$XPS_OC<-c(AM_XPS_O_C,AN_XPS_O_C,AK_XPS_O_C,AO_XPS_O_C,AO_XPS_O_C[1]) #only the first entry of AL since we only have AL00 samples for the int. iso data

#Adding in int. iso data 

# Reorder columns in int. iso dataframe to match the order of columns in ALL_Biochars
int_ALL <- int_ALL[, colnames(ALL_Biochars)]

# Row-bind the two data frames
ALL_Biochars <- rbind(ALL_Biochars, int_ALL)


#Normalizing to surface area
ALL_Biochars$Q_NH4_avg_SSA <- ALL_Biochars$Q_NH4_avg/ALL_Biochars$SSA

ALL_Biochars$Q_NH4_avg_SSA_sd <- ALL_Biochars$Q_NH4_avg_sd/ALL_Biochars$SSA

#Normalizing to OC
ALL_Biochars$Q_NH4_avg_OC <- ALL_Biochars$Q_NH4_avg/ALL_Biochars$OC


#updating 0 to 00 and 5 to 05
ALL_Biochars <- ALL_Biochars %>%
  mutate(OX = as.numeric(as.character(OX)),
         OX = case_when(
           OX < 10 ~ sprintf("%02d", OX),
           TRUE ~ as.character(OX)
         ))
ALL_Biochars$OX<- as.factor(ALL_Biochars$OX)

#creating Type_ox column that has type (AK) and ox conc (05)
ALL_Biochars <-transform(ALL_Biochars, Type_ox = paste0(Type, "_", OX))

#Remove the group column - no meaning
ALL_Biochars <- ALL_Biochars%>%
    select(-contains("group"))

# Loop through each column and replace NaN with NA
#ALL_Biochars <- apply(ALL_Biochars, 2, function(x) ifelse(is.nan(x), NA, x))


```

```{r}

#To ensure you've updated all the column names: 
  # Get the column names of df1 and df2
colnames_df1 <- colnames(int_ALL)
colnames_df2 <- colnames(ALL_Biochars)

# Find the column names that are unique to each dataframe
unique_to_df1 <- setdiff(colnames_df1, colnames_df2)
unique_to_df2 <- setdiff(colnames_df2, colnames_df1)

unique_to_df1

unique_to_df2
```

## Corrected for losses to headspace using control

```{r}

Q_function<-function(df,Q,C_In,C_eq,C_ctrl,volume,m_s) {
  Cin_Ceq<-((df[[C_In]]-df[[C_eq]])*df[[volume]])
  Cin_Cctrl<-((df[[C_In]]-df[[C_ctrl]])*df[[volume]])
  df[[Q]]<- (Cin_Ceq-Cin_Cctrl)/df[[m_s]]         
  #df[[Q]]<-((df[[C_In]]-df[[C_eq]])*df[[volume]]/df[[m_s]])
}

#same volume so mol/L and mol should work
ALL_Biochars$Q_Corr<-Q_function(ALL_Biochars,"Q_Corr","Ammonium_moles_in_avg","Ammonium_moles_eq_avg","Ammonium_moles_ctrl_avg","volume_avg","mass_biochar_avg")

#removal efficiency
ALL_Biochars$Rem_Eff <- ((ALL_Biochars$Ammonium_moles_in_avg - ALL_Biochars$Ammonium_moles_eq_avg)/ALL_Biochars$Ammonium_moles_in_avg)*100
```

## April 2024 Updates

updated column names to bind with new, dilution isotherms

Save

```{r}

saveRDS(ALL_Biochars, file = "ALL_Biochars.RDS")
```

```{r}
#removing AK 15 because it's erroneous 
# 
 ALL_Biochars<-ALL_Biochars%>%
   filter(Type!="AO" | OX!="15")
# 
ALL_Biochars<-ALL_Biochars%>%
  filter(Type!="AL")

ALL_Biochars<-ALL_Biochars%>%
  filter(Q_NH4_avg>0)

ALL_Biochars<-ALL_Biochars%>%
  filter(NH4_Act>0)


ALL_Biochars<-ALL_Biochars%>%
  filter(Q_Corr>0) 

#converting O:C into factor
#ALL_Biochars$OC<-as.factor(ALL_Biochars$OC)

```

## Calculating Q for Anions

```{r}
# 
# Q_function<-function(df,Q,C_In,C_eq,volume,m_s) {
#   df[[Q]]<-((df[[C_In]]-df[[C_eq]])*df[[volume]]/df[[m_s]])
#   }
# 
# ALL_Biochars$Q_Cl<-Q_function(ALL_Biochars,"Q_Cl","Cl_In","Cl_Conc","volume","mass_biochar")
# 
# ALL_Biochars$Q_PO4<-Q_function(ALL_Biochars,"Q_PO4","PO4_In","PO4_Conc","volume","mass_biochar")
# 
# ALL_Biochars$Q_S<-Q_function(ALL_Biochars,"Q_S","S_In","SO4_Conc","volume","mass_biochar")
# 
# ALL_Biochars$Q_Ace<-Q_function(ALL_Biochars,"Q_Ace","Ace_In","Ace_Conc","volume","mass_biochar")
```

```{r}
# 
# # Function to determine the dilution factor for a column
# calculate_dilution_factor <- function(column) {
#   # Filter out positive values
#   positive_values <- column[column > 0]
# 
#   min_pos <- min(positive_values)
#   max_pos <- max(positive_values)
#   
#   # Calculate the ratio of each positive value to 2 mg/L (/18)
#   max_ratio <- min_pos / (2/18)
#   min_ratio <- max_pos / (40/18)
# 
#   return(data.frame(max_ratio,min_ratio))
# }
# 
# # Calculate the dilution factor for each column
# dilution_factors <- sapply(Ceq_dataframe[, -1], calculate_dilution_factor)
# 
# # Display the dilution factors
# print(dilution_factors)
# 
# # Range is 0.11 and 2.22 mM (2 - 40 mg/L)


```

## Plotting

```{r}

#ALL_Biochars$Dose<-round(ALL_Biochars$Dose, 2)

#ALL_Biochars$Dose<-as.factor(ALL_Biochars$Dose)

Q_Conc_Plot<- ggplot(ALL_Biochars,aes(x=Ammonium_moles_eq_avg,y=Q_NH4_avg, color = OC,border= OC, fill=OC, shape=Dose, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
    #geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_avg_sd, ymax=Q_NH4_avg+Q_NH4_avg_sd))+
   # geom_errorbarh(aes(xmin=NH4_Conc-NH4_Conc_sd, xmax=NH4_Conc+NH4_Conc_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Concentration (mM)")+
  ylab("Q (mmol NH4/g biochar)")+
  #ggtitle()+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Q_Conc_Plot
```

```{r}

Q_Conc_Plot_2<- Q_Conc_Plot+
  scale_x_continuous(expand = c(0.0,0), limits = c(100,450))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.1,3))
Q_Conc_Plot_2

```

```{r}

Q_Act_Plot_3<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Q_NH4_avg, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mM)")+
  ylab("Q (mmol NH4/g biochar)")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Q_Act_Plot_3
```

```{r}
 Q_Act_Plot_3B<-Q_Act_Plot_3+
  scale_x_continuous(expand = c(0,0), limits = c(-0.1,365))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.5,20))
  Q_Act_Plot_3B
```

```{r}

Q_Act_Plot_3_zoomed<-
Q_Act_Plot_3 +
  coord_cartesian(xlim = c(75, 355), ylim = c(0,5))
Q_Act_Plot_3_zoomed
```

### Surface Area Normalized Q

```{r}


Q_Act_Plot_SSA<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Q_NH4_avg_SSA, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  geom_errorbar(aes(ymin=Q_NH4_avg_SSA-Q_NH4_avg_SSA_sd, ymax=Q_NH4_avg_SSA+Q_NH4_avg_SSA_sd))+
  geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mM)")+
  ylab("Q (mmol NH4/m2 biochar)")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Q_Act_Plot_SSA
```

```{r}

Q_Act_Plot_SSA_zoomed<-
Q_Act_Plot_SSA +
  coord_cartesian(xlim = c(75, 355), ylim = c(0,0.15))
Q_Act_Plot_SSA_zoomed
```

### OC Normalized Plot

```{r}

Q_Act_Plot_OC<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Q_NH4_avg_OC, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  #geom_errorbar(aes(ymin=Q_NH4_avg_SSA-Q_NH4_avg_SSA_sd, ymax=Q_NH4_avg_SSA+Q_NH4_avg_SSA_sd))+
  #geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mM)")+
  ylab("Q (mmol NH4/g biochar/ OC)")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Q_Act_Plot_OC
```

### Do Other cations 'inflect'?

```{r}


Q_Act_Plot_K<- ggplot(ALL_Biochars,aes(x=K_Act,y=Q_K_avg, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mM)")+
  ylab("Q (mmol ion/g biochar)")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") +
  scale_x_continuous(expand = c(0,0), limits = c(-0.1,50))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.5,1))
Q_Act_Plot_K
```

```{r}


Q_Act_Plot_Na<- ggplot(ALL_Biochars,aes(x=Na_Act,y=Q_Na_avg, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mM)")+
  ylab("Q (mmol ion/g biochar)")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.8, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none")+
  scale_x_continuous(expand = c(0,0), limits = c(50,200))+
  scale_y_continuous(expand = c(0,0), limits = c(-2,1))
Q_Act_Plot_Na
```

### Removal Efficiency

```{r}

Q_Conc_Plot<- ggplot(ALL_Biochars,aes(x= Dose,y= Rem_Eff, color=OC, border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
    #geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_avg_sd, ymax=Q_NH4_avg+Q_NH4_avg_sd))+
   # geom_errorbarh(aes(xmin=NH4_Conc-NH4_Conc_sd, xmax=NH4_Conc+NH4_Conc_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g/L)")+
  ylab("Removal Efficieny (%)")+
  #ggtitle()+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(1.2, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Q_Conc_Plot
```

## Subsetting

-   removing Q values greater or less that an arbitrary threshold

```{r}
ALL_Biochars_subset<-ALL_Biochars%>%
  filter(Q_NH4_avg+Q_NH4_sd<6)
         
         #,Q_NH4_avg-Q_NH4_avg_sd>=-0.5)



Q_Conc_Plot_subset <- ggplot(ALL_Biochars_subset, aes(x = NH4_Act, y = Q_NH4_avg, color = OC, fill = OC, na.rm = TRUE)) +
  geom_point(shape = 21, size = 6, stroke = 2, color = "black") +  # shape = 21 provides a circle with a border
  geom_errorbar(aes(ymin = Q_NH4_avg - Q_NH4_sd, ymax = Q_NH4_avg + Q_NH4_sd)) +
  geom_errorbarh(aes(xmin = NH4_Act - NH4_Act_sd, xmax = NH4_Act + NH4_Act_sd)) +
  xlab("Equilibrium Activity (mM)") +
  ylab("Q (mmol NH4/g biochar)") +
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
 

# Print the plot
print(Q_Conc_Plot_subset)


# Print the plot
print(Q_Conc_Plot_subset)



Q_Conc_Plot_subset

Q_Conc_Plot_subset<-
Q_Conc_Plot_subset +
  coord_cartesian(ylim = c(0,6.5))
Q_Conc_Plot_subset
 
```

```{r}
Q_Conc_Plot_3b<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Q_NH4_avg, color = XPS_OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+ 
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mM)")+
  ylab("Q (mmol NH4/g biochar")+
  #ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_3b
```

```{r}

Q_Act_Plot_4<- Q_Act_Plot_3+
  scale_x_continuous(expand = c(0.0,0), limits = c(50,370))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.2,5))
Q_Act_Plot_4
```

```{r}

Q_Conc_Plot_5<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4_avg, color = OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
  #ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_5

```

```{r}

Q_Conc_Plot_6<- Q_Conc_Plot_5+
  scale_x_continuous(expand = c(0.0,0), limits = c(-0.1,460))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.1,7.5))
Q_Conc_Plot_6
```

```{r}

ALL_Biochars$OC<-as.numeric(as.character(ALL_Biochars$OC))
```

```{r}
Q_Conc_Plot_7<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4_avg, color = OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
    # geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_7
```

```{r}
Q_Conc_Plot_7b<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4_avg, color = XPS_OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
    # geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_7b
```

```{r}
ALL_Biochars$Dose<-as.numeric(ALL_Biochars$Dose)

Q_Conc_Plot_9<- ggplot(ALL_Biochars,aes(x=OC,y=Q_NH4_avg,color=Ammonium_moles_eq_sd, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
    # geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  facet_wrap(facets = vars(Dose))+
  xlab("O:C")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")
Q_Conc_Plot_9
```

```{r}

ALL_Biochars$Dose<-as.factor(ALL_Biochars$Dose)

Q_Conc_Plot_8<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4_avg, color = OC, na.rm=TRUE)) +
  geom_boxplot()+
  geom_point()+
    # geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_8

```

## Plotting other Ion Species

Cations

```{r}

Norm_cation_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=NH4_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   geom_point(aes(y=Na_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
      #scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         #sec.axis = sec_axis(~.*coeff, name="pH"))
Norm_cation_plot
```

```{r}

Norm_NH4_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=NH4_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   #geom_point(aes(y=NH4_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")
  #scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))

Norm_NH4_plot
```

```{r}

Norm_Na_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=Na_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   #geom_point(aes(y=NH4_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")
  #scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))

Norm_Na_plot
```

```{r}


Norm_K_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=K_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   #geom_point(aes(y=NH4_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.5))

Norm_K_plot
```

Anions

Cl

```{r}
Norm_Cl_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=Cl_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
  # geom_point(aes(y=PO4_Norm,color = OC)) + 
  # geom_point(aes(y=S_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
    scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))

Norm_Cl_plot
```

```{r}
Norm_PO4_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=PO4_Norm, color = Ionic_str, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
  # geom_point(aes(y=PO4_Norm,color = OC)) + 
  # geom_point(aes(y=S_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))
      #scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         #sec.axis = sec_axis(~.*coeff, name="pH"))
Norm_PO4_plot
```

Sulfate

```{r}
Norm_S_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=SO4_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
  # geom_point(aes(y=PO4_Norm,color = OC)) + 
  # geom_point(aes(y=S_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
    scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))
Norm_S_plot
```

-   considering a stacked bar plot where main bar is amount of Na desorbed, and amount of NH4 and K sorbed are overlayed

### Attempting to Represent Uncertainty with Transleucency

since error bars don't work well with stacked plots

\*\* Rivisit the double pivot in a manner that ensures alignment

```{r}

Norm_<-
  ALL_Biochars%>%
  select(c("OC","Q_NH4_avg", "Q_Na_avg", "Q_K_avg","Q_Cl_avg","Q_PO4_avg","Q_SO4_avg","Q_Ace_avg", "Dose"))

Norm_sd<-
  ALL_Biochars%>%
  select(c("OC","Q_NH4_sd", "Q_Na_sd", "Q_K_sd","Q_Cl_sd", "Q_PO4_sd", "Q_SO4_sd", "Q_Ace_sd","Dose"))

#Attempting to Represent Uncertainty with Transleucency 

Norm_sd$normalized_NH4_sd <-1-( Norm_sd$Q_NH4_sd / max(Norm_sd$Q_NH4_sd))
Norm_sd$normalized_Na_sd <- 1-( Norm_sd$Q_Na_sd / max(Norm_sd$Q_Na_sd))
Norm_sd$normalized_K_sd <- 1-(Norm_sd$Q_K_sd / max(Norm_sd$Q_K_sd))

Norm_sd$normalized_Cl_sd <-1-( Norm_sd$Q_Cl_sd / max(Norm_sd$Q_Cl_sd))
Norm_sd$normalized_PO4_sd <- 1-( Norm_sd$Q_PO4_sd / max(Norm_sd$Q_PO4_sd))
Norm_sd$normalized_SO4_sd <- 1-(Norm_sd$Q_SO4_sd / max(Norm_sd$Q_SO4_sd))
Norm_sd$normalized_Ace_sd <- 1-(Norm_sd$Q_Ace_sd / max(Norm_sd$Q_Ace_sd))


Norm_long <-
  Norm_%>%
  pivot_longer(
    cols=c(Q_NH4_avg, Q_Na_avg, Q_K_avg, Q_Cl_avg, Q_PO4_avg, Q_SO4_avg, Q_Ace_avg),
    names_to ="Ion_species",
    values_to="Q",
    names_repair="minimal")

Norm_long_sd <- 
    Norm_sd%>%
  select(c("OC","normalized_NH4_sd", "normalized_Na_sd", "normalized_K_sd", "normalized_Cl_sd", "normalized_PO4_sd", "normalized_SO4_sd", "normalized_Ace_sd", "Dose")) %>%
  pivot_longer(
    cols=c(normalized_NH4_sd, normalized_Na_sd, normalized_K_sd, normalized_Cl_sd, normalized_PO4_sd, normalized_SO4_sd, normalized_Ace_sd),
    names_to ="Ion_Species_sd",
    values_to="Normalized_Q_sd",
    names_repair="minimal")

Ions_long <- cbind(Norm_long[,c(3:4)],Norm_long_sd)

```

```{r}

Cation_Q_plot<- ggplot(Ions_long, aes(x = Dose, y = Q, fill=Ion_species, na.rm=TRUE)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")

Cation_Q_plot
```

```{r}
Ions_long_low <-
  Ions_long %>%
  filter (OC<=0.184)  


Cation_Q_plot_low <- ggplot(Ions_long_low, aes(x = Dose, y = Q, fill = Ion_species)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Cation_Q_plot_low
```

```{r}

Ions_long_med <-
  Ions_long %>%
  filter (OC>0.184 & OC<= 0.205 )  

Cation_Q_plot_med <- ggplot(Ions_long_med, aes(x = Dose, y = Q, fill = Ion_species)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Cation_Q_plot_med
```

```{r}

Ions_long_high <-
  Ions_long %>%
  filter (OC>0.205) 

Cation_Q_plot_high <- ggplot(Ions_long_high, aes(x = Dose, y = Q, fill = Ion_species)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Cation_Q_plot_high
```

### Attempting to Include SD via Translucency in Plot

```{r}

Norm_sd_low <-
  Ions_long %>%
  filter (OC<=0.184)  


Norm_sd_low_plot <- ggplot(Norm_sd_low, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
   scale_fill_brewer(palette = "Dark2")
Norm_sd_low_plot
```

```{r}

Norm_sd_med <-
  Ions_long %>%
  filter (OC>0.184 & OC<= 0.205 )  

Norm_sd_med_plot <- ggplot(Norm_sd_med , aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
  # ggtitle("Q by Dose") + 
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Norm_sd_med_plot
```

```{r}

Norm_sd_high <-
  Ions_long %>%
  filter (OC> 0.205 )  

Norm_sd_high_plot <- ggplot(Norm_sd_high , aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") + 
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Norm_sd_high_plot
```

## Q for all Ions except NH4+

the ammonium Q in the above plot makes it difficult to see what is happening with the other ions, so let's look at those other ions without ammonium

```{r}

Q_no_NH4_low <-
  Ions_long %>%
  filter (Ion_species != "Q_NH4_avg",
          OC<=0.184) 

Q_all_plot_med <- ggplot(Q_no_NH4_low, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Q_all_plot_med

```

```{r}

Q_no_NH4_med <-
    Ions_long %>%
  filter (Ion_species != "Q_NH4_avg",
          OC>0.184 & OC<= 0.205 )  

Q_no_NH4_med_plot <- ggplot(Q_no_NH4_med, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
  # ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")

Q_no_NH4_med_plot 
```

```{r}

Q_no_NH4_high <-
  Ions_long %>%
  filter (Ion_species != "Q_NH4_avg",
          OC>0.205)  

Q_no_NH4_high_plot <- ggplot(Q_no_NH4_high, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Q_no_NH4_high_plot 

```

```{r}

```

## 

```{r}


Q_Conc_Plot_Q_Corr<- ggplot(ALL_Biochars, aes(x = NH4_Act, y = Q_Corr, color = OC, fill = OC, na.rm = TRUE)) +
  geom_point(shape = 21, size = 6, stroke = 2, color = "black") +  # shape = 21 provides a circle with a border
  #geom_errorbar(aes(ymin = Q_NH4_avg - Q_NH4_sd, ymax = Q_NH4_avg + Q_NH4_sd)) +
  #geom_errorbarh(aes(xmin = NH4_Act - NH4_Act_sd, xmax = NH4_Act + NH4_Act_sd)) +
  xlab("Equilibrium Activity (mmol/L)") +
  ylab("Q (mmol NH4/g biochar)") +
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 

Q_Conc_Plot_Q_Corr
```

```{r}

Q_Act_No_Err_Plot<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Q_NH4_avg, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  #geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  #geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar)")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Q_Act_No_Err_Plot

```

```{r}

Q_Act_No_Err_Plot_same_axis<-
Q_Act_No_Err_Plot +
  coord_cartesian(ylim = c(0,20))

Q_Conc_Plot_Q_Corr_same_axis<-
Q_Conc_Plot_Q_Corr +
  coord_cartesian(ylim = c(0,20))

w_wo_corr <- grid.arrange(Q_Act_No_Err_Plot_same_axis, Q_Conc_Plot_Q_Corr_same_axis, ncol = 2)
```

### Ionic Strength and pH

```{r}

Ionic_Strength_plot<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Ionic_str, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  #geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  #geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Ionic Strength (M))")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Ionic_Strength_plot
```

```{r}

pH_plot<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=pH, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  #geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  #geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("pH")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
pH_plot

pH_plot<-
pH_plot +
  coord_cartesian(ylim = c(7,9))
```

```{r}

pH_Dose_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=pH, color = OC,border= OC, fill=OC, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  #geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  #geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose")+
  ylab("pH")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.4),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) +
   scale_fill_gradient(low = "purple", high = "yellow")+
  scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
pH_Dose_plot

pH_Dose_plot<-
pH_Dose_plot +
  coord_cartesian(ylim = c(7,9))
pH_Dose_plot
```

```{r}


Q_Act_No_Err_Plot<- ggplot(ALL_Biochars,aes(x=OC,y=Q_NH4_avg, color = Type_ox,border= Type_ox, fill=Type_ox, na.rm=TRUE)) +
   geom_point(shape = 21, size = 6, stroke = 2, color = "black") +
  #geom_errorbar(aes(ymin=Q_NH4_avg-Q_NH4_sd, ymax=Q_NH4_avg+Q_NH4_sd))+
  #geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("OC")+
  ylab("Q (mmol NH4/g biochar)")+
  #ggtitle("Sorption Isotherm")+
  theme_classic(base_size = 28) +
  theme(
    text = element_text(family = "Times"),
    legend.position = c(0.1, 0.8),  # Adjust the legend position as needed
    axis.text.x = element_text(size = 24),
    axis.text.y = element_text(size = 24),
    axis.title.x = element_text(margin = margin(t = 20), size = 24),
    axis.title.y = element_text(margin = margin(r = 20), size = 24),
    panel.border = element_rect(color = "black", fill = NA, size = 3),
    legend.text = element_text(size = 20),
    legend.title = element_text(size = 24),
    legend.box.background = element_rect(color = "black", size = 1, linetype = "solid")
  ) #+
   #scale_fill_gradient(low = "purple", high = "yellow")+
  #scale_color_gradient(low = "purple", high = "yellow", guide = guide_legend())+
  guides(color = "none") 
Q_Act_No_Err_Plot

```

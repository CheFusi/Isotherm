---
title: "All_Isotherms"
output: html_document
date: "2023-05-23"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Libraries

```{r, message=FALSE}


libs_1<-c("tidyverse","knitr","psych","reshape2","rmarkdown")

#data manipulation/exploration
libs_2<-c("readxl","readr","tidyr","GGally","naniar","readr")


# plotting
libs_3<-c("ggplot2","viridis","ggpubr","cowplot")

#ggpubr = package for publishing
#cowplot=  #to create compounded figures

#tables
libs_4<-c("dplyr","stargazer","xlsx","ggplot2","scales","extrafont","writexl")


#isothermFitting
#install.packages(PUPAIM)
library("PUPAIM")

#install.packages("devtools")



libs<-c(libs_1,libs_2,libs_3,libs_4)

lapply(libs,require, character.only=TRUE)
```

```{r}

AK<-readRDS("AK.RDS")
AL<-readRDS("AL.RDS")
AM<-readRDS("AM.RDS")
AN<-readRDS("AN.RDS")
AO<-readRDS("AO.RDS")

AK_ALL<-readRDS("AK_ALL.rds")
AL_ALL<-readRDS("AL_ALL.rds")
AM_ALL<-readRDS("AM_ALL.rds")
AN_ALL<-readRDS("AN_ALL.rds")
AO_ALL<-readRDS("AO_ALL.rds")


#Renaming all the columns so I could rbind them later - they need to have the same name for this to be possible. 

new_column_names<-c("group","H2O2_conc","Sample_ID","Na_Conc", "NH4_Conc","K_Conc", "Mg_Conc","Ace_Conc","Cl_Conc","PO4_Conc","SO4_Conc","Carb_Conc","pH","Ionic_str","NH4_Act","Na_Act","K_Act", "Na_In", "NH4_In", "K_In","Mg_In","Ace_In", "Cl_In", "PO4_In", "S_In", "Carb_In", "volume","mass_biochar","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm", "Cl_Norm", "PO4_Norm","S_Norm", "Carb_Norm","Dose","Q_NH4","Q_Na","Q_K","Q_Mg", "Q_Cl","Q_PO4","Q_S","Q_Ace","Na_Conc_sd", "NH4_Conc_sd","K_Conc_sd","Mg_Conc_sd","Ace_Conc_sd", "Cl_Conc_sd", "PO4_Norm_sd","SO4_Norm_sd","Carb_Conc_sd","pH_sd", "Ionic_str_sd","NH4_Act_sd", "Na_Act_sd", "K_Act_sd","Na_Norm_sd", "NH4_Norm_sd", "K_Norm_sd","Mg_Norm_sd", "Ace_Norm_sd", "Cl_Norm_sd", "P_Norm_sd", "S_Norm_sd","Carb_Norm_sd", "Q_NH4_sd", "Q_Na_sd","Q_K_sd","Q_Mg_sd", "Q_Cl_sd", "Q_PO4_sd", "Q_S_sd", "Q_Ace_sd","Q_NH4_sd_perc","Q_Na_sd_perc","Q_K_sd_perc", "Q_Mg_sd_perc","Q_Cl_sd_perc","Q_PO4_sd_perc","Q_S_sd_perc","Q_Ace_sd_perc")  
                    
                    #,"OC","Type")

names(AK_ALL)<-new_column_names
names(AL_ALL)<-new_column_names
names(AM_ALL)<-new_column_names
names(AN_ALL)<-new_column_names
names(AO_ALL)<-new_column_names

#combining all the dataframes 
ALL_Biochars<-rbind(AK_ALL,AL_ALL,AM_ALL,AN_ALL,AO_ALL)
                    #,AM,AN,AO)


AK_O_C_EA<-(c(0.197,
0.234,
0.245,
0.272,
0.283,
0.302))


AK_O_C_EA<-rep(AK_O_C_EA,each=8)
Type_AK=rep("AK", each = 8*6)

AL_O_C_EA<-(c(0.167,
0.322,
0.493))
AL_O_C_EA<-rep(AL_O_C_EA,each=8)
Type_AL=rep("AL", each = 8*3)

AM_O_C_EA<-(c(0.133,
0.165,
0.184,
0.204,
0.205))
AM_O_C_EA<-rep(AM_O_C_EA,each=8)
Type_AM=rep("AM", each = 8*5)

AN_O_C_EA<-(0.138)
AN_O_C_EA<-rep(AN_O_C_EA,each=8)
Type_AN=rep("AN", each = 8)

#UPDATED O:C values with the reanalyzed values from June 2023
AO_O_C_EA<-(c(0.215,
0.200,
0.171,
0.245))
AO_O_C_EA<-rep(AO_O_C_EA,each=8)
Type_AO=rep("AO", each = 8*4)

EA_OC<-c(AK_O_C_EA, AL_O_C_EA, AM_O_C_EA, AN_O_C_EA, AO_O_C_EA)
Type <-c(Type_AK, Type_AL, Type_AM, Type_AN, Type_AO)

ALL_Biochars$OC<-EA_OC

#Distinguishing Bichar Types
ALL_Biochars$Type<-Type

#Adding XPS O:C

AK_XPS_C<-c(80.93, 80.23,0, 79.41, 78.41, 76.10)
AK_XPS_O<-c(19.07,19.77,0, 20.59,21.59, 23.90 )
AK_XPS_O_C<-((AK_XPS_O/AK_XPS_C)*(12/16))
AK_XPS_O_C<-rep(AK_XPS_O_C,each=8)

AL_XPS_C<-c(63.49,56.03,46.22)
AL_XPS_O<-c(36.51,43.97,53.78)
AL_XPS_O_C<-((AL_XPS_O/AL_XPS_C)*(12/16))
AL_XPS_O_C<-rep(AL_XPS_O_C,each=8)

AM_XPS_C<-c(86.00, 82.48,79.99,84.16,82.72 )
AM_XPS_O<-c(14.00,17.52,20.01,15.84,17.28 )
AM_XPS_O_C<-((AM_XPS_O/AM_XPS_C)*(12/16))
AM_XPS_O_C<-rep(AM_XPS_O_C,each=8)

AN_XPS_C<-c(82.52)
AN_XPS_O<-c(17.48)
AN_XPS_O_C<-((AN_XPS_O/AN_XPS_C)*(12/16))
AN_XPS_O_C<-rep(AN_XPS_O_C,each=8)

AO_XPS_C<-c(81.50,72.77,77.55,79.83)
AO_XPS_O<-c(18.50,27.23,22.45,20.17)
AO_XPS_O_C<-((AO_XPS_O/AO_XPS_C)*(12/16))
AO_XPS_O_C<-rep(AO_XPS_O_C,each=8)

XPS_OC<-c(AK_XPS_O_C,AL_XPS_O_C,AM_XPS_O_C,AN_XPS_O_C,AO_XPS_O_C)
ALL_Biochars$XPS_OC<-XPS_OC

```

```{r}
#removing AK 15 because it's erroneous 
# 
# ALL_Biochars<-ALL_Biochars%>%
#   filter(Type!="AO" | H2O2_conc!="15")
# 
# ALL_Biochars<-ALL_Biochars%>%
#   filter(Type!="AL")
# 
# ALL_Biochars<-ALL_Biochars%>%
#   filter(Q_NH4>0)
# 
# ALL_Biochars<-ALL_Biochars%>%
#   filter(NH4_Act>0)

#converting O:C into factor
#ALL_Biochars$OC<-as.factor(ALL_Biochars$OC)

```

## Calculating Q for Anions

```{r}
# 
# Q_function<-function(df,Q,C_In,C_eq,volume,m_s) {
#   df[[Q]]<-((df[[C_In]]-df[[C_eq]])*df[[volume]]/df[[m_s]])
#   }
# 
# ALL_Biochars$Q_Cl<-Q_function(ALL_Biochars,"Q_Cl","Cl_In","Cl_Conc","volume","mass_biochar")
# 
# ALL_Biochars$Q_PO4<-Q_function(ALL_Biochars,"Q_PO4","PO4_In","PO4_Conc","volume","mass_biochar")
# 
# ALL_Biochars$Q_S<-Q_function(ALL_Biochars,"Q_S","S_In","SO4_Conc","volume","mass_biochar")
# 
# ALL_Biochars$Q_Ace<-Q_function(ALL_Biochars,"Q_Ace","Ace_In","Ace_Conc","volume","mass_biochar")
```

## Plotting

```{r}

ALL_Biochars$Dose<-round(ALL_Biochars$Dose, 2)

#ALL_Biochars$Dose<-as.factor(ALL_Biochars$Dose)

Q_Conc_Plot<- ggplot(ALL_Biochars,aes(x=NH4_Conc,y=Q_NH4, color = OC, shape=Dose, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
    #geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
   # geom_errorbarh(aes(xmin=NH4_Conc-NH4_Conc_sd, xmax=NH4_Conc+NH4_Conc_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Concentration (mmol)")+
  ylab("Q (mmol NH4/g biochar)")+
  #ggtitle()+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "purple", high = "yellow")
Q_Conc_Plot
```

```{r}

Q_Conc_Plot_2<- Q_Conc_Plot+
  scale_x_continuous(expand = c(0.0,0), limits = c(100,450))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.1,3))
Q_Conc_Plot_2

```

```{r}

Q_Conc_Plot_3<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Q_NH4, color = OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar)")+
  #ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "purple", high = "yellow")
Q_Conc_Plot_3
```

```{r}
 Q_Conc_Plot_3B<-Q_Conc_Plot_3+
  scale_x_continuous(expand = c(0,0), limits = c(-0.1,365))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.5,20))
  Q_Conc_Plot_3B
```

```{r}

Q_Conc_Plot_3_zoomed<-
Q_Conc_Plot_3 +
  coord_cartesian(xlim = c(75, 365), ylim = c(0,5))
Q_Conc_Plot_3_zoomed
```

```{r}
Q_Conc_Plot_3b<- ggplot(ALL_Biochars,aes(x=NH4_Act,y=Q_NH4, color = XPS_OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=NH4_Act-NH4_Act_sd, xmax=NH4_Act+NH4_Act_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  #ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_3b
```

```{r}

Q_Conc_Plot_4<- Q_Conc_Plot_3+
  scale_x_continuous(expand = c(0.0,0), limits = c(50,350))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.1,4.5))
Q_Conc_Plot_4
```

```{r}

Q_Conc_Plot_5<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4, color = OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
  #ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_5

```

```{r}

Q_Conc_Plot_6<- Q_Conc_Plot_5+
  scale_x_continuous(expand = c(0.0,0), limits = c(-0.1,460))+
  scale_y_continuous(expand = c(0,0), limits = c(-0.1,7.5))
Q_Conc_Plot_6
```

```{r}

ALL_Biochars$OC<-as.numeric(as.character(ALL_Biochars$OC))
```

```{r}
Q_Conc_Plot_7<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4, color = OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
    # geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_7
```

```{r}
Q_Conc_Plot_7b<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4, color = XPS_OC, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
    # geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_7b
```

```{r}
ALL_Biochars$Dose<-as.numeric(ALL_Biochars$Dose)

Q_Conc_Plot_9<- ggplot(ALL_Biochars,aes(x=OC,y=Q_NH4,color=NH4_Conc, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
    # geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  facet_wrap(facets = vars(Dose))+
  xlab("O:C")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")
Q_Conc_Plot_9
```

```{r}

ALL_Biochars$Dose<-as.factor(ALL_Biochars$Dose)

Q_Conc_Plot_8<- ggplot(ALL_Biochars,aes(x=Dose,y=Q_NH4, color = OC, na.rm=TRUE)) +
  geom_boxplot()+
  geom_point()+
    # geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose (g biochar/L Urine)")+
  ylab("Q (mmol NH4/g biochar")+
 # ggtitle("Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "blue", high = "red")
Q_Conc_Plot_8

```

## Plotting other Ion Species

Cations

```{r}

Norm_cation_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=NH4_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   geom_point(aes(y=Na_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
      #scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         #sec.axis = sec_axis(~.*coeff, name="pH"))
Norm_cation_plot
```

```{r}

Norm_NH4_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=NH4_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   #geom_point(aes(y=NH4_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")
  #scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))

Norm_NH4_plot
```

```{r}

Norm_Na_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=Na_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   #geom_point(aes(y=NH4_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")
  #scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))

Norm_Na_plot
```

```{r}


Norm_K_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=K_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
   #geom_point(aes(y=NH4_Norm,color = OC)) + 
   #geom_point(aes(y=K_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.5))

Norm_K_plot
```

Anions

Cl

```{r}
Norm_Cl_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=Cl_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
  # geom_point(aes(y=PO4_Norm,color = OC)) + 
  # geom_point(aes(y=S_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
    scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))

Norm_Cl_plot
```

```{r}
Norm_PO4_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=PO4_Norm, color = Ionic_str, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
  # geom_point(aes(y=PO4_Norm,color = OC)) + 
  # geom_point(aes(y=S_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))
      #scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         #sec.axis = sec_axis(~.*coeff, name="pH"))
Norm_PO4_plot
```

Sulfate

```{r}
Norm_S_plot<- ggplot(ALL_Biochars,aes(x=Dose,y=S_Norm, color = OC, na.rm=TRUE)) +
   geom_point()+ #shape=16, size =4)+
  # geom_point(aes(y=PO4_Norm,color = OC)) + 
  # geom_point(aes(y=S_Norm, color = OC)) + 
  #facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
    scale_color_gradient(low = "green", high = "purple")+
  scale_y_continuous(expand = c(0,0), limits = c(0.70,1.45))
Norm_S_plot
```

-   considering a stacked bar plot where main bar is amount of Na desorbed, and amount of NH4 and K sorbed are overlayed

### Attempting to Represent Uncertainty with Transleucency

since error bars don't work well with stacked plots

\*\* Rivisit the double pivot in a manner that ensures alignment

```{r}

Norm_<-
  ALL_Biochars%>%
  select(c("OC","Q_NH4", "Q_Na", "Q_K","Q_Cl","Q_PO4","Q_S","Q_Ace", "Dose"))

Norm_sd<-
  ALL_Biochars%>%
  select(c("OC","Q_NH4_sd", "Q_Na_sd", "Q_K_sd","Q_Cl_sd", "Q_PO4_sd", "Q_S_sd", "Q_Ace_sd","Dose"))

#Attempting to Represent Uncertainty with Transleucency 

Norm_sd$normalized_NH4_sd <-1-( Norm_sd$Q_NH4_sd / max(Norm_sd$Q_NH4_sd))
Norm_sd$normalized_Na_sd <- 1-( Norm_sd$Q_Na_sd / max(Norm_sd$Q_Na_sd))
Norm_sd$normalized_K_sd <- 1-(Norm_sd$Q_K_sd / max(Norm_sd$Q_K_sd))

Norm_sd$normalized_Cl_sd <-1-( Norm_sd$Q_Cl_sd / max(Norm_sd$Q_Cl_sd))
Norm_sd$normalized_PO4_sd <- 1-( Norm_sd$Q_PO4_sd / max(Norm_sd$Q_PO4_sd))
Norm_sd$normalized_S_sd <- 1-(Norm_sd$Q_S_sd / max(Norm_sd$Q_S_sd))
Norm_sd$normalized_Ace_sd <- 1-(Norm_sd$Q_Ace_sd / max(Norm_sd$Q_Ace_sd))


Norm_long <-
  Norm_%>%
  pivot_longer(
    cols=c(Q_NH4, Q_Na, Q_K, Q_Cl, Q_PO4, Q_S, Q_Ace),
    names_to ="Ion_species",
    values_to="Q",
    names_repair="minimal")

Norm_long_sd <- 
    Norm_sd%>%
  select(c("OC","normalized_NH4_sd", "normalized_Na_sd", "normalized_K_sd", "normalized_Cl_sd", "normalized_PO4_sd", "normalized_S_sd", "normalized_Ace_sd", "Dose")) %>%
  pivot_longer(
    cols=c(normalized_NH4_sd, normalized_Na_sd, normalized_K_sd, normalized_Cl_sd, normalized_PO4_sd, normalized_S_sd, normalized_Ace_sd),
    names_to ="Ion_Species_sd",
    values_to="Normalized_Q_sd",
    names_repair="minimal")

Ions_long <- cbind(Norm_long[,c(3:4)],Norm_long_sd)

```

```{r}

Cation_Q_plot<- ggplot(Ions_long, aes(x = Dose, y = Q, fill=Ion_species, na.rm=TRUE)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")

Cation_Q_plot
```

```{r}
Ions_long_low <-
  Ions_long %>%
  filter (OC<=0.184)  


Cation_Q_plot_low <- ggplot(Ions_long_low, aes(x = Dose, y = Q, fill = Ion_species)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Cation_Q_plot_low
```

```{r}

Ions_long_med <-
  Ions_long %>%
  filter (OC>0.184 & OC<= 0.205 )  

Cation_Q_plot_med <- ggplot(Ions_long_med, aes(x = Dose, y = Q, fill = Ion_species)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Cation_Q_plot_med
```

```{r}

Ions_long_high <-
  Ions_long %>%
  filter (OC>0.205) 

Cation_Q_plot_high <- ggplot(Ions_long_high, aes(x = Dose, y = Q, fill = Ion_species)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Cation_Q_plot_high
```

### Attempting to Include SD via Translucency in Plot

```{r}

Norm_sd_low <-
  Ions_long %>%
  filter (OC<=0.184)  


Norm_sd_low_plot <- ggplot(Norm_sd_low, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
   scale_fill_brewer(palette = "Dark2")
Norm_sd_low_plot
```

```{r}

Norm_sd_med <-
  Ions_long %>%
  filter (OC>0.184 & OC<= 0.205 )  

Norm_sd_med_plot <- ggplot(Norm_sd_med , aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
  # ggtitle("Q by Dose") + 
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Norm_sd_med_plot
```

```{r}

Norm_sd_high <-
  Ions_long %>%
  filter (OC> 0.205 )  

Norm_sd_high_plot <- ggplot(Norm_sd_high , aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") + 
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Norm_sd_high_plot
```

## Q for all Ions except NH4+

the ammonium Q in the above plot makes it difficult to see what is happening with the other ions, so let's look at those other ions without ammonium

```{r}

Q_no_NH4_low <-
  Ions_long %>%
  filter (Ion_species != "Q_NH4",
          OC<=0.184) 

Q_all_plot_med <- ggplot(Q_no_NH4_low, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Q_all_plot_med

```

```{r}

Q_no_NH4_med <-
    Ions_long %>%
  filter (Ion_species != "Q_NH4",
          OC>0.184 & OC<= 0.205 )  

Q_no_NH4_med_plot <- ggplot(Q_no_NH4_med, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
  # ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")

Q_no_NH4_med_plot 
```

```{r}

Q_no_NH4_high <-
  Ions_long %>%
  filter (Ion_species != "Q_NH4",
          OC>0.205)  

Q_no_NH4_high_plot <- ggplot(Q_no_NH4_high, aes(x = Dose, y = Q, fill = Ion_species, alpha = Normalized_Q_sd)) +
   geom_bar(position = "stack", stat = "identity") +
   facet_wrap(facets = vars(OC)) +
   xlab("Dose (g biochar/L Urine)") +
   ylab("Q") +
   ggtitle("Q by Dose") +
   theme_classic(base_size = 18) +
   theme(text = element_text(family = "Times"),
         legend.position = 'bottom',
         axis.text.x = element_text(size = 16),
         axis.text.y = element_text(size = 16),
         axis.title.x = element_text(margin = margin(t = 20), size = 16),
         axis.title.y = element_text(margin = margin(r = 20), size = 16))+
     scale_fill_brewer(palette = "Dark2")
Q_no_NH4_high_plot 

```

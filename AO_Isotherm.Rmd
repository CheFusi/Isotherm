---
title: "AO_Isotherm"
output: html_document
date: "2022-10-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## AO Isotherm

Libraries

```{r chunksetup, include=FALSE, message=FALSE, warning = FALSE}


libs_1<-c("tidyverse","knitr","psych","reshape2","rmarkdown")

#data manipulation/exploration
libs_2<-c("readxl","readr","tidyr","GGally","naniar","readr")


# plotting
libs_3<-c("ggplot2","viridis","ggpubr","cowplot") 

#ggpubr = package for publishing
#cowplot=  #to create compounded figures

#tables
libs_4<-c("dplyr","stargazer","xlsx","ggplot2","scales","extrafont","writexl")


#isothermFitting
#install.packages(PUPAIM)
library("PUPAIM")

#install.packages("devtools")



libs<-c(libs_1,libs_2,libs_3,libs_4)

lapply(libs,require, character.only=TRUE)

cbbPalette <- c("#000000", "#E69F00", "#0072B2", "#009E73","#D55E00","#56B4E9", "#F0E442", "#CC79A7")

cbPalette_plus <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7","#FFDB6D", "#C4961A", "#F4EDCA", "#D16103", "#C3D7A4", "#52854C", "#4E84C4", "#293352")

#ggthemr('dust')
#ggthemr_reset()
```

Molecular weight calculations

```{r}
MW_NH3=14.007+(3*1.008)
MW_NH4=14.007+(4*1.008)
MW_N = 14.007
MW_H = 1.008
MW_P = 30.974
MW_S = 32.006
MW_Na= 22.9
MW_Mg= 24.305
MW_K=39.098
MW_Cl=35.45
MW_C=12.011
MW_S=32.06
MW_O=15.999
MW_SO4_T=MW_S+(4*MW_O)
MW_H2PO4_T=MW_P+(4*MW_O)+(2*MW_H) ## because the formula uses H2PO4 and in the acidified sample we expect this form
MW_Ac=(2*MW_C)+(3*MW_H)+(2*MW_O)
MW_H2CO3=(MW_C+(3*MW_O)+(2*MW_H))
```

Converting to mole

```{r}

moles<-data.frame(MW_Na, MW_NH4,MW_K,MW_Mg)
moles_An<-data.frame(MW_Ac, MW_Cl,MW_H2PO4_T, MW_SO4_T,MW_H2CO3)
```

Setting up mass of biochar and volume of urine dataframe

```{r}

volume<-rep(c(0.02,0.02,0.02,
                  0.02,0.02,0.02,
                  0.005, 0.005, 0.005,
                  0.005,0.005,0.005,
                  0.005,0.005,0.005,
                  0.0011,0.0011,0.0011,
                  0.0011,0.0011,0.0011,
                  0.0011,0.0011,0.0011),times=3)
volume<-data.frame(volume)

mass_biochar<-rep(c(0.1,0.1,0.1,
                          0.2,0.2,0.2,
                          0.1, 0.1, 0.1,
                          0.2,0.2,0.2,
                          0.35,0.35,0.35,
                          0.1,0.1,0.1,
                          0.2,0.2,0.2,
                          0.5,0.5,0.5),times=3)
mass_biochar<-data.frame(mass_biochar)
mass_biochar
                  
```

## Extracting Data from Excel Files

```{r}
#isothermFittinglibrary(PUPAIM)

#setwd("/Users/soliverfusi/OneDrive/Desktop/Fusi/Sorption/Final_Data")

path<-"Final_SorptionIsotherm_Data_AK_to_AO.xlsx"

FullSheet <- path%>%
  excel_sheets()%>% #extracts the sheet name of the file fed to the 'path' function
  set_names() %>%
  map(read_excel,path=path,na=c(common_na_strings,"n.a."))
```

Cations

```{r}


AO_10_12_15<- data.frame(rbind(FullSheet$"221012_AO_10"[c(7:30),], 
                          FullSheet$"221012_AO_12"[c(7:30),],
                          FullSheet$"221012_AO_15"[c(7:30),]))

#changing all the columns to numeric (noteably the Ox columns since I use "In" and "A"-"C",
#it registers as a character column
AO_10_12_15[] <- lapply(AO_10_12_15, function(x) as.numeric(as.character(x)))

AO_20<- data.frame(FullSheet$"220930_AO_20"[c(7:30),])
AO_20[] <- lapply(AO_20, function(x) as.numeric(as.character(x)))

```

Anions

```{r}

AO_10_12_15_An<- data.frame(rbind(FullSheet$"221012_AO_10_An"[c(7:30),],
                               FullSheet$"221012_AO_12_An"[c(7:30),],
                               FullSheet$"221012_AO_15_An"[c(7:30),]))
AO_10_12_15_An[] <- lapply(AO_10_12_15_An, function(x) as.numeric(as.character(x)))

AO_20_An<- data.frame(FullSheet$"221010_AO_20_An"[c(7:30),])
AO_20_An[] <- lapply(AO_20_An, function(x) as.numeric(as.character(x)))


```

Influents

```{r}
#Cations

AOIn_10_12_15<- data.frame(FullSheet$"221012_AO_10"[c(1:6),])
AOIn_20_30<- data.frame(FullSheet$"220930_AO_20"[c(1:6),])

#Anions
AOIn_10_12_15_An<- data.frame(FullSheet$"221012_AO_10_An"[c(1:6),])
AOIn_20_An<- data.frame(FullSheet$"221010_AO_20_An"[c(1:6),])

                    
```

Controls

```{r}

#Cations
AOctrl_10_12_15<- data.frame(FullSheet$"221012_AO_10"[c(31:39),])
AOctrl_20_30<- data.frame(FullSheet$"220930_AO_20"[c(31:39),])

#Anions
AOctrl_10_12_15_An<- data.frame(FullSheet$"221012_AO_10_An"[c(31:39),])
AOctrl_20_An<- data.frame(FullSheet$"221010_AO_20_An"[c(31:39),])

```

# Adjusting Dilution Errors - Dismissing data (assigning as NA's)

```{r}


#AOctrl_20_30[5,4:6]= c(NA,NA,NA)
#AOctrl_20_30[5,4:6]= c(NA,NA,NA)



#The ctrl a.1 is overly diluted, so I'm adjusting the error by tAOIng the average of the K concentration in all the other samples, and using it to normalize 

#Adjusting_factor_1<-(mean(AOctrl_20_30[c(2:4,5:9,6)])/AOctrl_20_30[1,6])
#AOctrl_20_30[1,3:6]<-AOctrl_20_30[1,4:6]*Adjusting_factor_1

#The ctrl B2 is underly diluted, so tAOIng the average of the other two values to create an adjustment 

#Adjusting_factor_2<-(mean(AOctrl_20_30[c(1:4,6:9),6])/AOctrl_20_30[5,6])
#AOctrl_20_30[5,3:6]<-AOctrl_20_30[5,4:6]*Adjusting_factor_2

```

pH

```{r}
AO_10_12_15_pH<- data.frame(rbind(FullSheet$"221012_AO_10_pH"[c(7:30),],
                               FullSheet$"221012_AO_12_pH"[c(7:30),],
                               FullSheet$"221012_AO_15_pH"[c(7:30),]))
AO_10_12_15_pH[] <- lapply(AO_10_12_15_pH, function(x) as.numeric(as.character(x)))

AO_20_pH<- data.frame(FullSheet$"221013_AO_20_pH"[c(7:30),])
AO_20_pH[] <- lapply(AO_20_pH, function(x) as.numeric(as.character(x)))
```

```{r}

#nAOIng columns so they can be referenced easily later
## CATIONS
colnames(AO_10_12_15)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
colnames(AO_20)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
#----------------------------------------------------------------------
##ANIONS
colnames(AO_10_12_15_An)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))

colnames(AO_20_An)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))
#----------------------------------------------------------------------
## IN
colnames(AOIn_10_12_15)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

colnames(AOIn_20_30)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
#----------------------------------------------------------------------
##pH 
colnames(AO_10_12_15_pH)<-as.character(c('Ox','ID','Rep','pH'))
colnames(AO_20_pH)<-as.character(c('Ox','ID','Rep','pH'))
#-------------------------------------------------------------------------------
```

## Converting to moles

```{r}
#converting to moles 

#influent Cations

AO_10_In_mol<-mapply('/', AOIn_10_12_15[,4:7],moles)
AO_10_In_mol<-data.frame(cbind(AOIn_10_12_15[,1:3],AO_10_In_mol))
colnames(AO_10_In_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

#----------------------------------------------------------------------
AO_20_In_mol<-mapply('/', AOIn_20_30[,4:7],moles)
AO_20_In_mol<-data.frame(cbind(AOIn_20_30[,1:3],AO_20_In_mol))
colnames(AO_20_In_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
AO_20_In_mol

#----------------------------------------------------------------------
# Main 8 Cations 

AO_10_mol<-mapply('/', AO_10_12_15[,4:7],moles)

AO_10_mol<-data.frame(cbind(AO_10_12_15[,1:3],AO_10_mol))
colnames(AO_10_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
AO_10_mol

#----------------------------------------------------------------------
AO_20_mol<-mapply('/', AO_20[,4:7],moles)

AO_20_mol<-data.frame(cbind(AO_20[,1:3],AO_20_mol))
colnames(AO_20_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
AO_20_mol
#----------------------------------------------------------------------

#influent Anions

AO_10_An_In_mol<-mapply('/', AOIn_10_12_15_An[,4:8],moles_An)
AO_10_An_In_mol<-data.frame(cbind(AOIn_10_12_15_An[,1:3],AO_10_An_In_mol))
colnames(AO_10_An_In_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))
#----------------------------------------------------------------------
AO_20_An_In_mol<-mapply('/', AOIn_20_An[,4:8],moles_An)
AO_20_An_In_mol<-data.frame(cbind(AOIn_20_An[,1:3],AO_20_An_In_mol))
colnames(AO_20_An_In_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))

#----------------------------------------------------------------------

# Main 8 Anions

AO_10_An_mol<-mapply('/', AO_10_12_15_An[,4:8],moles_An)

AO_10_An_mol<-data.frame(cbind(AO_10_12_15_An[,1:3],AO_10_An_mol))
colnames(AO_10_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))
AO_10_An_mol

#----------------------------------------------------------------------

AO_20_An_mol<-mapply('/', AO_20_An[,4:8],moles_An)

AO_20_An_mol<-data.frame(cbind(AO_20_An[,1:3],AO_20_An_mol))
colnames(AO_20_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))
AO_20_An_mol

#Ctrls Cations

AO_ctrl_10_mol<-mapply('/', AOctrl_10_12_15[,4:7],moles)
AO_ctrl_10_mol<-data.frame(cbind(AOctrl_10_12_15[,1:3],AO_ctrl_10_mol))
colnames(AO_ctrl_10_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

AO_ctrl_20_mol<-mapply('/', AOctrl_20_30[,4:7],moles)
AO_ctrl_20_mol<-data.frame(cbind(AOctrl_20_30[,1:3],AO_ctrl_20_mol))
colnames(AO_ctrl_20_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

#Ctrl Anions 

AO_ctrl_10_An_mol<-mapply('/', AOctrl_10_12_15_An[,4:8],moles_An)
AO_ctrl_10_An_mol<-data.frame(cbind(AOctrl_10_12_15_An[,1:3],AO_ctrl_10_An_mol))
colnames(AO_ctrl_10_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))

AO_ctrl_20_An_mol<-mapply('/', AOctrl_20_An[,4:8],moles_An)
AO_ctrl_20_An_mol<-data.frame(cbind(AOctrl_20_An[,1:3],AO_ctrl_20_An_mol))
colnames(AO_ctrl_20_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))

```

## Combining Influent 6 with Control 3 for each reactor size, and Taking the means

Combining Ctrl's and Influent

```{r}

#taking the mean of the 6 influent samples

#Cations

AO_10_In_avg<-data.frame(lapply(AO_10_In_mol[,4:7], mean))
AO_20_In_avg<-data.frame(lapply(AO_20_In_mol[,4:7], mean))

#Anions
AO_10_In_An_avg<-data.frame(lapply(AO_10_An_In_mol[,4:8], mean))
AO_20_In_An_avg<-data.frame(lapply(AO_20_An_In_mol[,4:8], mean))

#taking the mean of A, B, and C

#Cations
AO_10_Ctrl_Avg<-data.frame( AO_ctrl_10_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium",'Magnesium'),mean,na.rm=TRUE))
AO_10_Ctrl_Avg

AO_20_Ctrl_Avg<-data.frame(AO_ctrl_20_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium",'Magnesium'),mean,na.rm=TRUE))
AO_20_Ctrl_Avg

#Anions
AO_10_An_Ctrl_Avg<-data.frame(AO_ctrl_10_An_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c('Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'),mean,na.rm=TRUE))
AO_10_An_Ctrl_Avg

AO_20_An_Ctrl_Avg<-data.frame(AO_ctrl_20_An_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c('Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'),mean,na.rm=TRUE))
AO_20_An_Ctrl_Avg


#Cations 

#Combining the average of the In and each Ctrl (A,B,or C) and then taking the mean

#A

AO_10_In_ABC_A<-rbind(AO_10_In_avg[1,],AO_10_Ctrl_Avg[1,2:5])
AO_10_In_A<-t(data.frame(colMeans(AO_10_In_ABC_A, na.rm=TRUE)))

AO_20_In_ABC_A<-rbind(AO_20_In_avg[1,],AO_20_Ctrl_Avg[1,2:5])
AO_20_In_A<-t(data.frame(colMeans(AO_20_In_ABC_A, na.rm=TRUE)))

#B
AO_10_In_ABC_B<-rbind(AO_10_In_avg[1,],AO_10_Ctrl_Avg[2,2:5])
AO_10_In_B<-t(data.frame(colMeans(AO_10_In_ABC_B, na.rm=TRUE)))

AO_20_In_ABC_B<-rbind(AO_20_In_avg[1,],AO_20_Ctrl_Avg[2,2:5])
AO_20_In_B<-t(data.frame(colMeans(AO_20_In_ABC_B, na.rm=TRUE)))

#C
AO_10_In_ABC_C<-rbind(AO_10_In_avg[1,],AO_10_Ctrl_Avg[3,2:5])
AO_10_In_C<-t(data.frame(colMeans(AO_10_In_ABC_C, na.rm=TRUE)))

AO_20_In_ABC_C<-rbind(AO_20_In_avg[1,],AO_20_Ctrl_Avg[3,2:5])
AO_20_In_C<-t(data.frame(colMeans(AO_20_In_ABC_C, na.rm=TRUE)))

#Anions 

#A
AO_10_An_In_ABC_A<-rbind(AO_10_In_An_avg[,],AO_10_An_Ctrl_Avg[1,2:6])
AO_10_An_In_A<-t(data.frame(colMeans(AO_10_An_In_ABC_A, na.rm=TRUE)))

AO_20_An_In_ABC_A<-rbind(AO_20_In_An_avg[,],AO_20_An_Ctrl_Avg[1,2:6])
AO_20_An_In_A<-t(data.frame(colMeans(AO_20_An_In_ABC_A, na.rm=TRUE)))

#B
AO_10_An_In_ABC_B<-rbind(AO_10_In_An_avg[,],AO_10_An_Ctrl_Avg[2,2:6])
AO_10_An_In_B<-t(data.frame(colMeans(AO_10_An_In_ABC_B, na.rm=TRUE)))

AO_20_An_In_ABC_B<-rbind(AO_20_In_An_avg[,],AO_20_An_Ctrl_Avg[2,2:6])
AO_20_An_In_B<-t(data.frame(colMeans(AO_20_An_In_ABC_B, na.rm=TRUE)))

#C
AO_10_An_In_ABC_C<-rbind(AO_10_In_An_avg[,],AO_10_An_Ctrl_Avg[3,2:6])
AO_10_An_In_C<-t(data.frame(colMeans(AO_10_An_In_ABC_C, na.rm=TRUE)))

AO_20_An_In_ABC_C<-rbind(AO_20_In_An_avg[,],AO_20_An_Ctrl_Avg[3,2:6])
AO_20_An_In_C<-t(data.frame(colMeans(AO_20_An_In_ABC_C, na.rm=TRUE)))

#Creating a dataframe with the new 'In' value, which is the average of the In and the ctrls

#Cations
AO_10_In_ABC<-data.frame(rbind(AO_10_In_A,AO_10_In_B,AO_10_In_C))
AO_20_In_ABC<-data.frame(rbind(AO_20_In_A,AO_20_In_B,AO_20_In_C))

row.names(AO_10_In_ABC)<-c("A","B","C")
row.names(AO_20_In_ABC)<-c("A","B","C")

#Anions
AO_10_An_In_ABC<-data.frame(rbind(AO_10_An_In_A,AO_10_An_In_B,AO_10_An_In_C))
AO_20_An_In_ABC<-data.frame(rbind(AO_20_An_In_A,AO_20_An_In_B,AO_20_An_In_C))

row.names(AO_10_An_In_ABC)<-c("A","B","C")
row.names(AO_20_An_In_ABC)<-c("A","B","C")


```

## Influent (6) Statistics in moles

```{r}
#-------------------------------------------------------------------------------
#pivoting 5/10/15% influent samples to long format for easier manipulation
AOIn10Long<-
  AO_10_In_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium,Magnesium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AO10Stats <- AOIn10Long %>%
  group_by(Cation_Species) %>%
  summarise(AO10In_mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AO10In_std=sd(Concentration, na.rm=FALSE),
            AO_perc_std=AO10In_std/ AO10In_mean*100)
AO10Stats<-data.frame(AO10Stats)
#-------------------------------------------------------------------------------
#pivoting 20/25/30% influent samples to long format for easier manipulation
AOIn20Long<-
  AO_20_In_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium,Magnesium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

AOIn20_Stats <-data.frame( AOIn20Long %>%
  group_by(Cation_Species) %>%
  summarise(AOIn20_Mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AOIn20_Std=sd(Concentration, na.rm=FALSE)))
AOIn20_Stats$Percent<-mapply('/', AOIn20_Stats$AOIn20_Std,AOIn20_Stats$AOIn20_Mean)


#calculating the mean and stdev to make sure that variability is acceptable (<5% for Na and K)
AO20Stats <- data.frame(AOIn20Long %>%
  group_by(Cation_Species) %>%
  summarise(AO20In_mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AO20In_std=sd(Concentration, na.rm=FALSE),
            AO_perc_std=AO20In_std/ AO20In_mean*100))
#or can also do
#AOIn20_Stats$Percent<-mapply('/', AOIn20_Stats$AOIn20_Std,AOIn20_Stats$AOIn20_Mean)
AO10Stats
AO20Stats
```

## Control Statistics

```{r}



#pivoting
AOctrl10Long<-
  AO_ctrl_10_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AO10ctrlStats <- AOctrl10Long %>%
  group_by(Cation_Species) %>%
  summarise(AO10ctrl_mean=mean(Concentration,na.rm=TRUE),
            #.groups='rowwise',
            AO10ctrl_std=sd(Concentration, na.rm=TRUE),
            AO_perc_std=AO10ctrl_std/ AO10ctrl_mean*100)
AO10ctrlStats<-data.frame(AO10ctrlStats)


#pivoting
AOctrl20Long<-
  AO_ctrl_20_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AO20ctrlStats <- AOctrl20Long %>%
  group_by(Cation_Species) %>%
  summarise(AO20ctrl_mean=mean(Concentration,na.rm=TRUE),
            #.groups='rowwise',
            AO20ctrl_std=sd(Concentration, na.rm=TRUE),
            AO_perc_std=AO20ctrl_std/ AO20ctrl_mean*100)
AO20ctrlStats<-data.frame(AO20ctrlStats)

```

## Combining All concentration triplicates into One Large Data Frame

##Combining Anions and Cations into One Dataframe for PHREEQC

-   all the molar concentration of the ions, in triplicate, combined into one dataframe

-   saving the dataframe as an excel file that can be imported into PHREEQC to calculate equilibrium activity.

```{r}
#Combining cations and anions into one dataframe for convenient activity calculations

#----------------------------------------------------------------------
Phreeqc_num<-data.frame(seq(1,nrow(AO_10_mol)))
colnames(Phreeqc_num)<-("Number")

AO_10_Ion_All <- data.frame(rbind(AO_10_mol[,]),
                           AO_10_An_mol[,-c(1:3)],
                           AO_10_12_15_pH[,4])
AO_10_Ion_All<-data.frame(cbind(Phreeqc_num[,],AO_10_Ion_All))
colnames(AO_10_Ion_All)<-as.character(c("PHREEQC_number",'Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate', "pH"))


AO_10_12_15_for_PHREEQC<-data.frame(AO_10_Ion_All[,c(1,5:14)])

colnames(AO_10_12_15_for_PHREEQC)=c("Number",'Na','N(-3)','K','Mg','Acetate','Cl','P', 'S(6)', 'C(4)', "pH")

write.table(AO_10_12_15_for_PHREEQC,"/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Final_Data/Activities/AO_10_12_15_for_PHREEQC_2.txt", sep = "\t",
            row.names = FALSE, col.names = FALSE)



#write_xlsx (AO_10_Ion_All,"/Users/soliverfusi/OneDrive/Desktop/Fusi/Sorption/Final_Data/Activities/AO_10_12_15_for_PHREEQC.xlsx")

#----------------------------------------------------------------------
# 
AO_20_Ion_All <- data.frame(rbind(AO_20_mol[,]),
                            AO_20_An_mol[,-c(1:3)],
                            AO_20_pH[,4])
AO_20_Ion_All<-data.frame(cbind(Phreeqc_num[c(1:24),],AO_20_Ion_All))
colnames(AO_20_Ion_All)<-as.character(c("PHREEQC_number",'Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate', "pH"))
# 
##editing to try to fit the exact PHREEQC format to minimize manual editing
# colnames(AO_20_Ion_All)<-as.character(c("PHREEQC_number",'Ox','ID','Rep','Sodium','Ammonium','Potassium','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate', "pH"))
# 
# write_xlsx (AO_20_Ion_All,"/Users/soliverfusi/OneDrive/Desktop/Fusi/Sorption/Final_Data/Activities/AO_20_for_PHREEQC.xlsx")


AO_20_for_PHREEQC<-data.frame(AO_20_Ion_All[,c(1,5:14)])
colnames(AO_20_for_PHREEQC)<-c("Number",'Na','N(-3)','K','Mg','Acetate','Cl','P', 'S(6)', 'C(4)', "pH")

write.table(AO_20_for_PHREEQC,"/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Final_Data/Activities/AO_20_for_PHREEQC.txt", sep = "\t",
            row.names = FALSE, col.names = FALSE)




```

##PHREEQC

-- Copy over the data in the text file into the template labled 'AX_TEMPLATE_Activities.txt' and rename the file. Easiest to open the template in R and save as a new .txt file.

-   Note that the r output file e.g. "AO_20_for_PHREEQC.txt" is different from the PHREEQC input file "AO_20_Activities.txt". Make sure to update the later with the information in the former

-OR Add the followiing to the top of the .txt file that is created

TITLE Activity of AO_10_12_15

SOLUTION_SPREAD

```         
-units mmol/L
```

Number Na N(-3) K Mg Acetate Cl P S(6) C(4) pH

```         
                                charge
```

-- Add the followiing to the bottom of the .txt file that is created

NOTE: Make sure to update the file name

SELECTED_OUTPUT #read more: <https://water.usgs.gov/water-resources/software/PHREEQC/documentation/phreeqc3-html/phreeqc3-45.htm#50593793_20239>

```         
Save SOLUTION 1-72

#CALCULATE_VALUES
#
#
#   thefunction(NH4+)
#   -start
#   10  thefunction = -9999.999
#   20  thefunction = ACT("NH4+")   
#   30  SAVE thefunction 
#   -end
#


SELECTED_OUTPUT
#read more: https://water.usgs.gov/water-resources/software/PHREEQC/documentation/phreeqc3-html/phreeqc3-45.htm#50593793_20239 




    -file AK_10_12_15_Activity.out
  -simulation  false
  -state  false
  -solution  false
  -distance  false
  -time  false
  -step  false
  -pe  false
  -pH  false
  -alkalinity  false
  -ionic_strength   
  -activities  Na+  NH4+  K+
  #--activities  Na+  NH4+  K+  Acetate-  Cl-  HPO4-2  SO4-2  HCO3-  pH
  #-calculate_values  ("thefunction") #read more: https://water.usgs.gov/water-resources/software/PHREEQC/documentation/phreeqc3-html/phreeqc3-7.htm#50593793_35035

END
```

END

NOTE: The output file will default to save in the same folder as the PHREEQC application\

-   Copy the outputs, which will be ionic strength and log ALK into the ALK tab in the main excel sheet

## Activities

AO_5_10_15_Act_Ion_str\<- data.frame(rbind(FullSheet\$"AO_05_Act"[c(1:24),c(4:7)],

FullSheet\$"AO_10_Act"[c(1:24),c(4:7)],

FullSheet\$"AO_15_Act"[c(1:24),c(4:7)]))

```{r}

AO_10_12_15_Act_Ion_str<- data.frame(rbind(FullSheet$"AO_10_Act"[c(1:24),c(4:7)],
                                   FullSheet$"AO_12_Act"[c(1:24),c(4:7)],
                                   FullSheet$"AO_15_Act"[c(1:24),c(4:7)]))

#Converting log act to act
AO_10_12_15_Act_Ion_str[,c(2:4)]<-1000*(10^(AO_10_12_15_Act_Ion_str[,c(2:4)]))
colnames(AO_10_12_15_Act_Ion_str)<-as.character(c("Ionic_str","Act_NH4","Act_Na","Act_K"))

AO_10_All<-data.frame(cbind(AO_10_Ion_All,AO_10_12_15_Act_Ion_str))


AO_20_Act_Ion_str<- data.frame(rbind(FullSheet$"AO_20_Act"[c(1:24),c(4:7)]))
AO_20_Act_Ion_str[,c(2:4)]<-1000*(10^(AO_20_Act_Ion_str[,c(2:4)]))
colnames(AO_20_Act_Ion_str)<-as.character(c("Ionic_str","Act_NH4","Act_Na","Act_K"))

AO_20_All<-data.frame(cbind(AO_20_Ion_All,AO_20_Act_Ion_str))
```

## Assigning the Influent as the average on the controls and the initial influent

Creating a dataframe of just the influents

```{r}

#creating the in columns, considering 2 reps of C, 3 of B, 3 of A (in this order), and how each is in triplicate

#Cations

AO_10_Cat_In<-data.frame(rbind(data.frame(lapply(AO_10_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AO_10_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AO_10_In_ABC[1,],rep,times=9))))

AO_10_Cat_In<-data.frame(lapply(AO_10_Cat_In,rep, times=3))
colnames(AO_10_Cat_In)<-c("AO_Na_In","AO_NH4_In","AO_K_In","AO_Mg_In")
#-------------------------------------------------------------------------------
AO_20_Cat_In<-data.frame(rbind(data.frame(lapply(AO_20_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AO_20_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AO_20_In_ABC[1,],rep,times=9))))

AO_20_Cat_In<-data.frame(lapply(AO_20_Cat_In,rep, times=1))
colnames(AO_20_Cat_In)<-c("AO_Na_In","AO_NH4_In","AO_K_In","AO_Mg_In")
#-------------------------------------------------------------------------------


AO_10_An_In<-data.frame(rbind(data.frame(lapply(AO_10_An_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AO_10_An_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AO_10_An_In_ABC[1,],rep,times=9))))

AO_10_An_In<-data.frame(lapply(AO_10_An_In,rep, times=3))
colnames(AO_10_An_In)<-c("AO_Ace_In","AO_Cl_In","AO_P_In","AO_S_In","AO_Carb_In")

#-------------------------------------------------------------------------------
AO_20_An_In<-data.frame(rbind(data.frame(lapply(AO_20_An_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AO_20_An_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AO_20_An_In_ABC[1,],rep,times=9))))

AO_20_An_In<-data.frame(lapply(AO_20_An_In,rep, times=1))
colnames(AO_20_An_In)<-c("AO_Ace_In","AO_Cl_In","AO_P_In","AO_S_In","AO_Carb_In")
#-------------------------------------------------------------------------------

```

## Nov 2023 Edits

-   In is just in, not avg of in and ctrl - started to fix this but ended up still using the avg value

-   #overide definition of In

```{r}

#Cations

AO_10_Cat_In <- AO10Stats[,c(1:3)] %>%
  pivot_wider(names_from = Cation_Species, values_from = c(AO10In_mean, AO10In_std))

AO_10_Cat_In<-data.frame(data.frame(lapply(AO_10_Cat_In,rep,times=24)))

colnames(AO_10_Cat_In)<-c("AO_NH4_In","AO_Mg_In","AO_K_In","AO_Na_In","AO_NH4_std","AO_Mg_std","AO_K_std","AO_Na_std")

AO_20_Cat_In <- AO20Stats[,c(1:3)] %>%
  pivot_wider(names_from = Cation_Species, values_from = c(AO20In_mean, AO20In_std))

AO_20_Cat_In<-data.frame(data.frame(lapply(AO_20_Cat_In,rep,times=24)))

colnames(AO_20_Cat_In)<-c("AO_NH4_In","AO_Mg_In","AO_K_In","AO_Na_In","AO_NH4_std","AO_Mg_std","AO_K_std","AO_Na_std")

#------------------------------------------------------------------------------------------
#Anions - need to first pivot and get stats (only previously did for cations)

AOAnIn10Long<-
  AO_10_An_In_mol%>%
  pivot_longer(
    cols=c(Acetate,Chloride,Phosphate,Sulfate,Carbonate),
    names_to ="Anion_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AOAn10Stats <- AOAnIn10Long %>%
  group_by(Anion_Species) %>%
  summarise(AO10AnIn_mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AO10AnIn_std=sd(Concentration, na.rm=FALSE))
AOAn10Stats<-data.frame(AOAn10Stats)
#-------------------------------------------------------------------------------
AOAnIn20Long<-
  AO_20_An_In_mol%>%
  pivot_longer(
    cols=c(Acetate,Chloride,Phosphate,Sulfate,Carbonate),
    names_to ="Anion_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AOAn20Stats <- AOAnIn20Long %>%
  group_by(Anion_Species) %>%
  summarise(AO20AnIn_mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AO20AnIn_std=sd(Concentration, na.rm=FALSE))
AOAn20Stats<-data.frame(AOAn20Stats)
#--------------------------------------------------------------------------------


AO_10_An_In <- AOAn10Stats[,c(1:3)] %>%
  pivot_wider(names_from = Anion_Species, values_from = c(AO10AnIn_mean, AO10AnIn_std))

AO_10_An_In<-data.frame(data.frame(lapply(AO_10_An_In,rep,times=24)))

colnames(AO_10_An_In)<-c("AO_Ace_In","AO_Carb_In","AO_Cl_In","AO_P_In","AO_S_In","AO_Ace_std","AO_Carb_std","AO_Cl_std","AO_P_std","AO_S_std")


AO_20_An_In <- AOAn20Stats[,c(1:3)] %>%
  pivot_wider(names_from = Anion_Species, values_from = c(AO20AnIn_mean, AO20AnIn_std))

AO_20_An_In<-data.frame(data.frame(lapply(AO_20_An_In,rep,times=24)))

colnames(AO_20_An_In)<-c("AO_Ace_In","AO_Carb_In","AO_Cl_In","AO_P_In","AO_S_In","AO_Ace_std","AO_Carb_std","AO_Cl_std","AO_P_std","AO_S_std")


```

Nov 2023 Edits cont.

```{r}
#Standards

#Cations

AO_10_Ctrl_Avg <- AO_ctrl_10_mol %>%
  group_by(group = gl(n() / 3, 3)) %>%  # Create groups of every 3 rows
  summarise_at(vars(Sodium, Ammonium, Potassium, Magnesium), list(mean = ~mean(., na.rm = TRUE), sd = ~sd(., na.rm = TRUE))) %>% 
  select(-1)
colnames(AO_10_Ctrl_Avg)<-c("Na_ctrl","NH4_ctrl","K_ctrl","Mg_ctrl","Na_ctrl_std","NH4_ctrl_std","K_ctrl_std","Mg_ctrl_std")

#creating the in columns, considering 2 reps of C, 3 of B, 3 of A (in this order), and how each is in triplicate

AO_10_Ctrl_All<-data.frame(rbind(data.frame(lapply(AO_10_Ctrl_Avg[3,],rep,times=6)),
                         data.frame(lapply(AO_10_Ctrl_Avg[2,],rep,times=9)),
                         data.frame(lapply(AO_10_Ctrl_Avg[1,],rep,times=9))))



AO_20_Ctrl_Avg<-data.frame(AO_ctrl_20_mol %>%
  group_by(group = gl(n() / 3, 3)) %>%  # Create groups of every 3 rows
  summarise_at(vars(Sodium, Ammonium, Potassium, Magnesium), list(mean = ~mean(., na.rm = TRUE), sd = ~sd(., na.rm = TRUE))))%>% 
  select(-1)

colnames(AO_20_Ctrl_Avg)<-c("Na_ctrl","NH4_ctrl","K_ctrl","Mg_ctrl","Na_ctrl_std","NH4_ctrl_std","K_ctrl_std","Mg_ctrl_std")

AO_20_Ctrl_All<-data.frame(rbind(data.frame(lapply(AO_20_Ctrl_Avg[3,],rep,times=6)),
                         data.frame(lapply(AO_20_Ctrl_Avg[2,],rep,times=9)),
                         data.frame(lapply(AO_20_Ctrl_Avg[1,],rep,times=9))))

#Anions
AO_10_An_Ctrl_Avg<-data.frame(AO_ctrl_10_An_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
        summarise_at(vars(Acetate,Chloride,Phosphate, Sulfate,Carbonate), list(mean = ~mean(., na.rm = TRUE), sd = ~sd(., na.rm = TRUE))))%>% 
  select(-1)
colnames(AO_10_An_Ctrl_Avg)<-c("Ace_ctrl","Cl_ctrl","P_ctrl","S_ctrl","Carb_ctrl","Ace_ctrl_std","Cl_ctrl_std","P_ctrl_std","S_ctrl_std","Carb_ctrl_std")

AO_10_An_Ctrl_All<-data.frame(rbind(data.frame(lapply(AO_10_An_Ctrl_Avg[3,],rep,times=6)),
                         data.frame(lapply(AO_10_An_Ctrl_Avg[2,],rep,times=9)),
                         data.frame(lapply(AO_10_An_Ctrl_Avg[1,],rep,times=9))))

AO_20_An_Ctrl_Avg<-data.frame(AO_ctrl_20_An_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
        summarise_at(vars(Acetate,Chloride,Phosphate, Sulfate,Carbonate), list(mean = ~mean(., na.rm = TRUE), sd = ~sd(., na.rm = TRUE))))%>% 
  select(-1)
colnames(AO_20_An_Ctrl_Avg)<-c("Ace_ctrl","Cl_ctrl","P_ctrl","S_ctrl","Carb_ctrl","Ace_ctrl_std","Cl_ctrl_std","P_ctrl_std","S_ctrl_std","Carb_ctrl_std")

AO_20_An_Ctrl_All<-data.frame(rbind(data.frame(lapply(AO_20_An_Ctrl_Avg[3,],rep,times=6)),
                         data.frame(lapply(AO_20_An_Ctrl_Avg[2,],rep,times=9)),
                         data.frame(lapply(AO_20_An_Ctrl_Avg[1,],rep,times=9))))

```

\*\*\* change \# reps for other biochars e.g. AM_20 should only be 2

```{r}

AO_10_Cat_In<-data.frame(lapply(AO_10_Cat_In,rep, times=3))
AO_20_Cat_In<-data.frame(lapply(AO_20_Cat_In,rep, times=1))

AO_10_An_In<-data.frame(lapply(AO_10_An_In,rep, times=3))
AO_20_An_In<-data.frame(lapply(AO_20_An_In,rep, times=1))


AO_10_Ctrl_All<-data.frame(lapply(AO_10_Ctrl_All,rep, times=3))
AO_20_Ctrl_All<-data.frame(lapply(AO_20_Ctrl_All,rep, times=1))

AO_10_An_Ctrl_All<-data.frame(lapply(AO_10_An_Ctrl_All,rep, times=3))
AO_20_An_Ctrl_All<-data.frame(lapply(AO_20_An_Ctrl_All,rep, times=1))
```

updated dataframes:

-   AO_10_Cat_In, AO_20_Cat_In

-   AO_10_An_In, AO_20_An_In

before these either were avg of in and ctrl

New dataframes

-   AO_10_Ctrl_All, AO_20_Ctrl_All

-   AO_10_An_Ctrl_All, AO_20_An_Ctrl_All

these weren't defined independenly before

End Nov. 2023 edits - these dataframes are included below up to the Oct 2023 edits.

## Adding biochar mass, urine volume, and initial urine

edited Nov 2023 to include new columns

```{r}
#Cations

AO_10_All<-data.frame(cbind(AO_10_All,AO_10_Cat_In,AO_10_An_In,volume, mass_biochar, AO_10_Ctrl_All, AO_10_An_Ctrl_All))
AO_20_All<-data.frame(cbind(AO_20_All,AO_20_Cat_In,AO_20_An_In, volume=volume[c(1:24),], mass_biochar=mass_biochar[c(1:24),], AO_20_Ctrl_All, AO_20_An_Ctrl_All))

```

## Calculating the Normalized Ion Concentrations and Dose

edited Nov 2023 to update reference value for columns being divided

```{r}
AO_10_All$Na_Norm<- AO_10_All$Sodium/AO_10_All$AO_Na_In
AO_10_All$NH4_Norm<- AO_10_All$Ammonium/AO_10_All$AO_NH4_In
AO_10_All$K_Norm<- AO_10_All$Potassium/AO_10_All$AO_K_In
AO_10_All$Mg_Norm<- AO_10_All$Magnesium/AO_10_All$AO_Mg_In

AO_10_All$Ace_Norm<- AO_10_All$Acetate/AO_10_All$AO_Ace_In
AO_10_All$Cl_Norm<- AO_10_All$Chloride/AO_10_All$AO_Cl_In
AO_10_All$P_Norm<- AO_10_All$Phosphate/AO_10_All$AO_P_In
AO_10_All$S_Norm<- AO_10_All$Sulfate/AO_10_All$AO_S_In
AO_10_All$Carb_Norm<- AO_10_All$Carbonate/AO_10_All$AO_Carb_In


AO_20_All$Na_Norm<- AO_20_All$Sodium/AO_20_All$AO_Na_In
AO_20_All$NH4_Norm<- AO_20_All$Ammonium/AO_20_All$AO_NH4_In
AO_20_All$K_Norm<- AO_20_All$Potassium/AO_20_All$AO_K_In
AO_20_All$Mg_Norm<- AO_20_All$Magnesium/AO_20_All$AO_Mg_In

AO_20_All$Ace_Norm<- AO_20_All$Acetate/AO_20_All$AO_Ace_In
AO_20_All$Cl_Norm<- AO_20_All$Chloride/AO_20_All$AO_Cl_In
AO_20_All$P_Norm<- AO_20_All$Phosphate/AO_20_All$AO_P_In
AO_20_All$S_Norm<- AO_20_All$Sulfate/AO_20_All$AO_S_In
AO_20_All$Carb_Norm<- AO_20_All$Carbonate/AO_20_All$AO_Carb_In
```

## Determining Dose

AO_10_All

```{r}
AO_10_All$Dose<-(mapply('/',AO_10_All$mass_biochar,AO_10_All$volume))
AO_20_All$Dose<-(mapply('/',AO_20_All$mass_biochar,AO_20_All$volume))
```

## Calculating Q of each Triplicate

Note: the Q is based on the C_in which is the average of the initial value and the control

```{r}

Q_function<-function(df,Q,C_In,C_eq,volume,m_s) {
  df[[Q]]<-((df[[C_In]]-df[[C_eq]])*df[[volume]]/df[[m_s]])
  }

AO_20_All$Q_NH4<-Q_function(AO_20_All,"Q_NH4","AO_NH4_In","Ammonium","volume","mass_biochar")

AO_10_All$Q_NH4<-Q_function(AO_10_All,"Q_NH4","AO_NH4_In","Ammonium","volume","mass_biochar")

#----------------------------------------------------------------------

AO_20_All$Q_Na<-Q_function(AO_20_All,"Q_Na","AO_Na_In","Sodium","volume","mass_biochar")

AO_10_All$Q_Na<-Q_function(AO_10_All,"Q_Na","AO_Na_In","Sodium","volume","mass_biochar")
#----------------------------------------------------------------------

AO_20_All$Q_K<-Q_function(AO_20_All,"Q_K","AO_K_In","Potassium","volume","mass_biochar")

AO_10_All$Q_K<-Q_function(AO_10_All,"Q_K","AO_K_In","Potassium","volume","mass_biochar")
#----------------------------------------------------------------------

AO_20_All$Q_Mg<-Q_function(AO_20_All,"Q_Mg","AO_Mg_In","Magnesium","volume","mass_biochar")

AO_10_All$Q_Mg<-Q_function(AO_10_All,"Q_K","AO_K_In","Magnesium","volume","mass_biochar")



#October 2023; adding Q for Anions

AO_20_All$Q_Cl<-Q_function(AO_20_All,"Q_Cl","AO_Cl_In","Chloride","volume","mass_biochar")

AO_10_All$Q_Cl<-Q_function(AO_10_All,"Q_Cl","AO_Cl_In","Chloride","volume","mass_biochar")
#----------------------------------------------------------------------

AO_20_All$Q_PO4<-Q_function(AO_20_All,"Q_PO4","AO_P_In","Phosphate","volume","mass_biochar")

AO_10_All$Q_PO4<-Q_function(AO_10_All,"Q_PO4","AO_P_In","Phosphate","volume","mass_biochar")
#----------------------------------------------------------------------

AO_20_All$Q_S<-Q_function(AO_20_All,"Q_S","AO_S_In","Sulfate","volume","mass_biochar")

AO_10_All$Q_S<-Q_function(AO_10_All,"Q_S","AO_S_In","Sulfate","volume","mass_biochar")
#----------------------------------------------------------------------

AO_20_All$Q_Ace<-Q_function(AO_20_All,"Q_Ace","AO_Ace_In","Acetate","volume","mass_biochar")

AO_10_All$Q_Ace<-Q_function(AO_20_All,"Q_Ace","AO_Ace_In","Acetate","volume","mass_biochar")


#Q<-function(df, Q_col,C_In,C_eq,volume,m_s) {df$Q_col<-((df$C_In-df$C_eq)*df$volume/df$m_s)}

#Q_function(AO_20_All,AO_20_NH4_In,Ammonium,volume,mass_biochar)
```

## Average and stdev of Replicates

-   Calculating the average and stdev of the replicates an combining them into one dataframe

-   calculating Q_sd as a percent of Q to determine where to cuz off the data

```{r}

#taking the average 
AO_10_All_Avg<-data.frame(
 AO_10_All %>%
   select(-PHREEQC_number, -Rep) %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
     summarise(across(everything(), mean, na.rm = TRUE)))

#taking stdev
AO_10_All_sd<-data.frame(
 AO_10_All%>%
    group_by(group = gl(n()/3, 3)) %>% #applies function to every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium","Magnesium","Acetate","Chloride","Phosphate", "Sulfate", "Carbonate","pH","Ionic_str", "Act_NH4","Act_Na","Act_K","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm","Q_NH4","Q_Na","Q_K","Q_Mg","Q_Cl","Q_PO4","Q_S","Q_Ace"),sd))
AO_10_All_sd

colnames(AO_10_All_sd)<-as.character(c("group","Sodium_sd","Ammonium_sd","Potassium_sd","Magnesium_sd","Acetate_sd","Chloride_sd","Phosphate_sd", "Sulfate_sd", "Carbonate_sd","pH_sd", "Ionic_str_sd","Act_NH4_sd","Act_Na_sd","Act_K_sd","AO_Na_Norm_sd","AO_NH4_Norm_sd","AO_K_Norm_sd","AO_Mg_Norm_sd","K_Ace_Norm_sd","AO_Cl_Norm_sd","AO_P_Norm_sd","AO_S_Norm_sd","AO_Carb_Norm_sd","Q_NH4_sd","Q_Na_sd","Q_K_sd","Q_Mg_sd","Q_Cl_sd","Q_PO4_sd","Q_S_sd","Q_Ace_sd"))

#combining average and std dataframes


AO_10_All_Avg_sd<-data.frame(cbind(AO_10_All_Avg,AO_10_All_sd[,-1]))

#Calculating the %percent SD of Q

AO_10_All_Avg_sd$Q_NH4_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_NH4_sd,AO_10_All_Avg_sd$Q_NH4))
AO_10_All_Avg_sd$Q_NH4_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_NH4_sd_perc,100)))  

AO_10_All_Avg_sd$Q_Na_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_Na_sd,AO_10_All_Avg_sd$Q_Na))
AO_10_All_Avg_sd$Q_Na_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_Na_sd_perc,100)))  

AO_10_All_Avg_sd$Q_K_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_K_sd,AO_10_All_Avg_sd$Q_K))
AO_10_All_Avg_sd$Q_K_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_K_sd_perc,100)))  

AO_10_All_Avg_sd$Q_Mg_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_Mg_sd,AO_10_All_Avg_sd$Q_Mg))
AO_10_All_Avg_sd$Q_Mg_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_Mg_sd_perc,100)))  


#October 2023; adding Q for Anions
AO_10_All_Avg_sd$Q_Cl_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_Cl_sd,AO_10_All_Avg_sd$Q_Cl))
AO_10_All_Avg_sd$Q_Cl_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_Cl_sd_perc,100)))  

AO_10_All_Avg_sd$Q_PO4_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_PO4_sd,AO_10_All_Avg_sd$Q_PO4))
AO_10_All_Avg_sd$Q_PO4_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_PO4_sd_perc,100))) 

AO_10_All_Avg_sd$Q_S_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_S_sd,AO_10_All_Avg_sd$Q_S))
AO_10_All_Avg_sd$Q_S_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_S_sd_perc,100))) 

AO_10_All_Avg_sd$Q_Ace_sd_perc<-(mapply('/', AO_10_All_Avg_sd$Q_Ace_sd,AO_10_All_Avg_sd$Q_Ace))
AO_10_All_Avg_sd$Q_Ace_sd_perc<-(abs(mapply('*',AO_10_All_Avg_sd$Q_Ace_sd_perc,100))) 



#------------------------------------------------------------------------------------------------------------

AO_20_All_Avg<-data.frame(
 AO_20_All %>%
   select(-PHREEQC_number, -Rep) %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
     summarise(across(everything(), mean, na.rm = TRUE)))

#taking stdev
AO_20_All_sd<-data.frame(
 AO_20_All%>%
    group_by(group = gl(n()/3, 3)) %>% #applies function to every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium","Magnesium","Acetate","Chloride","Phosphate", "Sulfate", "Carbonate","pH","Ionic_str", "Act_NH4","Act_Na","Act_K","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm","Q_NH4","Q_Na","Q_K","Q_Mg","Q_Cl","Q_PO4","Q_S","Q_Ace"),sd))
AO_20_All_sd

colnames(AO_20_All_sd)<-as.character(c("group","Sodium_sd","Ammonium_sd","Potassium_sd","Magnesium_sd","Acetate_sd","Chloride_sd","Phosphate_sd", "Sulfate_sd", "Carbonate_sd","pH_sd", "Ionic_str_sd","Act_NH4_sd","Act_Na_sd","Act_K_sd","AO_Na_Norm_sd","AO_NH4_Norm_sd","AO_K_Norm_sd","AO_Mg_Norm_sd","K_Ace_Norm_sd","AO_Cl_Norm_sd","AO_P_Norm_sd","AO_S_Norm_sd","AO_Carb_Norm_sd","Q_NH4_sd","Q_Na_sd","Q_K_sd","Q_Mg_sd","Q_Cl_sd","Q_PO4_sd","Q_S_sd","Q_Ace_sd"))

#combining average adn std dataframes


AO_20_All_Avg_sd<-data.frame(cbind(AO_20_All_Avg,AO_20_All_sd[,-1]))

#Calculating the %percent SD of Q

AO_20_All_Avg_sd$Q_NH4_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_NH4_sd,AO_20_All_Avg_sd$Q_NH4))
AO_20_All_Avg_sd$Q_NH4_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_NH4_sd_perc,100)))  


AO_20_All_Avg_sd$Q_Na_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_Na_sd,AO_20_All_Avg_sd$Q_Na))
AO_20_All_Avg_sd$Q_Na_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_Na_sd_perc,100)))  

AO_20_All_Avg_sd$Q_K_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_K_sd,AO_20_All_Avg_sd$Q_K))
AO_20_All_Avg_sd$Q_K_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_K_sd_perc,100)))  

AO_20_All_Avg_sd$Q_Mg_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_Mg_sd,AO_20_All_Avg_sd$Q_Mg))
AO_20_All_Avg_sd$Q_Mg_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_Mg_sd_perc,100)))  



#October 2023; adding Q for Anions
AO_20_All_Avg_sd$Q_Cl_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_Cl_sd,AO_20_All_Avg_sd$Q_Cl))
AO_20_All_Avg_sd$Q_Cl_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_Cl_sd_perc,100)))  

AO_20_All_Avg_sd$Q_PO4_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_PO4_sd,AO_20_All_Avg_sd$Q_PO4))
AO_20_All_Avg_sd$Q_PO4_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_PO4_sd_perc,100))) 

AO_20_All_Avg_sd$Q_S_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_S_sd,AO_20_All_Avg_sd$Q_S))
AO_20_All_Avg_sd$Q_S_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_S_sd_perc,100))) 

AO_20_All_Avg_sd$Q_Ace_sd_perc<-(mapply('/', AO_20_All_Avg_sd$Q_Ace_sd,AO_20_All_Avg_sd$Q_Ace))
AO_20_All_Avg_sd$Q_Ace_sd_perc<-(abs(mapply('*',AO_20_All_Avg_sd$Q_Ace_sd_perc,100))) 
```

### Converting Ox condition to factors to be able to group for plotting

```{r}
AO_10_All_Avg_sd$Ox<-as.factor(AO_10_All_Avg$Ox) 
AO_20_All_Avg_sd$Ox<-as.factor(AO_20_All_Avg$Ox) 
```

## Oct 2023 Edit

Resaving file as RDS to work on in separate .rmd file

```{r}
AO_All_Avg<-rbind(AO_10_All_Avg_sd,AO_20_All_Avg_sd)
saveRDS(AO_All_Avg, file = "AO_ALL.RDS")

```

Outliers

```{r}
#AO_10_All_Avg_sd[2,17]<-NA
#AO_10_All_Avg_sd[18,17]<-NA
```

##Plotting Dose vs. Ion Concentration \# Creating a Datadrame with only Ox, Dose, and Normalized concentrations - This allows me to convert to long format and plot everything on one graph

```{r}

AO_10_Ion_Norm<-AO_10_All_Avg_sd[,c("Ox","Dose","pH","Ionic_str","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm")]
AO_20_Ion_Norm<-AO_20_All_Avg_sd[,c("Ox","Dose","pH","Ionic_str","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm")]

AO_All_Ion_Norm<-rbind(AO_10_Ion_Norm,AO_20_Ion_Norm)


AO_All_Ion_Norm_long<-
 AO_All_Ion_Norm%>%
  pivot_longer(
    cols=c("Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm"),
    names_to ="Ion_Species",
    values_to="Norm_Concentration",
    names_repair="minimal")

AO_All_Ion_Norm_long$Ion_Species<-as.factor(AO_All_Ion_Norm_long$Ion_Species)

```

plotting

```{r}
coeff<-4
#the second Y axis is like the first multiplied by 10 (trans=~.*4).


AO_10_Ion_Norm_plot<- ggplot(AO_All_Ion_Norm_long,aes(x=Dose,y=Norm_Concentration, color = Ion_Species, na.rm=TRUE)) +
   geom_point(shape=16, size =4)+
   geom_line(aes(y=pH / coeff)) + #the value be display in the second variable geom_line() call must be divided by 4 to mimic the range of the first variable.
    geom_line(aes(y=Ionic_str)) + 
  facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration & Ionic Strength (M)")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
      scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         sec.axis = sec_axis(~.*coeff, name="pH"))
AO_10_Ion_Norm_plot
```

## Subsetting

### Only including data for when percent standard deviation is less than 30%

```{r}
AO_10_All_Avg_sd_32perc<- AO_10_All_Avg_sd[(AO_10_All_Avg_sd$Q_NH4_sd_perc<=32)&(AO_10_All_Avg_sd$Ox!=15),]  #& (AO_10_All_Avg_sd$Ox!=15), to omit 15

AO_20_All_Avg_sd_32perc<- AO_20_All_Avg_sd[AO_20_All_Avg_sd$Q_NH4_sd_perc<=100,]

```

## Plotting Alk vs. Q

```{r}

AO_10_Plot_all<- ggplot(AO_10_All_Avg_sd,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AO Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
AO_10_Plot_all
```

```{r}

AO_10_Plot<- ggplot(AO_10_All_Avg_sd_32perc,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AO Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
AO_10_Plot

```

```{r}

AO_20_Plot<- ggplot(AO_20_All_Avg_sd_32perc,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("RS5 (O:C=0.30) Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        aspect.ratio = 1,
        legend.position='none',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) +
   scale_color_manual(values=cbbPalette)
AO_20_Plot


```

### Combining plots (for full dataset)

AO_Plot

```{r}

#combining everything into a dataframe
AO_All_Avg_sd<-rbind(AO_10_All_Avg_sd,AO_20_All_Avg_sd)
 ##REMOVING 15% for now
AO_All_Avg_sd<-AO_All_Avg_sd[(AO_All_Avg_sd$Ox!=15),] 


#plotting

AO_Plot<- ggplot(AO_All_Avg_sd,aes(x=Act_NH4,y=Q_NH4,color=factor(Ox, labels=c("0.14","0.19","0.19")), na.rm=TRUE)) +
    guides(color = guide_legend(title = "Elemental O:C"))+
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mM)")+
  ylab("Q (mmol TAN/g biochar)")+
  ggtitle("RS5")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
          aspect.ratio = 1,
          legend.position=c(0.20, .79),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
   scale_color_manual(values=cbbPalette)
AO_Plot
```

## Dose v. Q

```{r}
AO_Plot_Dose<- ggplot(AO_All_Avg_sd,aes(x=Dose,y=Q_NH4,color=factor(Ox, labels=c("0.13","0.19","0.19")), na.rm=TRUE)) +
    guides(color = guide_legend(title = "Elemental O:C"))+
  geom_point(shape=16, size =4)+
     #geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g Biochar)")+
  ylab("Q (mmol TAN/g biochar)")+
  ggtitle("RS5")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
          aspect.ratio = 1,
          legend.position=c(0.20, .79),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
   scale_color_manual(values=cbbPalette)
AO_Plot_Dose
```

SUBSETTING

## Semi-arbitrarily removing the data that doesn't fit my idea of isotherms

```{r}
AO_All_Avg_sd_Think<-AO_All_Avg_sd[(AO_All_Avg_sd$ID>=5 &AO_All_Avg_sd$ID<=8),]


View(AO_All_Avg_sd_Think)
```

Concentration

```{r}
AO_Plot_Conc<- ggplot(AO_All_Avg_sd,aes(x=Ammonium,y=Q_NH4,color=factor(Ox, labels=c("0.13","0.19","0.19")), na.rm=TRUE)) +
    guides(color = guide_legend(title = "Elemental O:C"))+
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Ammonium-Ammonium_sd, xmax=Ammonium+Ammonium_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Concentration (mM)")+
  ylab("Q (mM TAN/g biochar)")+
  ggtitle("RS5")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
          aspect.ratio = 1,
          legend.position=c(0.20, .79),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
   scale_color_manual(values=cbbPalette)
AO_Plot_Conc
```

### Plotting Q for K

```{r}
AO_K_Plot<- ggplot(AO_All_Avg_sd,aes(x=Act_K,y=Q_K, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
      facet_wrap(facets = vars(Ox))+
     geom_errorbar(aes(ymin=Q_K-Q_K_sd, ymax=Q_K+Q_K_sd))+
  geom_errorbarh(aes(xmin=Act_K-Act_K_sd, xmax=Act_K+Act_K_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol K/g biochar")+
  ggtitle("AO Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
AO_K_Plot
```

Plotting NH4 as separate plots

```{r}
AO_Plot<- ggplot(AO_All_Avg_sd,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
    facet_wrap(facets = vars(Ox))+
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AO Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
   scale_y_continuous(expand = c(2,2), limits = c(-3,20))
AO_Plot

```

## Combining data and plots for \<32% Error

```{r}
#combining everything into a dataframe
AO_All_Avg_sd_32perc<-rbind(AO_10_All_Avg_sd_32perc,AO_20_All_Avg_sd_32perc)

#plotting

AO_Plot_32perc<- ggplot(AO_All_Avg_sd_32perc,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AO Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
       #scale_x_continuous(expand = c(0.0,0), limits = c(0,400))
      #  scale_y_continuous(expand = c(0,0), limits = c(-0.1,5))
AO_Plot_32perc
```

## Plotting Concentration vs. Q

```{r}

AO_Plot_32perc_Conc<- ggplot(AO_All_Avg_sd_32perc,aes(x=Ammonium,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Ammonium-Ammonium_sd, xmax=Ammonium+Ammonium_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Concentration (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AO Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) +
         scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AO_Plot_32perc_Conc
```

# Generating Isotherm

### Extracting Act and Q for each Ox condition of \<32% Q-sd subset

```{r}

Act_10_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==10,15])
Qe_10_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==10,39])

Act_12_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==12,15])
Qe_12_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==12,39])

Act_15_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==15,15])
Qe_15_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==15,39])

Act_20_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==20,15])
Qe_20_NH4<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==20,39])

#removing 0 because other isotherms don't like it
Act_20_NH4_No_0<-c(AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==20,15])
Qe_20_NH4_No_0<-c(AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==20,39])

```

### Extracting Concentration and Q for each Ox condition of \<32% Q-sd subset

```{r}

Conc_10<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==10,5])

Conc_12<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==12,5])

Conc_15<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==15,5])

Conc_20<-c(0,AO_All_Avg_sd_32perc[AO_All_Avg_sd_32perc$Ox==20,5])

```

### Extracting Act and Q for each Ox condition of subset I think fits isotherm

```{r}

Act_10_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==10,15])
Qe_10_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==10,39])

Act_12_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==12,15])
Qe_12_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==12,39])

Act_15_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==15,15])
Qe_15_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==15,39])

Act_20_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==20,15])
Qe_20_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==20,39])

#Conc

Conc_10_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==10,5])

Conc_12_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==12,5])

Conc_15_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==15,5])

Conc_20_NH4_Think<-c(0,AO_All_Avg_sd_Think[AO_All_Avg_sd_Think$Ox==20,5])


```

### Generating Isotherm: Freundlich w/ Activity

Need to do this to be able to generate the fit parameter

```{r}

Freundlich_10<-freundlichanalysis (Act_10_NH4, Qe_10_NH4)
Freundlich_10[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_10_KF<-Freundlich_10$plot_env$pars_KF
Freundlich_10_n<-Freundlich_10$plot_env$pars_n
#Q_Freun_10<-Freundlich_10_KF*(Act5_10_NH4^(1/Freundlich_10_n))
Q_Freun_10<-as.numeric(c(Freundlich_10$plot_env$rsqq$fitted.values))

Q_Freund_10_fun<-function (Act){
  (Freundlich_10_KF * (Act^(1/Freundlich_10_n)))
}

Freundlich_10
#-------------------------------------------------------------------------------
Freundlich_12<-freundlichanalysis (Act_12_NH4, Qe_12_NH4)
Freundlich_12[[9]]$title<-"Freundlich Isotherm 12"

Freundlich_12_KF<-Freundlich_12$plot_env$pars_KF
Freundlich_12_n<-Freundlich_12$plot_env$pars_n
#Q_Freun_5<-Freundlich_5_KF*(Act5_5_NH4^(1/Freundlich_5_n))
Q_Freun_12<-as.numeric(c(Freundlich_12$plot_env$rsqq$fitted.values))

Q_Freund_12_fun<-function (Act){
  (Freundlich_12_KF * (Act^(1/Freundlich_12_n)))
}

Freundlich_12
#----------------------------------------------------------------------

Freundlich_15<-freundlichanalysis (Act_15_NH4, Qe_15_NH4)
Freundlich_15[[9]]$title<-"Freundlich Isotherm 15"
Freundlich_15_KF<-Freundlich_15$plot_env$pars_KF
Freundlich_15_n<-Freundlich_15$plot_env$pars_n
Q_Freun_15<-as.numeric(c(Freundlich_15$plot_env$rsqq$fitted.values))

Q_Freund_15_fun<-function (Act){
  (Freundlich_15_KF * (Act^(1/Freundlich_15_n)))
}
Freundlich_15
#-------------------------------------------------------------------------------
Freundlich_20<-freundlichanalysis (Act_20_NH4, Qe_20_NH4)
Freundlich_20[[9]]$title<-"Freundlich Isotherm 20"

Freundlich_20_KF<-Freundlich_20$plot_env$pars_KF
Freundlich_20_n<-Freundlich_20$plot_env$pars_n
#Q_Freun_20<-Freundlich_20_KF*(Act_20_NH4^(1/Freundlich_20_n))
Q_Freun_20<-as.numeric(c(Freundlich_20$plot_env$rsqq$fitted.values))

Q_Freund_20_fun<-function (Act){
  (Freundlich_20_KF * (Act^(1/Freundlich_20_n)))
}

Freundlich_20

```

### Testing out Different Isotherms

```{r}
#DR_20<-dubininradushkevichanalysis(Act_20_NH4, Qe_20_NH4,298)

Tempkin_20<-temkinanalysis(Act_20_NH4_No_0, Qe_20_NH4_No_0,298)
Tempkin_20
```

```{r}
DR_20<-dubininradushkevichanalysis(Act_20_NH4_No_0, Qe_20_NH4_No_0,298)
DR_20
DR_qmax<-DR_20$plot_env$pars_qs #qmax

```

```{r}
#Hill_20<-hillanalysis(Act_20_NH4, Qe_20_NH4)
#Hill_20
```

### Generating Isotherm: Freundlich w/ Concentration

```{r}
Freundlich_10_Conc<-freundlichanalysis (Conc_10, Qe_10_NH4)
Freundlich_10_Conc[[9]]$title<-"Freundlich Isotherm 5"

Freundlich_10_KF_Conc<-Freundlich_10_Conc$plot_env$pars_KF
Freundlich_10_n_Conc<-Freundlich_10_Conc$plot_env$pars_n
#Q_Freun_10<-Freundlich_10_KF*(Conc_10^(1/Freundlich_10_n))
Q_Freun_10_Conc<-as.numeric(c(Freundlich_10_Conc$plot_env$rsqq$fitted.values))

Q_Freund_10_fun_Conc<-function (Ammonium){
  (Freundlich_10_KF_Conc * (Ammonium^(1/Freundlich_10_n_Conc)))
}

Freundlich_10_Conc


#----------------------------------------------------------------------

Freundlich_12_Conc<-freundlichanalysis (Conc_12, Qe_12_NH4)
Freundlich_12_Conc[[9]]$title<-"Freundlich Isotherm 30"
Freundlich_12_KF_Conc<-Freundlich_12_Conc$plot_env$pars_KF
Freundlich_12_n_Conc<-Freundlich_12_Conc$plot_env$pars_n
FreundlQ_Freun_12_Conc<-as.numeric(c(Freundlich_12_Conc$plot_env$rsqq$fitted.values))

Q_Freund_12_fun_Conc<-function (Ammonium){
  (Freundlich_12_KF_Conc * (Ammonium^(1/Freundlich_12_n_Conc)))
}
Freundlich_12_Conc
#-------------------------------------------------------------------------------
Freundlich_15_Conc<-freundlichanalysis (Conc_15, Qe_15_NH4)
Freundlich_15_Conc[[9]]$title<-"Freundlich Isotherm 25"
Freundlich_15_KF_Conc<-Freundlich_15_Conc$plot_env$pars_KF
Freundlich_15_n_Conc<-Freundlich_15_Conc$plot_env$pars_n
Q_Freun_15_Conc<-as.numeric(c(Freundlich_15_Conc$plot_env$rsqq$fitted.values))

Q_Freund_15_fun_Conc<-function (Ammonium){
  (Freundlich_15_KF_Conc * (Ammonium^(1/Freundlich_15_n_Conc)))
}
Freundlich_15_Conc

#-------------------------------------------------------------------------------

Freundlich_20_Conc<-freundlichanalysis (Conc_20, Qe_20_NH4)
Freundlich_20_Conc[[9]]$title<-"Freundlich Isotherm 20"

Freundlich_20_KF_Conc<-Freundlich_20_Conc$plot_env$pars_KF
Freundlich_20_n_Conc<-Freundlich_20_Conc$plot_env$pars_n
#Q_Freun_20<-Freundlich_20_KF*(Conc_20^(1/Freundlich_20_n))
Q_Freun_20_Conc<-as.numeric(c(Freundlich_20_Conc$plot_env$rsqq$fitted.values))

Q_Freund_20_fun_Conc<-function (Ammonium){
  (Freundlich_20_KF_Conc * (Ammonium^(1/Freundlich_20_n_Conc)))
}

Freundlich_20_Conc
#-------------------------------------------------------------------------------

```

```{r}
#----------------------------------------------------------------------
Freundlich_10_Think<-freundlichanalysis (Act_10_NH4_Think, Qe_10_NH4_Think)
Freundlich_10_Think[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_10_KF_Think<-Freundlich_10_Think$plot_env$pars_KF
Freundlich_10_n_Think<-Freundlich_10_Think$plot_env$pars_n
#Q_Freun_10<-Freundlich_10_KF*(Act5_10_NH4^(1/Freundlich_10_n))
Q_Freun_10_Think<-as.numeric(c(Freundlich_10_Think$plot_env$rsqq$fitted.values))

Q_Freund_10_fun_Think<-function (Act){
  (Freundlich_10_KF_Think * (Act^(1/Freundlich_10_n_Think)))
}

Freundlich_10_Think
#-------------------------------------------------------------------------------
Freundlich_12_Think<-freundlichanalysis (Act_12_NH4_Think, Qe_12_NH4_Think)
Freundlich_12_Think[[9]]$title<-"Freundlich Isotherm 12"

Freundlich_12_KF_Think<-Freundlich_12_Think$plot_env$pars_KF
Freundlich_12_n_Think<-Freundlich_12_Think$plot_env$pars_n
#Q_Freun_10<-Freundlich_10_KF*(Act5_10_NH4^(1/Freundlich_10_n))
Q_Freun_12_Think<-as.numeric(c(Freundlich_12_Think$plot_env$rsqq$fitted.values))

Q_Freund_12_fun_Think<-function (Act){
  (Freundlich_12_KF_Think * (Act^(1/Freundlich_12_n_Think)))
}

Freundlich_12_Think
#-------------------------------------------------------------------------------

Freundlich_15_Think<-freundlichanalysis (Act_15_NH4_Think, Qe_15_NH4_Think)
Freundlich_15_Think[[9]]$title<-"Freundlich Isotherm 15"
Freundlich_15_KF_Think<-Freundlich_15_Think$plot_env$pars_KF
Freundlich_15_n_Think<-Freundlich_15_Think$plot_env$pars_n
Q_Freun_15_Think<-as.numeric(c(Freundlich_15_Think$plot_env$rsqq$fitted.values))

Q_Freund_15_fun_Think<-function (Act){
  (Freundlich_15_KF_Think * (Act^(1/Freundlich_15_n_Think)))
}
Freundlich_15_Think
#-------------------------------------------------------------------------------
Freundlich_20_Think<-freundlichanalysis (Act_20_NH4_Think, Qe_20_NH4_Think)
Freundlich_20_Think[[9]]$title<-"Freundlich Isotherm 20"

Freundlich_20_KF_Think<-Freundlich_20_Think$plot_env$pars_KF
Freundlich_20_n_Think<-Freundlich_20_Think$plot_env$pars_n
#Q_Freun_20<-Freundlich_20_KF*(Act_20_NH4^(1/Freundlich_20_n))
Q_Freun_20_Think<-as.numeric(c(Freundlich_20_Think$plot_env$rsqq$fitted.values))

Q_Freund_20_fun_Think<-function (Act){
  (Freundlich_20_KF_Think * (Act^(1/Freundlich_20_n_Think)))
}

Freundlich_20_Think

```

CONC

------------------------------------------------------------------------

```{r}
Freundlich_5_Think_Conc<-freundlichanalysis (Conc_5_NH4_Think, Qe_5_NH4_Think)
Freundlich_5_Think_Conc[[9]]$title<-"Freundlich Isotherm 5"

Freundlich_5_KF_Think_Conc<-Freundlich_5_Think_Conc$plot_env$pars_KF
Freundlich_5_n_Think_Conc<-Freundlich_5_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_5_KF*(Act5_5_NH4^(1/Freundlich_5_n))
Q_Freun_5_Think_Conc<-as.numeric(c(Freundlich_5_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_5_fun_Think_Conc<-function (Conc){
  (Freundlich_5_KF_Think_Conc * (Conc^(1/Freundlich_5_n_Think_Conc)))
}

Freundlich_5_Think_Conc
#----------------------------------------------------------------------
Freundlich_10_Think_Conc<-freundlichanalysis (Conc_10_NH4_Think, Qe_10_NH4_Think)
Freundlich_10_Think_Conc[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_10_KF_Think_Conc<-Freundlich_10_Think_Conc$plot_env$pars_KF
Freundlich_10_n_Think_Conc<-Freundlich_10_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_10_KF*(Act5_10_NH4^(1/Freundlich_10_n))
Q_Freun_10_Think_Conc<-as.numeric(c(Freundlich_10_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_10_fun_Think_Conc<-function (Conc){
  (Freundlich_10_KF_Think_Conc * (Conc^(1/Freundlich_10_n_Think_Conc)))
}

Freundlich_10_Think_Conc
#----------------------------------------------------------------------
Freundlich_12_Think_Conc<-freundlichanalysis (Conc_12_NH4_Think, Qe_12_NH4_Think)
Freundlich_12_Think_Conc[[9]]$title<-"Freundlich Isotherm 12"

Freundlich_12_KF_Think_Conc<-Freundlich_12_Think_Conc$plot_env$pars_KF
Freundlich_12_n_Think_Conc<-Freundlich_12_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_10_KF*(Act5_10_NH4^(1/Freundlich_10_n))
Q_Freun_12_Think_Conc<-as.numeric(c(Freundlich_12_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_12_fun_Think_Conc<-function (Conc){
  (Freundlich_12_KF_Think_Conc * (Conc^(1/Freundlich_12_n_Think_Conc)))
}

Freundlich_12_Think_Conc
#----------------------------------------------------------------------
Freundlich_15_Think_Conc<-freundlichanalysis (Conc_15_NH4_Think, Qe_15_NH4_Think)
Freundlich_15_Think_Conc[[9]]$title<-"Freundlich Isotherm 25"

Freundlich_15_KF_Think_Conc<-Freundlich_15_Think_Conc$plot_env$pars_KF
Freundlich_15_n_Think_Conc<-Freundlich_15_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_25_KF*(Act5_25_NH4^(1/Freundlich_25_n))
Q_Freun_15_Think_Conc<-as.numeric(c(Freundlich_15_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_15_fun_Think_Conc<-function (Conc){
  (Freundlich_15_KF_Think_Conc * (Conc^(1/Freundlich_15_n_Think_Conc)))
}

Freundlich_15_Think_Conc
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

Freundlich_20_Think_Conc<-freundlichanalysis (Conc_20_NH4_Think, Qe_20_NH4_Think)
Freundlich_20_Think_Conc[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_20_KF_Think_Conc<-Freundlich_20_Think_Conc$plot_env$pars_KF
Freundlich_20_n_Think_Conc<-Freundlich_20_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_20_KF*(Act5_20_NH4^(1/Freundlich_20_n))
Q_Freun_20_Think_Conc<-as.numeric(c(Freundlich_20_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_20_fun_Think_Conc<-function (Conc){
  (Freundlich_20_KF_Think_Conc * (Conc^(1/Freundlich_20_n_Think_Conc)))
}

Freundlich_20_Think_Conc


#------------------------------------------------------------------------------

```

# Adding Isotherm fit to Activity Plot

```{r}
AO_20_All_Avg_sd$Ox[1]

AO_20_Plot_Iso<-AO_20_Plot+
  geom_function(aes(color = factor(AO_20_All_Avg_sd$Ox[1])),fun=Q_Freund_20_fun)
AO_20_Plot_Iso


```

```{r}
AO_All_Avg_sd_32perc$Ox[1]

AO_Plot_Iso<-AO_Plot_32perc+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[1])),fun=Q_Freund_10_fun)+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[9])),fun=Q_Freund_12_fun)+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[13])),fun=Q_Freund_15_fun)+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[16])),fun=Q_Freund_20_fun)+
        scale_x_continuous(expand = c(0.0,0), limits = c(0,350))
  
AO_Plot_Iso




```

# Adding Isotherm fit to Concentration Plot

```{r}
AO_All_Avg_sd_32perc$Ox[1]

AO_Plot_Iso_Conc<-AO_Plot_32perc_Conc+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[1])),fun=Q_Freund_10_fun_Conc)+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[9])),fun=Q_Freund_12_fun_Conc)+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[13])),fun=Q_Freund_15_fun_Conc)+
  geom_function(aes(color = factor(AO_All_Avg_sd_32perc$Ox[16])),fun=Q_Freund_20_fun_Conc)+
        scale_x_continuous(expand = c(0.0,0), limits = c(0,550))+
        scale_y_continuous(expand = c(0.0,0), limits = c(0,20))
  
AO_Plot_Iso_Conc
```

##Calculating Q at a specific Concentration or Activity

AO_XPS_C\<-c(81.50,72.77,77.55,79.83 )

AO_XPS_O\<-c(18.50,27.23,22.45,20.17)

AO_XPS_O_C\<-((AO_XPS_O/AO_XPS_C)\*(12/16))

```{r}

AO_Q_Conc_350<-data.frame(c(Q_Freund_10_fun_Conc(350),
                         Q_Freund_12_fun_Conc(350),
                       #  Q_Freund_15_fun_Conc(350),
                         Q_Freund_20_fun_Conc(350)))

AO_Q_Act_230<-data.frame(c(Q_Freund_10_fun(230),
                         Q_Freund_12_fun(230),
                       #  Q_Freund_15_fun(230),
                         Q_Freund_20_fun(230)))

  
AO_Q_Act_230_Think<-data.frame(c(Q_Freund_10_fun_Think(300),
                         Q_Freund_12_fun_Think(300),
                      #   Q_Freund_15_fun(230),
                         Q_Freund_20_fun_Think(300)))

AO_Q_Conc_300_Think<-data.frame(c(Q_Freund_10_fun_Think_Conc(300),
                         Q_Freund_12_fun_Think_Conc(300),
                      #   Q_Freund_15_fun(230),
                         Q_Freund_20_fun_Think_Conc(300)))


AO_O_C_EA<-data.frame(c(0.125,
0.191,
#0.145,
0.191))

AO_XPS_C<-c(81.50,72.77,77.55,79.83)
AO_XPS_O<-c(18.50,27.23,22.45,20.17)
AO_XPS_O_C<-((AO_XPS_O/AO_XPS_C)*(12/16))

#w/o 15

AO_XPS_C<-c(81.50,72.77,79.83)
AO_XPS_O<-c(18.50,27.23,20.17)
AO_XPS_O_C<-((AO_XPS_O/AO_XPS_C)*(12/16))


AO_XPS_O_C<-data.frame(AO_XPS_O_C)


AO_Name<-data.frame(as.factor(c("AO",
                  "AO",
                 #"AO",
                  "AO")))

AO_O_C_vs_Sorp_Dens<-data.frame(cbind(AO_Name,AO_O_C_EA,AO_XPS_O_C,AO_Q_Conc_350,AO_Q_Act_230,AO_Q_Act_230_Think,AO_Q_Conc_300_Think))
    
colnames(AO_O_C_vs_Sorp_Dens)<-(c("ID","O_C_EA","O_C_XPS","Q_Conc_350","Q_Act_230","Q_Act_Think_300","Q_Conc_300_Think"))

```

##Plotting O:C vs. Sorption Density

#For Q based on Activity

```{r}
AO_O_C_EA_Plot_Act<- ggplot(AO_O_C_vs_Sorp_Dens,aes(x=O_C_EA,y=Q_Act_230, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (Elemental)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AO_O_C_EA_Plot_Act
```

```{r}
AO_O_C_XPS_Plot_Act<- ggplot(AO_O_C_vs_Sorp_Dens,aes(x=O_C_XPS,y=Q_Act_230, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (XPS)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AO_O_C_XPS_Plot_Act
```

##Plotting O:C vs. Sorption Density

#For Q based on Concentration

```{r}
AO_O_C_Plot_Conc<- ggplot(AO_O_C_vs_Sorp_Dens,aes(x=O_C_EA,y=Q_Conc_350, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (Elemental)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Concentration of 350 mM")+
   theme_classic(base_size=12)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AO_O_C_Plot_Conc
```

Combining AK, AM, AN, AO, (& AL(

```{r}
AK_AM_AL_AN_AO_O_C<-data.frame(rbind(AK_O_C_vs_Sorp_Dens,AM_O_C_vs_Sorp_Dens,AL_O_C_vs_Sorp_Dens,AN_O_C_vs_Sorp_Dens,AO_O_C_vs_Sorp_Dens))
AK_AM_AL_AN_AO_O_C

AK_AM_AN_AO_O_C<-data.frame(rbind(AK_O_C_vs_Sorp_Dens,AM_O_C_vs_Sorp_Dens,AN_O_C_vs_Sorp_Dens,AO_O_C_vs_Sorp_Dens))
AK_AM_AN_AO_O_C
```

Plotting Combined AK & AM Activity

.ratio = 1,

```{r}
AK_AM_AL_AN_AO_O_C_Plot_Act<- ggplot(AK_AM_AL_AN_AO_O_C,aes(x=O_C_EA,y=Q_Act_230,color=factor(ID, labels=c('SWP5','SWP7','SS7','PP7','RS5')), na.rm=TRUE)) +
   guides(color = guide_legend(title = "Biochar species"))+
  geom_point(shape=16, size =4)+
  xlab("O:C (Elemental)")+
  ylab("Q (mmol TAN/g biochar)")+
  #ggtitle("Elemental O:C vs. Sorption Density at Activity of 230")+
   theme_classic(base_size=16)+
  scale_fill_discrete(labels=c('SWP5','SWP7','SS7','PP7','RS5'))+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
       # legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_AM_AL_AN_AO_O_C_Plot_Act
```

w/o AL

```{r}
AK_AM_AN_AO_O_C_Plot_Act<- ggplot(AK_AM_AN_AO_O_C,aes(x=O_C_EA,y=Q_Act_230,color=factor(ID, labels=c('SWP5','SWP7','PP7','RS5')), na.rm=TRUE)) +
   guides(color = guide_legend(title = "Biochar species"))+
  geom_point(shape=16, size =4)+
  xlab("O:C (Elemental)")+
  ylab("Q (mmol TAN/g biochar)")+
  #ggtitle("Elemental O:C vs. Sorption Density at Activity of 230")+
   theme_classic(base_size=16)+
  scale_fill_discrete(labels=c('SWP5','SWP7','PP7','RS5'))+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
       # legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_AM_AN_AO_O_C_Plot_Act
```

#scale_x_continuous(expand = c(0.0,0), limits = c(0,550))

AK_AM_AL_AO_O_C_XPS_Plot_Act

```{r}
AK_AM_AL_AN_AO_O_C_XPS_Plot_Act<- ggplot(AK_AM_AL_AN_AO_O_C,aes(x=O_C_XPS,y=Q_Act_230,color=factor(ID, labels=c('SWP5','SWP7','SS7','PP7','RS5')), na.rm=TRUE)) +
  guides(color = guide_legend(title = "Biochar species"))+
       #  fill=guide_legend(ncol=2))+
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (XPS)")+
  ylab("Q (mmol NH4/g biochar)")+
 # ggtitle("Surface O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_AM_AL_AN_AO_O_C_XPS_Plot_Act
```

w/o AL

```{r}
AK_AM_AN_AO_O_C_XPS_Plot_Act<- ggplot(AK_AM_AN_AO_O_C,aes(x=O_C_XPS,y=Q_Act_230,color=factor(ID, labels=c('SWP5','SWP7','PP7','RS5')), na.rm=TRUE)) +
  guides(color = guide_legend(title = "Biochar species"))+
       #  fill=guide_legend(ncol=2))+
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (XPS)")+
  ylab("Q (mmol NH4/g biochar)")+
 # ggtitle("Surface O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_AM_AN_AO_O_C_XPS_Plot_Act
```

Plotting based on the think region

```{r}
AK_AM_AL_AO_O_C_Plot<- ggplot(AK_AM_AN_AO_O_C,aes(x=O_C_EA,y=Q_Act_Think_300,color=ID, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (Elemental)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Concentration of 400 mM")+
   theme_classic(base_size=12)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                     size = 1))
AK_AM_AL_AO_O_C_Plot
```

```{r}
AK_AM_AN_AO_O_C_XPS_Plot_Conc_Think<- ggplot(AK_AM_AN_AO_O_C,aes(x=O_C_XPS,y=Q_Conc_300_Think,color=factor(ID, labels=c('SWP5','SWP7','PP7','RS5')), na.rm=TRUE)) +
  guides(color = guide_legend(title = "Biochar species"))+
       #  fill=guide_legend(ncol=2))+
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (XPS)")+
  ylab("Q (mmol NH4/g biochar)")+
 # ggtitle("Surface O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)+
         scale_x_continuous(expand = c(0.0,0), limits = c(0.1,0.35))
AK_AM_AN_AO_O_C_XPS_Plot_Conc_Think
```

```{r}
AK_AM_AN_AO_O_C_EA_Plot_Conc_Think<- ggplot(AK_AM_AN_AO_O_C,aes(x=O_C_EA,y=Q_Conc_300_Think,color=factor(ID, labels=c('SWP5','SWP7','PP7','RS5')), na.rm=TRUE)) +
  guides(color = guide_legend(title = "Biochar species"))+
       #  fill=guide_legend(ncol=2))+
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (EA)")+
  ylab("Q (mmol NH4/g biochar)")+
 # ggtitle("Surface O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)+
         scale_x_continuous(expand = c(0.0,0), limits = c(0.1,0.35))
AK_AM_AN_AO_O_C_EA_Plot_Conc_Think
```

```{r}
AK_AM_AL_AN_AO_O_C_XPS_Plot_Act<- ggplot(AK_AM_AL_AN_AO_O_C,aes(x=O_C_XPS,y=Q_Conc_300_Think,color=factor(ID, labels=c('SWP5','SWP7','SS7','PP7','RS5')), na.rm=TRUE)) +
  guides(color = guide_legend(title = "Biochar species"))+
       #  fill=guide_legend(ncol=2))+
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (XPS)")+
  ylab("Q (mmol NH4/g biochar)")+
 # ggtitle("Surface O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)+
         scale_x_continuous(expand = c(0.0,0), limits = c(0.1,0.9))
AK_AM_AL_AN_AO_O_C_XPS_Plot_Act
```

```{r}
AK_AM_AL_AN_AO_O_C_XPS_Plot_Act<- ggplot(AK_AM_AL_AN_AO_O_C,aes(x=O_C_EA,y=Q_Conc_300_Think,color=factor(ID, labels=c('SWP5','SWP7','SS7','PP7','RS5')), na.rm=TRUE)) +
  guides(color = guide_legend(title = "Biochar species"))+
       #  fill=guide_legend(ncol=2))+
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (EA)")+
  ylab("Q (mmol NH4/g biochar)")+
 # ggtitle("Surface O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
         aspect.ratio = 1,
        legend.position=c(1.25, .77),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
  scale_color_manual(values=cbbPalette)+
         scale_x_continuous(expand = c(0.0,0), limits = c(0.1,0.9))
AK_AM_AL_AN_AO_O_C_XPS_Plot_Act
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

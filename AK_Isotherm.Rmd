---
title: "AK_Isotherm"
output: html_document
date: "2022-09-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## AK Isotherm

Libraries

```{r chunksetup, include=FALSE, message=FALSE, warning = FALSE}


libs_1<-c("tidyverse","knitr","psych","reshape2","rmarkdown")

#data manipulation/exploration
libs_2<-c("readxl","readr","tidyr","GGally","naniar","readr")


# plotting
libs_3<-c("ggplot2","viridis","ggpubr","cowplot")#,"ggthemr") 

#ggpubr = package for publishing
#cowplot=  #to create compounded figures

#tables
libs_4<-c("dplyr","stargazer","xlsx","ggplot2","scales","extrafont","writexl")


#isothermFitting
#install.packages(PUPAIM)
library("PUPAIM")

#install.packadevtools")



libs<-c(libs_1,libs_2,libs_3,libs_4)

lapply(libs,require, character.only=TRUE)

cbbPalette <- c("#000000", "#E69F00", "#0072B2", "#009E73","#D55E00","#56B4E9", "#F0E442", "#CC79A7")

cbPalette_plus <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7","#FFDB6D", "#C4961A", "#F4EDCA", "#D16103", "#C3D7A4", "#52854C", "#4E84C4", "#293352")




#ggthemr('dust')
#ggthemr_reset()
```

Molecular weight calculations

```{r}
MW_NH3=14.007+(3*1.008)
MW_NH4=14.007+(4*1.008)
MW_N = 14.007
MW_H = 1.008
MW_P = 30.974
MW_S = 32.006
MW_Na= 22.9
MW_Mg= 24.305
MW_K=39.098
MW_Cl=35.45
MW_C=12.011
MW_S=32.06
MW_O=15.999
MW_SO4_T=MW_S+(4*MW_O)
MW_H2PO4_T=MW_P+(4*MW_O)+(2*MW_H) ## because the formula uses H2PO4 and in the acidified sample we expect this form
MW_Ac=(2*MW_C)+(3*MW_H)+(2*MW_O)
MW_H2CO3=(MW_C+(3*MW_O)+(2*MW_H))
```

Converting to mole

```{r}

moles<-data.frame(MW_Na, MW_NH4,MW_K,MW_Mg)
moles_An<-data.frame(MW_Ac, MW_Cl,MW_H2PO4_T, MW_SO4_T,MW_H2CO3)
```

Setting up mass of biochar and volume of urine dataframe

```{r}

volume<-rep(c(0.02,0.02,0.02,
                  0.02,0.02,0.02,
                  0.005, 0.005, 0.005,
                  0.005,0.005,0.005,
                  0.005,0.005,0.005,
                  0.0011,0.0011,0.0011,
                  0.0011,0.0011,0.0011,
                  0.0011,0.0011,0.0011),times=3)
volume<-data.frame(volume)

mass_biochar<-rep(c(0.1,0.1,0.1,
                          0.2,0.2,0.2,
                          0.1, 0.1, 0.1,
                          0.2,0.2,0.2,
                          0.35,0.35,0.35,
                          0.1,0.1,0.1,
                          0.2,0.2,0.2,
                          0.5,0.5,0.5),times=3)
mass_biochar<-data.frame(mass_biochar)
mass_biochar
                  
```

## Extracting Data from Excel Files

```{r}
#isothermFittinglibrary(PUPAIM)

# setwd("/Users/soliverfusi/OneDrive/Desktop/Fusi/Sorption/Final_Data")

path<-"Final_SorptionIsotherm_Data_AK_to_AO.xlsx"

FullSheet <- path%>%
  excel_sheets()%>% #extracts the sheet name of the file fed to the 'path' function
  set_names() %>%
  map(read_excel,path=path,na=c(common_na_strings,"n.a."))
```

Cations

```{r}


AK_5_10_15<- data.frame(rbind(FullSheet$"220807_AK_5"[c(7:30),], 
                          FullSheet$"220807_AK_10"[c(7:30),],
                          FullSheet$"220807_AK_15"[c(7:30),]))

#changing all the columns to numeric (noteably the Ox columns since I use "In" and "A"-"C",
#it registers as a character column
AK_5_10_15[] <- lapply(AK_5_10_15, function(x) as.numeric(as.character(x)))

AK_20_25_30<- data.frame(rbind(FullSheet$"220427_AK_20"[c(7:30),],
                          FullSheet$"220427_AK_25"[c(7:30),],
                          FullSheet$"220427_AK_30"[c(7:30),]))
AK_20_25_30[] <- lapply(AK_20_25_30, function(x) as.numeric(as.character(x)))

```

Anions

```{r}

AK_5_10_15_An<- data.frame(rbind(FullSheet$"220807_AK_5_An"[c(7:30),],
                               FullSheet$"220807_AK_10_An"[c(7:30),],
                               FullSheet$"220807_AK_15_An"[c(7:30),]))
AK_5_10_15_An[] <- lapply(AK_5_10_15_An, function(x) as.numeric(as.character(x)))

AK_20_25_30_An<- data.frame(rbind(FullSheet$"220427_AK_20_An"[c(7:30),],
                               FullSheet$"220427_AK_25_An"[c(7:30),],
                               FullSheet$"220427_AK_30_An"[c(7:30),]))
AK_20_25_30_An[] <- lapply(AK_20_25_30_An, function(x) as.numeric(as.character(x)))


```

Influents

```{r}
#Cations

AKIn_5_10_15<- data.frame(FullSheet$"220807_AK_5"[c(1:6),])
AKIn_20_25_30<- data.frame(FullSheet$"220427_AK_20"[c(1:6),])

#Anions
AKIn_5_10_15_An<- data.frame(FullSheet$"220807_AK_5_An"[c(1:6),])
AKIn_20_25_30_An<- data.frame(FullSheet$"220427_AK_20_An"[c(1:6),])

                    
```

Controls

```{r}

#Cations
AKctrl_5_10_15<- data.frame(FullSheet$"220807_AK_5"[c(31:39),])
AKctrl_20_25_30<- data.frame(FullSheet$"220427_AK_20"[c(31:39),])

#Anions
AKctrl_5_10_15_An<- data.frame(FullSheet$"220807_AK_5_An"[c(31:39),])
AKctrl_20_25_30_An<- data.frame(FullSheet$"220427_AK_20_An"[c(31:39),])

```

# Adjusting Dilution Errors - Dismissing data (assigning as NA's)

```{r}


#AKctrl_20_25_30[5,4:6]= c(NA,NA,NA)
#AKctrl_20_25_30[5,4:6]= c(NA,NA,NA)



#The ctrl a.1 is overly diluted, so I'm adjusting the error by taking the average of the K concentration in all the other samples, and using it to normalize 

#Adjusting_factor_1<-(mean(AKctrl_20_25_30[c(2:4,5:9,6)])/AKctrl_20_25_30[1,6])
#AKctrl_20_25_30[1,3:6]<-AKctrl_20_25_30[1,4:6]*Adjusting_factor_1

#The ctrl B2 is underly diluted, so taking the average of the other two values to create an adjustment 

#Adjusting_factor_2<-(mean(AKctrl_20_25_30[c(1:4,6:9),6])/AKctrl_20_25_30[5,6])
#AKctrl_20_25_30[5,3:6]<-AKctrl_20_25_30[5,4:6]*Adjusting_factor_2

```

pH

```{r}
AK_5_10_15_pH<- data.frame(rbind(FullSheet$"220728_AK_5_pH"[c(7:30),],
                               FullSheet$"220728_AK_10_pH"[c(7:30),],
                               FullSheet$"220728_AK_15_pH"[c(7:30),]))
AK_5_10_15_pH[] <- lapply(AK_5_10_15_pH, function(x) as.numeric(as.character(x)))

AK_20_25_30_pH<- data.frame(rbind(FullSheet$"220727_AK_20_pH"[c(7:30),],
                               FullSheet$"220728_AK_25_pH"[c(7:30),],
                               FullSheet$"220728_AK_30_pH"[c(7:30),]))
AK_20_25_30_pH[] <- lapply(AK_20_25_30_pH, function(x) as.numeric(as.character(x)))
```

```{r}

#naming columns so they can be referenced easily later
## CATIONS
colnames(AK_5_10_15)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
colnames(AK_20_25_30)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
#----------------------------------------------------------------------
##ANIONS
colnames(AK_5_10_15_An)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))

colnames(AK_20_25_30_An)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))
#----------------------------------------------------------------------
## IN
colnames(AKIn_5_10_15)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

colnames(AKIn_20_25_30)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
#----------------------------------------------------------------------
##pH 
colnames(AK_5_10_15_pH)<-as.character(c('Ox','ID','Rep','pH'))
colnames(AK_20_25_30_pH)<-as.character(c('Ox','ID','Rep','pH'))
#-------------------------------------------------------------------------------
```

## Converting to moles

```{r}
#converting to moles 

#influent Cations

AK_5_In_mol<-mapply('/', AKIn_5_10_15[,4:7],moles)
AK_5_In_mol<-data.frame(cbind(AKIn_5_10_15[,1:3],AK_5_In_mol))
colnames(AK_5_In_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

#----------------------------------------------------------------------
AK_20_In_mol<-mapply('/', AKIn_20_25_30[,4:7],moles)
AK_20_In_mol<-data.frame(cbind(AKIn_20_25_30[,1:3],AK_20_In_mol))
colnames(AK_20_In_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
AK_20_In_mol

#----------------------------------------------------------------------
# Main 8 Cations 

AK_5_mol<-mapply('/', AK_5_10_15[,4:7],moles)

AK_5_mol<-data.frame(cbind(AK_5_10_15[,1:3],AK_5_mol))
colnames(AK_5_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
AK_5_mol

#----------------------------------------------------------------------
AK_20_mol<-mapply('/', AK_20_25_30[,4:7],moles)

AK_20_mol<-data.frame(cbind(AK_20_25_30[,1:3],AK_20_mol))
colnames(AK_20_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))
AK_20_mol
#----------------------------------------------------------------------

#influent Anions

AK_5_An_In_mol<-mapply('/', AKIn_5_10_15_An[,4:8],moles_An)
AK_5_An_In_mol<-data.frame(cbind(AKIn_5_10_15_An[,1:3],AK_5_An_In_mol))
colnames(AK_5_An_In_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))
#----------------------------------------------------------------------
AK_20_An_In_mol<-mapply('/', AKIn_20_25_30_An[,4:8],moles_An)
AK_20_An_In_mol<-data.frame(cbind(AKIn_20_25_30_An[,1:3],AK_20_An_In_mol))
colnames(AK_20_An_In_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'))

#----------------------------------------------------------------------

# Main 8 Anions

AK_5_An_mol<-mapply('/', AK_5_10_15_An[,4:8],moles_An)

AK_5_An_mol<-data.frame(cbind(AK_5_10_15_An[,1:3],AK_5_An_mol))
colnames(AK_5_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))
AK_5_An_mol

#----------------------------------------------------------------------

AK_20_An_mol<-mapply('/', AK_20_25_30_An[,4:8],moles_An)

AK_20_An_mol<-data.frame(cbind(AK_20_25_30_An[,1:3],AK_20_An_mol))
colnames(AK_20_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))
AK_20_An_mol

#Ctrls Cations

AK_ctrl_5_mol<-mapply('/', AKctrl_5_10_15[,4:7],moles)
AK_ctrl_5_mol<-data.frame(cbind(AKctrl_5_10_15[,1:3],AK_ctrl_5_mol))
colnames(AK_ctrl_5_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

AK_ctrl_20_mol<-mapply('/', AKctrl_20_25_30[,4:7],moles)
AK_ctrl_20_mol<-data.frame(cbind(AKctrl_20_25_30[,1:3],AK_ctrl_20_mol))
colnames(AK_ctrl_20_mol)<-as.character(c('Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium'))

#Ctrl Anions 

AK_ctrl_5_An_mol<-mapply('/', AKctrl_5_10_15_An[,4:8],moles_An)
AK_ctrl_5_An_mol<-data.frame(cbind(AKctrl_5_10_15_An[,1:3],AK_ctrl_5_An_mol))
colnames(AK_ctrl_5_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))

AK_ctrl_20_An_mol<-mapply('/', AKctrl_20_25_30_An[,4:8],moles_An)
AK_ctrl_20_An_mol<-data.frame(cbind(AKctrl_20_25_30_An[,1:3],AK_ctrl_20_An_mol))
colnames(AK_ctrl_20_An_mol)<-as.character(c('Ox','ID','Rep','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate'))

```

## Combining Influent 6 with Control 3 for each reactor size, and Taking the means

Combining Ctrl's and Influent

```{r}

#taking the mean of the 6 influent samples

#Cations

AK_5_In_avg<-data.frame(lapply(AK_5_In_mol[,4:7], mean))
AK_20_In_avg<-data.frame(lapply(AK_20_In_mol[,4:7], mean))

#Anions
AK_5_In_An_avg<-data.frame(lapply(AK_5_An_In_mol[,4:8], mean))
AK_20_In_An_avg<-data.frame(lapply(AK_20_An_In_mol[,4:8], mean))

#taking the mean of A, B, and C

#Cations
AK_5_Ctrl_Avg<-data.frame( AK_ctrl_5_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium",'Magnesium'),mean,na.rm=TRUE))
AK_5_Ctrl_Avg

AK_20_Ctrl_Avg<-data.frame(AK_ctrl_20_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium",'Magnesium'),mean,na.rm=TRUE))
AK_20_Ctrl_Avg

#Anions
AK_5_An_Ctrl_Avg<-data.frame(AK_ctrl_5_An_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c('Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'),mean,na.rm=TRUE))
AK_5_An_Ctrl_Avg

AK_20_An_Ctrl_Avg<-data.frame(AK_ctrl_20_An_mol %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c('Acetate','Chloride','Phosphate', 'Sulfate','Carbonate'),mean,na.rm=TRUE))
AK_20_An_Ctrl_Avg


#Cations 

#Combining the average of the In and each Ctrl (A,B,or C) and then taking the mean

#A

AK_5_In_ABC_A<-rbind(AK_5_In_avg[1,],AK_5_Ctrl_Avg[1,2:5])
AK_5_In_A<-t(data.frame(colMeans(AK_5_In_ABC_A, na.rm=TRUE)))

AK_20_In_ABC_A<-rbind(AK_20_In_avg[1,],AK_20_Ctrl_Avg[1,2:5])
AK_20_In_A<-t(data.frame(colMeans(AK_20_In_ABC_A, na.rm=TRUE)))

#B
AK_5_In_ABC_B<-rbind(AK_5_In_avg[1,],AK_5_Ctrl_Avg[2,2:5])
AK_5_In_B<-t(data.frame(colMeans(AK_5_In_ABC_B, na.rm=TRUE)))

AK_20_In_ABC_B<-rbind(AK_20_In_avg[1,],AK_20_Ctrl_Avg[2,2:5])
AK_20_In_B<-t(data.frame(colMeans(AK_20_In_ABC_B, na.rm=TRUE)))

#C
AK_5_In_ABC_C<-rbind(AK_5_In_avg[1,],AK_5_Ctrl_Avg[3,2:5])
AK_5_In_C<-t(data.frame(colMeans(AK_5_In_ABC_C, na.rm=TRUE)))

AK_20_In_ABC_C<-rbind(AK_20_In_avg[1,],AK_20_Ctrl_Avg[3,2:5])
AK_20_In_C<-t(data.frame(colMeans(AK_20_In_ABC_C, na.rm=TRUE)))

#Anions 

#A
AK_5_An_In_ABC_A<-rbind(AK_5_In_An_avg[,],AK_5_An_Ctrl_Avg[1,2:6])
AK_5_An_In_A<-t(data.frame(colMeans(AK_5_An_In_ABC_A, na.rm=TRUE)))

AK_20_An_In_ABC_A<-rbind(AK_20_In_An_avg[,],AK_20_An_Ctrl_Avg[1,2:6])
AK_20_An_In_A<-t(data.frame(colMeans(AK_20_An_In_ABC_A, na.rm=TRUE)))

#B
AK_5_An_In_ABC_B<-rbind(AK_5_In_An_avg[,],AK_5_An_Ctrl_Avg[2,2:6])
AK_5_An_In_B<-t(data.frame(colMeans(AK_5_An_In_ABC_B, na.rm=TRUE)))

AK_20_An_In_ABC_B<-rbind(AK_20_In_An_avg[,],AK_20_An_Ctrl_Avg[2,2:6])
AK_20_An_In_B<-t(data.frame(colMeans(AK_20_An_In_ABC_B, na.rm=TRUE)))

#C
AK_5_An_In_ABC_C<-rbind(AK_5_In_An_avg[,],AK_5_An_Ctrl_Avg[3,2:6])
AK_5_An_In_C<-t(data.frame(colMeans(AK_5_An_In_ABC_C, na.rm=TRUE)))

AK_20_An_In_ABC_C<-rbind(AK_20_In_An_avg[,],AK_20_An_Ctrl_Avg[3,2:6])
AK_20_An_In_C<-t(data.frame(colMeans(AK_20_An_In_ABC_C, na.rm=TRUE)))

#Creating a dataframe with the new 'In' value, which is the average of the In and the ctrls

#Cations
AK_5_In_ABC<-data.frame(rbind(AK_5_In_A,AK_5_In_B,AK_5_In_C))
AK_20_In_ABC<-data.frame(rbind(AK_20_In_A,AK_20_In_B,AK_20_In_C))

row.names(AK_5_In_ABC)<-c("A","B","C")
row.names(AK_20_In_ABC)<-c("A","B","C")

#Anions
AK_5_An_In_ABC<-data.frame(rbind(AK_5_An_In_A,AK_5_An_In_B,AK_5_An_In_C))
AK_20_An_In_ABC<-data.frame(rbind(AK_20_An_In_A,AK_20_An_In_B,AK_20_An_In_C))

row.names(AK_5_An_In_ABC)<-c("A","B","C")
row.names(AK_20_An_In_ABC)<-c("A","B","C")


```

## Influent (6) Statistics in moles

```{r}
#-------------------------------------------------------------------------------
#pivoting 5/10/15% influent samples to long format for easier manipulation
AKIn5Long<-
  AK_5_In_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium,Magnesium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AK5Stats <- AKIn5Long %>%
  group_by(Cation_Species) %>%
  summarise(AK5In_mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AK5In_std=sd(Concentration, na.rm=FALSE),
            AK_perc_std=AK5In_std/ AK5In_mean*100)
AK5Stats<-data.frame(AK5Stats)
#-------------------------------------------------------------------------------
#pivoting 20/25/30% influent samples to long format for easier manipulation
AKIn20Long<-
  AK_20_In_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium,Magnesium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

AKIn20_Stats <-data.frame( AKIn20Long %>%
  group_by(Cation_Species) %>%
  summarise(AKIn20_Mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AKIn20_Std=sd(Concentration, na.rm=FALSE)))
AKIn20_Stats$Percent<-mapply('/', AKIn20_Stats$AKIn20_Std,AKIn20_Stats$AKIn20_Mean)


#calculating the mean and stdev to make sure that variability is acceptable (<5% for Na and K)
AK20Stats <- data.frame(AKIn20Long %>%
  group_by(Cation_Species) %>%
  summarise(AK20In_mean=mean(Concentration,na.rm=FALSE),
            #.groups='rowwise',
            AK20In_std=sd(Concentration, na.rm=FALSE),
            AK_perc_std=AK20In_std/ AK20In_mean*100))
#or can also do
#AKIn20_Stats$Percent<-mapply('/', AKIn20_Stats$AKIn20_Std,AKIn20_Stats$AKIn20_Mean)
AK5Stats
AK20Stats
```

## Control Statistics

```{r}

#pivoting
AKctrl5Long<-
  AK_ctrl_5_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium,Magnesium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AK5ctrlStats <- AKctrl5Long %>%
  group_by(Cation_Species) %>%
  summarise(AK5ctrl_mean=mean(Concentration,na.rm=TRUE),
            #.groups='rowwise',
            AK5ctrl_std=sd(Concentration, na.rm=TRUE),
            AK_perc_std=AK5ctrl_std/ AK5ctrl_mean*100)
AK5ctrlStats<-data.frame(AK5ctrlStats)


#pivoting
AKctrl20Long<-
  AK_ctrl_20_mol%>%
  pivot_longer(
    cols=c(Sodium,Ammonium,Potassium,Magnesium),
    names_to ="Cation_Species",
    values_to="Concentration",
    names_repair="minimal")

#calculating the mean and stdev to make sure that variability is acceptable (<5%)
AK20ctrlStats <- AKctrl20Long %>%
  group_by(Cation_Species) %>%
  summarise(AK20ctrl_mean=mean(Concentration,na.rm=TRUE),
            #.groups='rowwise',
            AK20ctrl_std=sd(Concentration, na.rm=TRUE),
            AK_perc_std=AK20ctrl_std/ AK20ctrl_mean*100)
AK20ctrlStats<-data.frame(AK20ctrlStats)

```

## Combining All concentration triplicates into One Large Data Frame

##Combining Anions and Cations into One Dataframe for PHREEQC

-   all the molar concentration of the ions, in triplicate, combined into one dataframe

-   saving the dataframe as an excel file that can be imported into PHREEQC to calculate equilibrium activity.

```{r}
#Combining cations and anions into one dataframe for convenient activity calculations

#----------------------------------------------------------------------
Phreeqc_num<-data.frame(seq(1,nrow(AK_5_mol)))
colnames(Phreeqc_num)<-("Number")

AK_5_Ion_All <- data.frame(rbind(AK_5_mol[,]),
                           AK_5_An_mol[,-c(1:3)],
                           AK_5_10_15_pH[,4])
AK_5_Ion_All<-data.frame(cbind(Phreeqc_num[,],AK_5_Ion_All))
colnames(AK_5_Ion_All)<-as.character(c("PHREEQC_number",'Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate', "pH"))


AK_5_10_15_for_PHREEQC<-data.frame(AK_5_Ion_All[,c(1,5:14)])

colnames(AK_5_10_15_for_PHREEQC)=c("Number",'Na','N(-3)','K','Mg','Acetate','Cl','P', 'S(6)', 'C(4)', "pH")

write.table(AK_5_10_15_for_PHREEQC,"/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Final_Data/Activities/AK_5_10_15_for_PHREEQC.txt", sep = "\t",
            row.names = FALSE, col.names = FALSE)


write_xlsx (AK_5_Ion_All,"/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Final_Data/Activities/AK_5_10_15_for_PHREEQC.xlsx")


#----------------------------------------------------------------------
# 
AK_20_Ion_All <- data.frame(rbind(AK_20_mol[,]),
                            AK_20_An_mol[,-c(1:3)],
                            AK_20_25_30_pH[,4])
AK_20_Ion_All<-data.frame(cbind(Phreeqc_num[,],AK_20_Ion_All))
colnames(AK_20_Ion_All)<-as.character(c("PHREEQC_number",'Ox','ID','Rep','Sodium','Ammonium','Potassium','Magnesium','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate', "pH"))
# 
##editing to try to fit the exact PHREEQC format to minimize manual editing
# colnames(AK_20_Ion_All)<-as.character(c("PHREEQC_number",'Ox','ID','Rep','Sodium','Ammonium','Potassium','Acetate','Chloride','Phosphate', 'Sulfate', 'Carbonate', "pH"))
# 
# write_xlsx (AK_20_Ion_All,"/Users/soliverfusi/OneDrive/Desktop/Fusi/Sorption/Final_Data/Activities/AK_20_25_30_for_PHREEQC.xlsx")


AK_20_25_30_for_PHREEQC<-data.frame(AK_20_Ion_All[,c(1,5:14)])
colnames(AK_20_25_30_for_PHREEQC)<-c("Number",'Na','N(-3)','K','Mg','Acetate','Cl','P', 'S(6)', 'C(4)', "pH")

write.table(AK_20_25_30_for_PHREEQC,"/Users/soliverchefusi/Library/CloudStorage/OneDrive-Personal/Desktop/Fusi/Sorption/AK_to_AO_Isotherm/Final_Data/Activities/AK_20_25_30_for_PHREEQC.txt", sep = "\t",
            row.names = FALSE, col.names = FALSE)

```

##PHREEQC

-- Copy over the data in the text file into the template labled 'AX_TEMPLATE_Activities.txt' and rename the file. Easiest to open the template in R and save as a new .txt file.

-Note that the r output file e.g. "AM_20_30_for_PHREEQC.txt" is different from the PHREEQC input file "AM_20_30_Activities.txt". Make sure to update the later with the information in the former

-OR Add the followiing to the top of the .txt file that is created

SOLUTION_SPREAD -units mmol/L Number Na N(-3) K Acetate Cl P S(6) C(4) pH charge

-- Add the followiing to the bottom of the .txt file that is created

NOTE: Make sure to update the file name

SELECTED_OUTPUT #read more: <https://water.usgs.gov/water-resources/software/PHREEQC/documentation/phreeqc3-html/phreeqc3-45.htm#50593793_20239>

```         
-file AK_20_25_30_Activity.out
-simulation false
-state  false
-solution   false
-distance   false
-time   false
-step   false
-pe false
-pH false
-alkalinity false
-ionic_strength false
-activities NH4+
#--activities   Na+ NH4+    K+  Acetate-    Cl- HPO4-2  SO4-2   HCO3-   pH
#-calculate_values  ("thefunction") #read more: https://water.usgs.gov/water-resources/software/PHREEQC/documentation/phreeqc3-html/phreeqc3-7.htm#50593793_35035
```

END

NOTE: The output file will default to save in the same folder as the PHREEQC application\

-   Copy the outputs, which will be ionic strength and log ALK into the ALK tab in the main excel sheet

## Activities

```{r}

AK_5_10_15_Act_Ion_str<- data.frame(rbind(FullSheet$"AK_5_Act"[c(1:24),c(4:7)],
                                   FullSheet$"AK_10_Act"[c(1:24),c(4:7)],
                                   FullSheet$"AK_15_Act"[c(1:24),c(4:7)]))
AK_5_10_15_Act_Ion_str[,c(2:4)]<-1000*(10^(AK_5_10_15_Act_Ion_str[,c(2:4)]))
colnames(AK_5_10_15_Act_Ion_str)<-as.character(c("Ionic_str","Act_NH4","Act_Na","Act_K"))

AK_5_All<-data.frame(cbind(AK_5_Ion_All,AK_5_10_15_Act_Ion_str))


AK_20_25_30_Act_Ion_str<- data.frame(rbind(FullSheet$"AK_20_Act"[c(1:24),c(4:7)],
                                   FullSheet$"AK_25_Act"[c(1:24),c(4:7)],
                                   FullSheet$"AK_30_Act"[c(1:24),c(4:7)]))
AK_20_25_30_Act_Ion_str[,c(2:4)]<-1000*(10^(AK_20_25_30_Act_Ion_str[,c(2:4)]))
colnames(AK_20_25_30_Act_Ion_str)<-as.character(c("Ionic_str","Act_NH4","Act_Na","Act_K"))

AK_20_All<-data.frame(cbind(AK_20_Ion_All,AK_20_25_30_Act_Ion_str))
```

## Assigning the Influent

Creating a dataframe of just the influents

```{r}

#creating the in columns, considering 2 reps of C, 3 of B, 3 of A (in this order), and how each is in triplicate

#Cations

AK_5_Cat_In<-data.frame(rbind(data.frame(lapply(AK_5_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AK_5_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AK_5_In_ABC[1,],rep,times=9))))

AK_5_Cat_In<-data.frame(lapply(AK_5_Cat_In,rep, times=3))
colnames(AK_5_Cat_In)<-c("AK_Na_In","AK_NH4_In","AK_K_In","AK_Mg_In")
#-------------------------------------------------------------------------------
AK_20_Cat_In<-data.frame(rbind(data.frame(lapply(AK_20_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AK_20_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AK_20_In_ABC[1,],rep,times=9))))

AK_20_Cat_In<-data.frame(lapply(AK_20_Cat_In,rep, times=3))
colnames(AK_20_Cat_In)<-c("AK_Na_In","AK_NH4_In","AK_K_In","AK_Mg_In")
#-------------------------------------------------------------------------------


AK_5_An_In<-data.frame(rbind(data.frame(lapply(AK_5_An_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AK_5_An_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AK_5_An_In_ABC[1,],rep,times=9))))

AK_5_An_In<-data.frame(lapply(AK_5_An_In,rep, times=3))
colnames(AK_5_An_In)<-c("AK_Ace_In","AK_Cl_In","AK_P_In","AK_S_In","AK_Carb_In")

#-------------------------------------------------------------------------------
AK_20_An_In<-data.frame(rbind(data.frame(lapply(AK_20_An_In_ABC[3,],rep,times=6)),
                         data.frame(lapply(AK_20_An_In_ABC[2,],rep,times=9)),
                         data.frame(lapply(AK_20_An_In_ABC[1,],rep,times=9))))

AK_20_An_In<-data.frame(lapply(AK_20_An_In,rep, times=3))
colnames(AK_20_An_In)<-c("AK_Ace_In","AK_Cl_In","AK_P_In","AK_S_In","AK_Carb_In")
#-------------------------------------------------------------------------------

```

## Adding biochar mass, urine volume, and initial urine

```{r}
#Cations

AK_5_All<-data.frame(cbind(AK_5_All,AK_5_Cat_In,AK_5_An_In,volume, mass_biochar))
AK_20_All<-data.frame(cbind(AK_20_All,AK_20_Cat_In,AK_20_An_In, volume, mass_biochar))

```

## Calculating the Normalized Ion Concentrations and Dose

```{r}
AK_5_All[30:38]<-data.frame(mapply('/',AK_5_All[5:13],AK_5_All[19:27]))
AK_20_All[30:38]<-data.frame(mapply('/',AK_20_All[5:13],AK_20_All[19:27]))

colnames(AK_5_All)[30:38]<-c("Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm")
colnames(AK_20_All)[30:38]<-c("Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm")

```

## Determining Dose

```{r}
AK_5_All$Dose<-(mapply('/',AK_5_All$mass_biochar,AK_5_All$volume))
AK_20_All$Dose<-(mapply('/',AK_20_All$mass_biochar,AK_20_All$volume))
```

## Calculating Q of each Triplicate

Note: the Q is based on the C_in which is the average of the initial value and the control

```{r}


Q_function<-function(df,Q,C_In,C_eq,volume,m_s) {
  df[[Q]]<-((df[[C_In]]-df[[C_eq]])*df[[volume]]/df[[m_s]])
  }

AK_20_All$Q_NH4<-Q_function(AK_20_All,"Q_NH4","AK_NH4_In","Ammonium","volume","mass_biochar")

AK_5_All$Q_NH4<-Q_function(AK_5_All,"Q_NH4","AK_NH4_In","Ammonium","volume","mass_biochar")
#----------------------------------------------------------------------

AK_20_All$Q_Na<-Q_function(AK_20_All,"Q_Na","AK_Na_In","Sodium","volume","mass_biochar")

AK_5_All$Q_Na<-Q_function(AK_5_All,"Q_Na","AK_Na_In","Sodium","volume","mass_biochar")
#----------------------------------------------------------------------

AK_20_All$Q_K<-Q_function(AK_20_All,"Q_K","AK_K_In","Potassium","volume","mass_biochar")

AK_5_All$Q_K<-Q_function(AK_5_All,"Q_K","AK_K_In","Potassium","volume","mass_biochar")
#----------------------------------------------------------------------

AK_20_All$Q_Mg<-Q_function(AK_20_All,"Q_Mg","AK_Mg_In","Magnesium","volume","mass_biochar")

AK_5_All$Q_Mg<-Q_function(AK_5_All,"Q_Mg","AK_Mg_In","Magnesium","volume","mass_biochar")


#October 2023; adding Q for Anions

AK_20_All$Q_Cl<-Q_function(AK_20_All,"Q_Cl","AK_Cl_In","Chloride","volume","mass_biochar")

AK_5_All$Q_Cl<-Q_function(AK_5_All,"Q_Cl","AK_Cl_In","Chloride","volume","mass_biochar")
#----------------------------------------------------------------------

AK_20_All$Q_PO4<-Q_function(AK_20_All,"Q_PO4","AK_P_In","Phosphate","volume","mass_biochar")

AK_5_All$Q_PO4<-Q_function(AK_5_All,"Q_PO4","AK_P_In","Phosphate","volume","mass_biochar")
#----------------------------------------------------------------------

AK_20_All$Q_S<-Q_function(AK_20_All,"Q_S","AK_S_In","Sulfate","volume","mass_biochar")

AK_5_All$Q_S<-Q_function(AK_5_All,"Q_S","AK_S_In","Sulfate","volume","mass_biochar")
#----------------------------------------------------------------------

AK_20_All$Q_Ace<-Q_function(AK_20_All,"Q_Ace","AK_Ace_In","Acetate","volume","mass_biochar")

AK_5_All$Q_Ace<-Q_function(AK_5_All,"Q_Ace","AK_Ace_In","Acetate","volume","mass_biochar")


#Q<-function(df, Q_col,C_In,C_eq,volume,m_s) {df$Q_col<-((df$C_In-df$C_eq)*df$volume/df$m_s)}

#Q_function(AK_20_All,AK_20_NH4_In,Ammonium,volume,mass_biochar)
```

## Average and stdev of Replicates

-   Calculating the average and stdev of the replicates an combining them into one dataframe

-   calculating Q_sd as a percent of Q to determine where to cuz off the data

```{r}

#taking the average 
AK_5_All_Avg<-data.frame(
 AK_5_All %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c("Ox","ID","Sodium","Ammonium","Potassium","Magnesium","Acetate","Chloride","Phosphate", "Sulfate", "Carbonate","pH","Ionic_str", "Act_NH4","Act_Na","Act_K","AK_Na_In","AK_NH4_In","AK_K_In","AK_Mg_In","AK_Ace_In","AK_Cl_In","AK_P_In","AK_S_In","AK_Carb_In","volume","mass_biochar","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm","Dose","Q_NH4","Q_Na","Q_K","Q_Mg","Q_Cl","Q_PO4","Q_S","Q_Ace"),mean))
AK_5_All_Avg

#taking stdev
AK_5_All_sd<-data.frame(
 AK_5_All%>%
    group_by(group = gl(n()/3, 3)) %>% #applies function to every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium","Magnesium","Acetate","Chloride","Phosphate", "Sulfate", "Carbonate","pH","Ionic_str", "Act_NH4","Act_Na","Act_K","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm","Q_NH4","Q_Na","Q_K","Q_Mg","Q_Cl","Q_PO4","Q_S","Q_Ace"),sd))
AK_5_All_sd

colnames(AK_5_All_sd)<-as.character(c("group","Sodium_sd","Ammonium_sd","Potassium_sd","Magnesium_sd","Acetate_sd","Chloride_sd","Phosphate_sd", "Sulfate_sd", "Carbonate_sd","pH_sd", "Ionic_str_sd","Act_NH4_sd","Act_Na_sd","Act_K_sd","AK_Na_Norm_sd","AK_NH4_Norm_sd","AK_K_Norm_sd","AK_Mg_Norm_sd","K_Ace_Norm_sd","AK_Cl_Norm_sd","AK_P_Norm_sd","AK_S_Norm_sd","AK_Carb_Norm_sd","Q_NH4_sd","Q_Na_sd","Q_K_sd","Q_Mg_sd","Q_Cl_sd","Q_PO4_sd","Q_S_sd","Q_Ace_sd"))

#combining average and std dataframes


AK_5_All_Avg_sd<-data.frame(cbind(AK_5_All_Avg,AK_5_All_sd[,-1]))

#Calculating the %percent SD of Q

AK_5_All_Avg_sd$Q_NH4_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_NH4_sd,AK_5_All_Avg_sd$Q_NH4))
AK_5_All_Avg_sd$Q_NH4_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_NH4_sd_perc,100)))  

AK_5_All_Avg_sd$Q_Na_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_Na_sd,AK_5_All_Avg_sd$Q_Na))
AK_5_All_Avg_sd$Q_Na_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_Na_sd_perc,100))) 

AK_5_All_Avg_sd$Q_K_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_K_sd,AK_5_All_Avg_sd$Q_K))
AK_5_All_Avg_sd$Q_K_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_K_sd_perc,100))) 

AK_5_All_Avg_sd$Q_Mg_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_Mg_sd,AK_5_All_Avg_sd$Q_Mg))
AK_5_All_Avg_sd$Q_Mg_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_Mg_sd_perc,100))) 

#October 2023; adding Q for Anions
AK_5_All_Avg_sd$Q_Cl_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_Cl_sd,AK_5_All_Avg_sd$Q_Cl))
AK_5_All_Avg_sd$Q_Cl_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_Cl_sd_perc,100)))  

AK_5_All_Avg_sd$Q_PO4_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_PO4_sd,AK_5_All_Avg_sd$Q_PO4))
AK_5_All_Avg_sd$Q_PO4_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_PO4_sd_perc,100))) 

AK_5_All_Avg_sd$Q_S_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_S_sd,AK_5_All_Avg_sd$Q_S))
AK_5_All_Avg_sd$Q_S_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_S_sd_perc,100))) 

AK_5_All_Avg_sd$Q_Ace_sd_perc<-(mapply('/', AK_5_All_Avg_sd$Q_Ace_sd,AK_5_All_Avg_sd$Q_Ace))
AK_5_All_Avg_sd$Q_Ace_sd_perc<-(abs(mapply('*',AK_5_All_Avg_sd$Q_Ace_sd_perc,100))) 

#------------------------------------------------------------------------------------------------------------

AK_20_All_Avg<-data.frame(
 AK_20_All %>%
    group_by(group = gl(n()/3, 3)) %>% #takes average of every 3 rows
    summarise_at(c("Ox","ID","Sodium","Ammonium","Potassium","Magnesium","Acetate","Chloride","Phosphate", "Sulfate", "Carbonate","pH","Ionic_str", "Act_NH4","Act_Na","Act_K","AK_Na_In","AK_NH4_In","AK_K_In","AK_Mg_In","AK_Ace_In","AK_Cl_In","AK_P_In","AK_S_In","AK_Carb_In","volume","mass_biochar","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm","Dose","Q_NH4","Q_Na","Q_K","Q_Mg","Q_Cl","Q_PO4","Q_S","Q_Ace"),mean))
AK_20_All_Avg

#taking stdev
AK_20_All_sd<-data.frame(
 AK_20_All%>%
    group_by(group = gl(n()/3, 3)) %>% #applies function to every 3 rows
    summarise_at(c("Sodium","Ammonium","Potassium","Magnesium","Acetate","Chloride","Phosphate", "Sulfate", "Carbonate","pH","Ionic_str", "Act_NH4","Act_Na","Act_K","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm","Q_NH4","Q_Na","Q_K","Q_Mg","Q_Cl","Q_PO4","Q_S","Q_Ace"),sd))
AK_20_All_sd

colnames(AK_20_All_sd)<-as.character(c("group","Sodium_sd","Ammonium_sd","Potassium_sd","Magnesium_sd","Acetate_sd","Chloride_sd","Phosphate_sd", "Sulfate_sd", "Carbonate_sd","pH_sd", "Ionic_str_sd","Act_NH4_sd","Act_Na_sd","Act_K_sd","AK_Na_Norm_sd","AK_NH4_Norm_sd","AK_K_Norm_sd","AK_Mg_Norm_sd","K_Ace_Norm_sd","AK_Cl_Norm_sd","AK_P_Norm_sd","AK_S_Norm_sd","AK_Carb_Norm_sd","Q_NH4_sd","Q_Na_sd","Q_K_sd","Q_Mg_sd","Q_Cl_sd","Q_PO4_sd","Q_S_sd","Q_Ace_sd"))


#combining average adn std dataframes


AK_20_All_Avg_sd<-data.frame(cbind(AK_20_All_Avg,AK_20_All_sd[,-1]))

#Calculating the %percent SD of Q

AK_20_All_Avg_sd$Q_NH4_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_NH4_sd,AK_20_All_Avg_sd$Q_NH4))
AK_20_All_Avg_sd$Q_NH4_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_NH4_sd_perc,100)))  

AK_20_All_Avg_sd$Q_Na_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_Na_sd,AK_20_All_Avg_sd$Q_Na))
AK_20_All_Avg_sd$Q_Na_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_Na_sd_perc,100))) 

AK_20_All_Avg_sd$Q_K_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_K_sd,AK_20_All_Avg_sd$Q_K))
AK_20_All_Avg_sd$Q_K_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_K_sd_perc,100))) 

AK_20_All_Avg_sd$Q_Mg_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_Mg_sd,AK_20_All_Avg_sd$Q_Mg))
AK_20_All_Avg_sd$Q_Mg_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_Mg_sd_perc,100)))  

#October 2023; adding Q for Anions
AK_20_All_Avg_sd$Q_Cl_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_Cl_sd,AK_20_All_Avg_sd$Q_Cl))
AK_20_All_Avg_sd$Q_Cl_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_Cl_sd_perc,100)))  

AK_20_All_Avg_sd$Q_PO4_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_PO4_sd,AK_20_All_Avg_sd$Q_PO4))
AK_20_All_Avg_sd$Q_PO4_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_PO4_sd_perc,100))) 

AK_20_All_Avg_sd$Q_S_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_S_sd,AK_20_All_Avg_sd$Q_S))
AK_20_All_Avg_sd$Q_S_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_S_sd_perc,100))) 

AK_20_All_Avg_sd$Q_Ace_sd_perc<-(mapply('/', AK_20_All_Avg_sd$Q_Ace_sd,AK_20_All_Avg_sd$Q_Ace))
AK_20_All_Avg_sd$Q_Ace_sd_perc<-(abs(mapply('*',AK_20_All_Avg_sd$Q_Ace_sd_perc,100))) 

```

### Converting Ox condition to factors to be able to group for plotting

```{r}
AK_5_All_Avg_sd$Ox<-as.factor(AK_5_All_Avg$Ox) 
AK_20_All_Avg_sd$Ox<-as.factor(AK_20_All_Avg$Ox) 

```

## Oct 2023 Edit

Resaving file as RDS to work on in separate .rmd file

```{r}
AK_All_Avg<-rbind(AK_5_All_Avg_sd,AK_20_All_Avg_sd)
saveRDS(AK_All_Avg, file = "AK_ALL.RDS")

```

Outliers

```{r}
AK_5_All_Avg_sd[2,17]<-NA
AK_5_All_Avg_sd[18,17]<-NA
```

##Plotting Dose vs. Ion Concentration \## Creating a Datadrame with only Ox, Dose, and Normalized concentrations - This allows me to convert to long format and plot everything on one graph

```{r}

AK_5_Ion_Norm<-AK_5_All_Avg_sd[,c("Ox","Dose","pH","Act_NH4","Ionic_str","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm")]

AK_20_Ion_Norm<-AK_20_All_Avg_sd[,c("Ox","Dose","pH","Act_NH4","Ionic_str","Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm")]

AK_All_Ion_Norm<-rbind(AK_5_Ion_Norm,AK_20_Ion_Norm)


```

```{r}
AK_All_Ion_Norm_long<-
 AK_All_Ion_Norm%>%
  pivot_longer(
    cols=c("Na_Norm","NH4_Norm","K_Norm","Mg_Norm","Ace_Norm","Cl_Norm","P_Norm","S_Norm","Carb_Norm"),
    names_to ="Ion_Species",
    values_to="Norm_Concentration",
    names_repair="minimal")

AK_All_Ion_Norm_long$Ion_Species<-as.factor(AK_All_Ion_Norm_long$Ion_Species)

```

plotting

```{r}
coeff<-4
#the second Y axis is like the first multiplied by 10 (trans=~.*4).


AK_5_Ion_Norm_plot<- ggplot(AK_All_Ion_Norm_long,aes(x=Dose,y=Norm_Concentration, color = Ion_Species, na.rm=TRUE)) +
   geom_point(shape=16, size =4)+
   geom_line(aes(y=pH / coeff)) + #the value be display in the second variable geom_line() call must be divided by 4 to mimic the range of the first variable.
    geom_line(aes(y=Ionic_str)) + 
  facet_wrap(facets = vars(Ox))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration & Ionic Strength (M)")+
  ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
      scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         sec.axis = sec_axis(~.*coeff, name="pH"))+
      scale_color_manual(values=cbPalette_plus)
AK_5_Ion_Norm_plot
```

```{r}
coeff<-4
#the second Y axis is like the first multiplied by 10 (trans=~.*4).


AK_5_Ion_Norm_plot<- ggplot(AK_All_Ion_Norm_long,aes(x=Dose,y=Norm_Concentration, color = Ion_Species, na.rm=TRUE)) +
   geom_point(shape=16, size =2)+
  #the value be display in the second variable geom_line() call must be divided by 4 to mimic the range of the first variable.
  facet_wrap(facets = vars(Ox),labeller = labeller(Ox =c("5"="0.20","10"="0.23","15"="0.25","20"="0.27","25"="0.28","30"="0.30")))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Normalized Ion Concentration")+
  #ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=12),
        axis.text.y=element_text(size=12),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
      scale_color_manual(values=cbPalette_plus)

```

Plotting pH and Ionic strength

```{r}
coeff<-10
#the second Y axis is like the first multiplied by 10 (trans=~.*4).


AK_5_Ion_Norm_plot_pH<- ggplot(AK_All_Ion_Norm_long,aes(x=Dose,y=Ionic_str, na.rm=TRUE)) +
   geom_point(aes(y=pH / coeff),shape=16, size =4,color="chocolate3") + #the value be display in the second variable geom_line() call must be divided by 4 to mimic the range of the first variable.
  geom_point(shape=16, size =4,color="darkolivegreen")+
  facet_wrap(facets = vars(Ox),labeller = labeller(Ox =c("5"="0.20","10"="0.23","15"="0.25","20"="0.27","25"="0.28","30"="0.30")))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Ionic Strength (M)")+
  #ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
   #scale_fill_discrete(labels=c('SWP5','SWP7','SS7','PP7','RS5','fff'))+
  theme(text=element_text(family = "Times"),
           # aspect.ratio = 1,
        legend.position='bottom',
        axis.text.x=element_text(size=12),
        axis.text.y=element_text(size=12),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
   # theme(axis.title.y=element_text(color="darkolivegreen"))+
      scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         sec.axis = sec_axis(~.*coeff, name="pH"))+
  theme(axis.text.y.right = element_text(color = "chocolate3"))+
   theme(axis.text.y.left = element_text(color = "darkolivegreen"))+
      scale_color_manual(values=cbPalette_plus)
AK_5_Ion_Norm_plot_pH
```

Adding activity

```{r}
coeff<-10
#the second Y axis is like the first multiplied by 10 (trans=~.*4).
AK_All_Ion_Norm_long$Act_NH4_M<-(AK_All_Ion_Norm_long$Act_NH4)#/1000)

AK_5_Ion_Norm_plot_Act<- ggplot(AK_All_Ion_Norm_long,aes(x=Dose,y=Ionic_str, na.rm=TRUE)) +
   geom_point(aes(y=pH / coeff),shape=15, size =4,color="chocolate3") + #the value be display in the second variable geom_line() call must be divided by 4 to mimic the range of the first variable.
  geom_point(shape=16, size =4,color="darkolivegreen")+
   geom_point(aes(y=Act_NH4_M),shape=17, size =4,color="darkolivegreen") +
  facet_wrap(facets = vars(Ox),labeller = labeller(Ox =c("5"="0.20","10"="0.23","15"="0.25","20"="0.27","25"="0.28","30"="0.30")))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g biochar/L Urine)")+
  ylab("Ionic Strength & NH4+ Activity (M)")+
  #ggtitle("Ion Concentration by Dose")+
   theme_classic(base_size=18)+
   #scale_fill_discrete(labels=c('SWP5','SWP7','SS7','PP7','RS5','fff'))+
  theme(text=element_text(family = "Times"),
           # aspect.ratio = 1,
        legend.position='bottom',
        axis.text.x=element_text(size=12),
        axis.text.y=element_text(size=12),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
   # theme(axis.title.y=element_text(color="darkolivegreen"))+
      scale_y_continuous(#expand = c(0,0), limits = c(0,3),
                         sec.axis = sec_axis(~.*coeff, name="pH"))+
  theme(axis.text.y.right = element_text(color = "chocolate3"))+
   theme(axis.text.y.left = element_text(color = "darkolivegreen"))+
      scale_color_manual(values=cbPalette_plus)
AK_5_Ion_Norm_plot_Act
```

## Subsetting

### Only including data for when percent standard deviation is less than 30%

and ommiting AK 15

```{r}
AK_5_All_Avg_sd_32perc<- AK_5_All_Avg_sd[(AK_5_All_Avg_sd$Q_NH4_sd_perc<=25)& (AK_5_All_Avg_sd$Ox!=15),]

AK_20_All_Avg_sd_32perc<- AK_20_All_Avg_sd[AK_20_All_Avg_sd$Q_NH4_sd_perc<=32,]
```

## Plotting Alk vs. Q

```{r}

AK_5_Plot<- ggplot(AK_5_All_Avg_sd_32perc,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AK Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
AK_5_Plot


```

```{r}

AK_20_Plot<- ggplot(AK_20_All_Avg_sd_32perc,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AK Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
AK_20_Plot


```

### Combining plots (for full dataset)

```{r}

#combining everything into a dataframe
AK_All_Avg_sd<-rbind(AK_5_All_Avg_sd,AK_20_All_Avg_sd)

#plotting

AK_Plot<- ggplot(AK_All_Avg_sd,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AK Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
AK_Plot


```

## Dose v. Q

```{r}
AK_Plot_Dose<- ggplot(AK_All_Avg_sd,aes(x=Dose,y=Q_NH4,color=factor(Ox, labels=c("0.20","0.23","0.25","0.27","0.28","0.30")),   na.rm=TRUE)) +
    guides(color = guide_legend(title = "Elemental O:C"))+
  geom_point(shape=16, size =4)+
     #geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g Biochar)")+
  ylab("Q (mmol TAN/g biochar)")+
  ggtitle("SWP5")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
          aspect.ratio = 1,
          legend.position=c(0.80, .65),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
   scale_color_manual(values=cbbPalette)

 AK_Plot_Dose
```

Plotting all data on individual plots to determine where to cut off data

```{r}

AK_Plot<- ggplot(AK_All_Avg_sd,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
   facet_wrap(facets = vars(Ox))+
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AK Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
AK_Plot
```

## Subsetting:

## Semi-arbitrarily removing the data that doesn't fit my idea of isotherms

```{r}

AK_All_Avg_sd_Think<-AK_All_Avg_sd[(AK_All_Avg_sd$ID>=5 &AK_All_Avg_sd$ID<=8)&((AK_All_Avg_sd$Ox==5))
             |
    (AK_All_Avg_sd$ID>=4 &AK_All_Avg_sd$ID<=8)&
    ((AK_All_Avg_sd$Ox==10)|(AK_All_Avg_sd$Ox==20)|(AK_All_Avg_sd$Ox==25)|(AK_All_Avg_sd$Ox==30)),]
View(AK_All_Avg_sd_Think)
```

## Dose v Q for subsetted data

```{r}
AK_Plot_Dose<- ggplot(AK_All_Avg_sd_Think,aes(x=Dose,y=Q_NH4,color=factor(Ox, labels=c("0.20","0.23","0.27","0.28","0.30")),   na.rm=TRUE))  +
    guides(color = guide_legend(title = "Elemental O:C"))+
  geom_point(shape=16, size =4)+
     #geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
 # geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Dose(g Biochar)")+
  ylab("Q (mmol TAN/g biochar)")+
  ggtitle("SWP5")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
          aspect.ratio = 1,
          legend.position=c(0.80, .65),
         legend.title=element_text(size=10), 
         legend.text=element_text(size=9),
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))+
   scale_color_manual(values=cbbPalette)

 AK_Plot_Dose
```

## Plotting Q for K

```{r}
AK_K_Plot<- ggplot(AK_All_Avg_sd,aes(x=Act_K,y=Q_K, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_K-Q_K_sd, ymax=Q_K+Q_K_sd))+
  geom_errorbarh(aes(xmin=Act_K-Act_K_sd, xmax=Act_K+Act_K_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol K/g biochar")+
  ggtitle("AM Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
AK_K_Plot
```

Plotting NH4 for region where isotherm expected to fit

```{r}
AK_Plot_Think<- ggplot(AK_All_Avg_sd_Think,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  #  facet_wrap(facets = vars(Ox))+
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AM Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) 
   scale_y_continuous(expand = c(2,2), limits = c(-3,20))
AK_Plot_Think
```

## Combining data and plots for \<32% Error

```{r}
#combining everything into a dataframe
AK_All_Avg_sd_32perc<-rbind(AK_5_All_Avg_sd_32perc,AK_20_All_Avg_sd_32perc)

#plotting

AK_Plot_32perc<- ggplot(AK_All_Avg_sd_32perc,aes(x=Act_NH4,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Act_NH4-Act_NH4_sd, xmax=Act_NH4+Act_NH4_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Activity (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AK Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) +
       scale_x_continuous(expand = c(0.0,0), limits = c(0,350))
      #  scale_y_continuous(expand = c(0,0), limits = c(-0.1,5))
AK_Plot_32perc
```

## Plotting Concentration vs. Q

```{r}

AK_Plot_32perc_Conc<- ggplot(AK_All_Avg_sd_32perc,aes(x=Ammonium,y=Q_NH4, color = Ox, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
     geom_errorbar(aes(ymin=Q_NH4-Q_NH4_sd, ymax=Q_NH4+Q_NH4_sd))+
  geom_errorbarh(aes(xmin=Ammonium-Ammonium_sd, xmax=Ammonium+Ammonium_sd))+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("Equilibrium Concentration (mmol)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("AK Sorption Isotherm")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1)) +
         scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_Plot_32perc_Conc
```

# Generating Isotherm

### Extracting Act and Q for each Ox condition of \<32% Q-sd subset

```{r}
Act_5_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==5,15])
Qe_5_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==5,39])

Act_10_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==10,15])
Qe_10_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==10,39])

Act_20_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==20,15])
Qe_20_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==20,39])

Act_25_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==25,15])
Qe_25_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==25,39])

Act_30_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==30,15])
Qe_30_NH4<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==30,39])

```

### Extracting Act and Q for each Ox condition of subset I think fits isotherm

```{r}
Act_5_NH4_Think<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==5,15])
Qe_5_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==5,39])

Act_10_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==10,15])
Qe_10_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==10,39])

Act_20_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==20,15])
Qe_20_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==20,39])

Act_25_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==25,15])
Qe_25_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==25,39])

Act_30_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==30,15])
Qe_30_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==30,39])

#Conc
Conc_5_NH4_Think<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==5,5])
Conc_10_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==10,5])

Conc_20_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==20,5])

Conc_25_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==25,5])

Conc_30_NH4_Think<<-c(0,AK_All_Avg_sd_Think[AK_All_Avg_sd_Think$Ox==30,5])
```

### Extracting Concentration and Q for each Ox condition of \<32% Q-sd subset

```{r}
Conc_5<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==5,5])

Conc_10<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==10,5])


Conc_20<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==20,5])


Conc_25<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==25,5])


Conc_30<-c(0,AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==30,5])

```

### Generating Isotherm: Freundlich w/ Activity

Need to do this to be able to generate the fit parameters

```{r}
Freundlich_5<-freundlichanalysis (Act_5_NH4, Qe_5_NH4)
Freundlich_5[[9]]$title<-"Freundlich Isotherm 5"

Freundlich_5_KF<-Freundlich_5$plot_env$pars_KF
Freundlich_5_n<-Freundlich_5$plot_env$pars_n
#Q_Freun_5<-Freundlich_5_KF*(Act_5^(1/Freundlich_5_n))
Q_Freun_5<-as.numeric(c(Freundlich_5$plot_env$rsqq$fitted.values))

Q_Freund_5_fun<-function (Act){
  (Freundlich_5_KF * (Act^(1/Freundlich_5_n)))
}

Freundlich_5
#----------------------------------------------------------------------
Freundlich_10<-freundlichanalysis (Act_10_NH4, Qe_10_NH4)
Freundlich_10[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_10_KF<-Freundlich_10$plot_env$pars_KF
Freundlich_10_n<-Freundlich_10$plot_env$pars_n
#Q_Freun_10<-Freundlich_10_KF*(Act_10^(1/Freundlich_10_n))
Q_Freun_10<-as.numeric(c(Freundlich_10$plot_env$rsqq$fitted.values))

Q_Freund_10_fun<-function (Act){
  (Freundlich_10_KF * (Act^(1/Freundlich_10_n)))
}

Freundlich_10
#-------------------------------------------------------------------------------
Freundlich_20<-freundlichanalysis (Act_20_NH4, Qe_20_NH4)
Freundlich_20[[9]]$title<-"Freundlich Isotherm 20"

Freundlich_20_KF<-Freundlich_20$plot_env$pars_KF
Freundlich_20_n<-Freundlich_20$plot_env$pars_n
#Q_Freun_20<-Freundlich_20_KF*(Act_20^(1/Freundlich_20_n))
Q_Freun_20<-as.numeric(c(Freundlich_20$plot_env$rsqq$fitted.values))

Q_Freund_20_fun<-function (Act){
  (Freundlich_20_KF * (Act^(1/Freundlich_20_n)))
}

Freundlich_20
#-------------------------------------------------------------------------------

Freundlich_25<-freundlichanalysis (Act_25_NH4, Qe_25_NH4)
Freundlich_25[[9]]$title<-"Freundlich Isotherm 25"
Freundlich_25_KF<-Freundlich_25$plot_env$pars_KF
Freundlich_25_n<-Freundlich_25$plot_env$pars_n
Q_Freun_25<-as.numeric(c(Freundlich_25$plot_env$rsqq$fitted.values))

Q_Freund_25_fun<-function (Act){
  (Freundlich_25_KF * (Act^(1/Freundlich_25_n)))
}
Freundlich_25

#-------------------------------------------------------------------------------

Freundlich_30<-freundlichanalysis (Act_30_NH4, Qe_30_NH4)
Freundlich_30[[9]]$title<-"Freundlich Isotherm 30"
Freundlich_30_KF<-Freundlich_30$plot_env$pars_KF
Freundlich_30_n<-Freundlich_30$plot_env$pars_n
FreundlQ_Freun_30<-as.numeric(c(Freundlich_30$plot_env$rsqq$fitted.values))

Q_Freund_30_fun<-function (Act){
  (Freundlich_30_KF * (Act^(1/Freundlich_30_n)))
}
Freundlich_30
```

### Generating Isotherm: Freundlich for region I expect to fit

```{r}
Freundlich_5_Think<-freundlichanalysis (Act_5_NH4_Think, Qe_5_NH4_Think)
Freundlich_5_Think[[9]]$title<-"Freundlich Isotherm 5"

Freundlich_5_KF_Think<-Freundlich_5_Think$plot_env$pars_KF
Freundlich_5_n_Think<-Freundlich_5_Think$plot_env$pars_n
#Q_Freun_5<-Freundlich_5_KF*(Act5_5_NH4^(1/Freundlich_5_n))
Q_Freun_5_Think<-as.numeric(c(Freundlich_5_Think$plot_env$rsqq$fitted.values))

Q_Freund_5_fun_Think<-function (Act){
  (Freundlich_5_KF_Think * (Act^(1/Freundlich_5_n_Think)))
}

Freundlich_5_Think
#----------------------------------------------------------------------
Freundlich_10_Think<-freundlichanalysis (Act_10_NH4_Think, Qe_10_NH4_Think)
Freundlich_10_Think[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_10_KF_Think<-Freundlich_10_Think$plot_env$pars_KF
Freundlich_10_n_Think<-Freundlich_10_Think$plot_env$pars_n
#Q_Freun_10<-Freundlich_10_KF*(Act5_10_NH4^(1/Freundlich_10_n))
Q_Freun_10_Think<-as.numeric(c(Freundlich_10_Think$plot_env$rsqq$fitted.values))

Q_Freund_10_fun_Think<-function (Act){
  (Freundlich_10_KF_Think * (Act^(1/Freundlich_10_n_Think)))
}

Freundlich_10_Think
#-------------------------------------------------------------------------------

Freundlich_20_Think<-freundlichanalysis (Act_20_NH4_Think, Qe_20_NH4_Think)
Freundlich_20_Think[[9]]$title<-"Freundlich Isotherm 20"

Freundlich_20_KF_Think<-Freundlich_20_Think$plot_env$pars_KF
Freundlich_20_n_Think<-Freundlich_20_Think$plot_env$pars_n
#Q_Freun_20<-Freundlich_20_KF*(Act_20_NH4^(1/Freundlich_20_n))
Q_Freun_20_Think<-as.numeric(c(Freundlich_20_Think$plot_env$rsqq$fitted.values))

Q_Freund_20_fun_Think<-function (Act){
  (Freundlich_20_KF_Think * (Act^(1/Freundlich_20_n_Think)))
}

Freundlich_20_Think


#-------------------------------------------------------------------------------

Freundlich_25_Think<-freundlichanalysis (Act_25_NH4_Think, Qe_25_NH4_Think)
Freundlich_25_Think[[9]]$title<-"Freundlich Isotherm 25"
Freundlich_25_KF_Think<-Freundlich_25_Think$plot_env$pars_KF
Freundlich_25_n_Think<-Freundlich_25_Think$plot_env$pars_n
Q_Freun_25_Think<-as.numeric(c(Freundlich_25_Think$plot_env$rsqq$fitted.values))

Q_Freund_25_fun_Think<-function (Act){
  (Freundlich_25_KF_Think * (Act^(1/Freundlich_25_n_Think)))
}
Freundlich_25_Think
#-------------------------------------------------------------------------------

Freundlich_30_Think<-freundlichanalysis (Act_30_NH4_Think, Qe_30_NH4_Think)
Freundlich_30_Think[[9]]$title<-"Freundlich Isotherm 30"
Freundlich_30_KF_Think<-Freundlich_30_Think$plot_env$pars_KF
Freundlich_30_n_Think<-Freundlich_30_Think$plot_env$pars_n
FreundlQ_Freun_30_Think<-as.numeric(c(Freundlich_30_Think$plot_env$rsqq$fitted.values))

Q_Freund_30_fun_Think<-function (Act){
  (Freundlich_30_KF_Think * (Act^(1/Freundlich_30_n_Think)))
}
Freundlich_30_Think

```

THINK: CONCENTRATION

```{r}
Freundlich_5_Think_Conc<-freundlichanalysis (Conc_5_NH4_Think, Qe_5_NH4_Think)
Freundlich_5_Think_Conc[[9]]$title<-"Freundlich Isotherm 5"

Freundlich_5_KF_Think_Conc<-Freundlich_5_Think_Conc$plot_env$pars_KF
Freundlich_5_n_Think_Conc<-Freundlich_5_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_5_KF*(Act5_5_NH4^(1/Freundlich_5_n))
Q_Freun_5_Think_Conc<-as.numeric(c(Freundlich_5_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_5_fun_Think_Conc<-function (Conc){
  (Freundlich_5_KF_Think_Conc * (Conc^(1/Freundlich_5_n_Think_Conc)))
}

Freundlich_5_Think_Conc
#----------------------------------------------------------------------
Freundlich_10_Think_Conc<-freundlichanalysis (Conc_10_NH4_Think, Qe_10_NH4_Think)
Freundlich_10_Think_Conc[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_10_KF_Think_Conc<-Freundlich_10_Think_Conc$plot_env$pars_KF
Freundlich_10_n_Think_Conc<-Freundlich_10_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_10_KF*(Act5_10_NH4^(1/Freundlich_10_n))
Q_Freun_10_Think_Conc<-as.numeric(c(Freundlich_10_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_10_fun_Think_Conc<-function (Conc){
  (Freundlich_10_KF_Think_Conc * (Conc^(1/Freundlich_10_n_Think_Conc)))
}

Freundlich_10_Think_Conc
#----------------------------------------------------------------------
#-------------------------------------------------------------------------------

Freundlich_20_Think_Conc<-freundlichanalysis (Conc_20_NH4_Think, Qe_20_NH4_Think)
Freundlich_20_Think_Conc[[9]]$title<-"Freundlich Isotherm 15"

Freundlich_20_KF_Think_Conc<-Freundlich_20_Think_Conc$plot_env$pars_KF
Freundlich_20_n_Think_Conc<-Freundlich_20_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_20_KF*(Act5_20_NH4^(1/Freundlich_20_n))
Q_Freun_20_Think_Conc<-as.numeric(c(Freundlich_20_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_20_fun_Think_Conc<-function (Conc){
  (Freundlich_20_KF_Think_Conc * (Conc^(1/Freundlich_20_n_Think_Conc)))
}

Freundlich_20_Think_Conc


#-------------------------------------------------------------------------------
Freundlich_25_Think_Conc<-freundlichanalysis (Conc_25_NH4_Think, Qe_25_NH4_Think)
Freundlich_25_Think_Conc[[9]]$title<-"Freundlich Isotherm 25"

Freundlich_25_KF_Think_Conc<-Freundlich_25_Think_Conc$plot_env$pars_KF
Freundlich_25_n_Think_Conc<-Freundlich_25_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_25_KF*(Act5_25_NH4^(1/Freundlich_25_n))
Q_Freun_25_Think_Conc<-as.numeric(c(Freundlich_25_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_25_fun_Think_Conc<-function (Conc){
  (Freundlich_25_KF_Think_Conc * (Conc^(1/Freundlich_25_n_Think_Conc)))
}

Freundlich_25_Think_Conc
#-------------------------------------------------------------------------------

Freundlich_30_Think_Conc<-freundlichanalysis (Conc_30_NH4_Think, Qe_30_NH4_Think)
Freundlich_30_Think_Conc[[9]]$title<-"Freundlich Isotherm 30"

Freundlich_30_KF_Think_Conc<-Freundlich_30_Think_Conc$plot_env$pars_KF
Freundlich_30_n_Think_Conc<-Freundlich_30_Think_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_30_KF*(Act5_30_NH4^(1/Freundlich_30_n))
Q_Freun_30_Think_Conc<-as.numeric(c(Freundlich_30_Think_Conc$plot_env$rsqq$fitted.values))

Q_Freund_30_fun_Think_Conc<-function (Conc){
  (Freundlich_30_KF_Think_Conc * (Conc^(1/Freundlich_30_n_Think_Conc)))
}

Freundlich_30_Think_Conc

```

## Trying different Isotherms

Defining Act and Qe without 0, DR Isotherm doesn't like 0

```{r}
Act_5_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==5,15])
Qe_5_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==5,39])

Act_10_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==10,15])
Qe_10_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==10,39])

Act_20_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==20,15])
Qe_20_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==20,39])

Act_25_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==25,15])
Qe_25_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==25,39])

Act_30_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==30,15])
Qe_30_NH4_DR<-c(AK_All_Avg_sd_32perc[AK_All_Avg_sd_32perc$Ox==30,39])

```

DR Isotherm

```{r}

DR_5<-dubininradushkevichanalysis(Act_5_NH4_DR, Qe_5_NH4_DR,298)
DR_5
DR_5_qmax<-DR_5$plot_env$pars_qs #qmax

DR_10<-dubininradushkevichanalysis(Act_10_NH4_DR, Qe_10_NH4_DR,298)
DR_10
DR_10_qmax<-DR_10$plot_env$pars_qs #qmax

DR_20<-dubininradushkevichanalysis(Act_20_NH4_DR, Qe_20_NH4_DR,298)
DR_20
DR_20_qmax<-DR_20$plot_env$pars_qs #qmax

DR_25<-dubininradushkevichanalysis(Act_25_NH4_DR, Qe_25_NH4_DR,298)
DR_25
DR_25_qmax<-DR_25$plot_env$pars_qs #qmax

DR_30<-dubininradushkevichanalysis(Act_30_NH4_DR, Qe_30_NH4_DR,298)
DR_30
DR_30_qmax<-DR_30$plot_env$pars_qs #qmax
```

### Generating Isotherm: Freundlich w/ Concentration

```{r}
Freundlich_5_Conc<-freundlichanalysis (Conc_5, Qe_5_NH4)
Freundlich_5_Conc[[9]]$title<-"Freundlich Isotherm 5"

Freundlich_5_KF_Conc<-Freundlich_5_Conc$plot_env$pars_KF
Freundlich_5_n_Conc<-Freundlich_5_Conc$plot_env$pars_n
#Q_Freun_5<-Freundlich_5_KF*(Conc_5^(1/Freundlich_5_n))
Q_Freun_5_Conc<-as.numeric(c(Freundlich_5_Conc$plot_env$rsqq$fitted.values))

Q_Freund_5_fun_Conc<-function (Ammonium){
  (Freundlich_5_KF_Conc * (Ammonium^(1/Freundlich_5_n_Conc)))
}

Freundlich_5_Conc
#----------------------------------------------------------------------
Freundlich_10_Conc<-freundlichanalysis (Conc_10, Qe_10_NH4)
Freundlich_10_Conc[[9]]$title<-"Freundlich Isotherm 10"

Freundlich_10_KF_Conc<-Freundlich_10_Conc$plot_env$pars_KF
Freundlich_10_n_Conc<-Freundlich_10_Conc$plot_env$pars_n
#Q_Freun_10<-Freundlich_10_KF*(Conc_10^(1/Freundlich_10_n))
Q_Freun_10_Conc<-as.numeric(c(Freundlich_10_Conc$plot_env$rsqq$fitted.values))

Q_Freund_10_fun_Conc<-function (Ammonium){
  (Freundlich_10_KF_Conc * (Ammonium^(1/Freundlich_10_n_Conc)))
}

Freundlich_10_Conc
#-------------------------------------------------------------------------------
Freundlich_20_Conc<-freundlichanalysis (Conc_20, Qe_20_NH4)
Freundlich_20_Conc[[9]]$title<-"Freundlich Isotherm 20"

Freundlich_20_KF_Conc<-Freundlich_20_Conc$plot_env$pars_KF
Freundlich_20_n_Conc<-Freundlich_20_Conc$plot_env$pars_n
#Q_Freun_20<-Freundlich_20_KF*(Conc_20^(1/Freundlich_20_n))
Q_Freun_20_Conc<-as.numeric(c(Freundlich_20_Conc$plot_env$rsqq$fitted.values))

Q_Freund_20_fun_Conc<-function (Ammonium){
  (Freundlich_20_KF_Conc * (Ammonium^(1/Freundlich_20_n_Conc)))
}

Freundlich_20_Conc
#-------------------------------------------------------------------------------

Freundlich_25_Conc<-freundlichanalysis (Conc_25, Qe_25_NH4)
Freundlich_25_Conc[[9]]$title<-"Freundlich Isotherm 25"
Freundlich_25_KF_Conc<-Freundlich_25_Conc$plot_env$pars_KF
Freundlich_25_n_Conc<-Freundlich_25_Conc$plot_env$pars_n
Q_Freun_25_Conc<-as.numeric(c(Freundlich_25_Conc$plot_env$rsqq$fitted.values))

Q_Freund_25_fun_Conc<-function (Ammonium){
  (Freundlich_25_KF_Conc * (Ammonium^(1/Freundlich_25_n_Conc)))
}
Freundlich_25_Conc

#-------------------------------------------------------------------------------

Freundlich_30_Conc<-freundlichanalysis (Conc_30, Qe_30_NH4)
Freundlich_30_Conc[[9]]$title<-"Freundlich Isotherm 30"
Freundlich_30_KF_Conc<-Freundlich_30_Conc$plot_env$pars_KF
Freundlich_30_n_Conc<-Freundlich_30_Conc$plot_env$pars_n
FreundlQ_Freun_30_Conc<-as.numeric(c(Freundlich_30_Conc$plot_env$rsqq$fitted.values))

Q_Freund_30_fun_Conc<-function (Ammonium){
  (Freundlich_30_KF_Conc * (Ammonium^(1/Freundlich_30_n_Conc)))
}
Freundlich_30_Conc
```

### Extracting Act and Q for each Ox condition of full dataset (old method)

```{r}
# 
# Act_5<-c(0,AK_All_Avg_sd[1:8,13])
# Qe_5<-c(0,AK_All_Avg_sd[1:8,17])
# 
# Act_10<-c(0,AK_All_Avg_sd[9:16,13])
# Qe_10<-c(0,AK_All_Avg_sd[9:16,17])
# 
# Act_15<-c(0,AK_All_Avg_sd[17:24,13])
# Qe_15<-c(0,AK_All_Avg_sd[17:24,17])
# 
# 
# Act_20<-c(0,AK_20_All_Avg_sd[1:8,13])
# Qe_20<-c(0,AK_20_All_Avg_sd[1:8,17])
# 
# Act_20_omit<-c(0,AK_20_All_Avg_sd[1:7,13])
# Qe_20_omit<-c(0,AK_20_All_Avg_sd[1:7,17])
# 
# Act_25<-c(0,AK_20_All_Avg_sd[9:16,13])
# Qe_25<-c(0,AK_20_All_Avg_sd[9:16,17])
# 
# Act_25_omit<-c(0,AK_20_All_Avg_sd[9:15,13])
# Qe_25_omit<-c(0,AK_20_All_Avg_sd[9:15,17])
# 
# Act_30<-c(0,AK_20_All_Avg_sd[17:24,13])
# Qe_30<-c(0,AK_20_All_Avg_sd[17:24,17])
# 
# Act_30_omit<-c(0,AK_20_All_Avg_sd[17:23,13])
# Qe_30_omit<-c(0,AK_20_All_Avg_sd[17:23,17])
# 
# 
# 
# #-------------------------------------------------------------------------------
# 
# Freundlich_5<-freundlichanalysis (Act_5, Qe_5)
# Freundlich_5[[9]]$title<-"Freundlich Isotherm 5"
# 
# Freundlich_5_KF<-Freundlich_5$plot_env$pars_KF
# Freundlich_5_n<-Freundlich_5$plot_env$pars_n
# #Q_Freun_5<-Freundlich_5_KF*(Act_5^(1/Freundlich_5_n))
# Q_Freun_5<-as.numeric(c(Freundlich_5$plot_env$rsqq$fitted.values))
# 
# Q_Freund_5_fun<-function (Act){
#   (Freundlich_5_KF * (Act^(1/Freundlich_5_n)))
# }
# 
# Freundlich_5
# #-------------------------------------------------------------------------------
# 
# Freundlich_10<-freundlichanalysis (Act_10, Qe_10)
# Freundlich_10[[9]]$title<-"Freundlich Isotherm 10"
# 
# Freundlich_10_KF<-Freundlich_10$plot_env$pars_KF
# Freundlich_10_n<-Freundlich_10$plot_env$pars_n
# #Q_Freun_10<-Freundlich_10_KF*(Act_10^(1/Freundlich_10_n))
# Q_Freun_10<-as.numeric(c(Freundlich_10$plot_env$rsqq$fitted.values))
# 
# Q_Freund_10_fun<-function (Act){
#   (Freundlich_10_KF * (Act^(1/Freundlich_10_n)))
# }
# 
# Freundlich_10
# #-------------------------------------------------------------------------------
# 
# Freundlich_15<-freundlichanalysis (Act_15, Qe_15)
# Freundlich_15[[9]]$title<-"Freundlich Isotherm 15"
# 
# Freundlich_15_KF<-Freundlich_15$plot_env$pars_KF
# Freundlich_15_n<-Freundlich_15$plot_env$pars_n
# #Q_Freun_15<-Freundlich_15_KF*(Act_15^(1/Freundlich_15_n))
# Q_Freun_15<-as.numeric(c(Freundlich_15$plot_env$rsqq$fitted.values))
# 
# Q_Freund_15_fun<-function (Act){
#   (Freundlich_15_KF * (Act^(1/Freundlich_15_n)))
# }
# 
# Freundlich_15
# #-------------------------------------------------------------------------------
# 
# Freundlich_20<-freundlichanalysis (Act_20, Qe_20)
# Freundlich_20[[9]]$title<-"Freundlich Isotherm 20"
# 
# Freundlich_20_KF<-Freundlich_20$plot_env$pars_KF
# Freundlich_20_n<-Freundlich_20$plot_env$pars_n
# #Q_Freun_20<-Freundlich_20_KF*(Act_20^(1/Freundlich_20_n))
# Q_Freun_20<-as.numeric(c(Freundlich_20$plot_env$rsqq$fitted.values))
# 
# Q_Freund_20_fun<-function (Act){
#   (Freundlich_20_KF * (Act^(1/Freundlich_20_n)))
# }
# 
# Freundlich_20
# #-------------------------------------------------------------------------------
# 
# Freundlich_25<-freundlichanalysis (Act_25, Qe_25)
# Freundlich_25
# Freundlich_25_KF<-Freundlich_25$plot_env$pars_KF
# Freundlich_25_n<-Freundlich_25$plot_env$pars_n
# Q_Freun_25<-as.numeric(c(Freundlich_25$plot_env$rsqq$fitted.values))
# 
# Q_Freund_25_fun<-function (Act){
#   (Freundlich_25_KF * (Act^(1/Freundlich_25_n)))
# }
# Freundlich_25
# 
# #-------------------------------------------------------------------------------
# 
# Freundlich_30<-freundlichanalysis (Act_30, Qe_30)
# Freundlich_30
# Freundlich_30_KF<-Freundlich_30$plot_env$pars_KF
# Freundlich_30_n<-Freundlich_30$plot_env$pars_n
# 
# Q_Freund_30_fun<-function (Act){
#   (Freundlich_30_KF * (Act^(1/Freundlich_30_n)))
# }
# Freundlich_30
# 
# ##Testing Omiting 
# Freundlich_20_omit<-freundlichanalysis (Act_20_omit, Qe_20_omit)
# Freundlich_20_omit
# 
# Freundlich_25_omit<-freundlichanalysis (Act_25_omit, Qe_25_omit)
# Freundlich_25_omit
# 
# Freundlich_30_omit<-freundlichanalysis (Act_30_omit, Qe_30_omit)
# Freundlich_30_omit
# 

### Langmuir

# 
# 
# Langmuir_20<- langmuiranalysis (Act_20, Qe_20)
# Langmuir_20
# 
# Langmuir_20_omit<- langmuiranalysis (Act_20_omit, Qe_20_omit)
# Langmuir_20_omit
# 
# Langmuir_25<- langmuiranalysis (Act_25, Qe_25)
# Langmuir_25
# 
# Langmuir_25_omit<- langmuiranalysis (Act_25_omit, Qe_25_omit)
# Langmuir_25_omit
# 
# Langmuir_30<- langmuiranalysis (Act_30, Qe_30)
# Langmuir_30
# 
# Langmuir_30_omit<- langmuiranalysis (Act_30_omit, Qe_30_omit)
# Langmuir_30_omit
```

# Adding Isotherm fit to Activity Plot

Adding Isotherm Fit to plot where I expect data to fit isotherm

```{r}
AK_All_Avg_sd_Think$Ox[1]

AK_Plot_Iso_Think<-AK_Plot_Think+
  geom_function(aes(color = factor(AK_All_Avg_sd_Think$Ox[1])),fun=Q_Freund_5_fun_Think)+
  geom_function(aes(color = factor(AK_All_Avg_sd_Think$Ox[5])),fun=Q_Freund_10_fun_Think)+
  geom_function(aes(color = factor(AK_All_Avg_sd_Think$Ox[11])),fun=Q_Freund_20_fun_Think)+
  geom_function(aes(color = factor(AK_All_Avg_sd_Think$Ox[16])),fun=Q_Freund_25_fun_Think)+
  geom_function(aes(color = factor(AK_All_Avg_sd_Think$Ox[21])),fun=Q_Freund_30_fun_Think)+
        scale_x_continuous(expand = c(0.0,0), limits = c(0,350))
  
AK_Plot_Iso_Think
```

```{r}
AK_20_All_Avg_sd$Ox[1]

AK_20_Plot_Iso<-AK_20_Plot+
  geom_function(aes(color = factor(AK_20_All_Avg_sd$Ox[1])),fun=Q_Freund_20_fun)+
  geom_function(aes(color = factor(AK_20_All_Avg_sd$Ox[9])),fun=Q_Freund_25_fun)+
  geom_function(aes(color = factor(AK_20_All_Avg_sd$Ox[17])),fun=Q_Freund_30_fun)
AK_20_Plot_Iso


```

```{r}
AK_All_Avg_sd_32perc$Ox[1]

AK_Plot_Iso<-AK_Plot_32perc+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[1])),fun=Q_Freund_5_fun)+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[7])),fun=Q_Freund_10_fun)+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[13])),fun=Q_Freund_20_fun)+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[19])),fun=Q_Freund_25_fun)+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[25])),fun=Q_Freund_30_fun)+
        scale_x_continuous(expand = c(0.0,0), limits = c(0,350))
  
AK_Plot_Iso




```

# Adding Isotherm fit to Concentration Plot

```{r}
AK_All_Avg_sd_32perc$Ox[1]

AK_Plot_Iso_Conc<-AK_Plot_32perc_Conc+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[1])),fun=Q_Freund_5_fun_Conc)+
  #geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[7])),fun=Q_Freund_10_fun_Conc)+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[13])),fun=Q_Freund_20_fun_Conc)+
  #geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[19])),fun=Q_Freund_25_fun_Conc)+
  geom_function(aes(color = factor(AK_All_Avg_sd_32perc$Ox[25])),fun=Q_Freund_30_fun_Conc)+
        scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
  
AK_Plot_Iso_Conc
```

##Calculating Q at a specific Concentration or Activity

```{r}

AK_Q_Conc_350<-data.frame(c(Q_Freund_5_fun_Conc(350),
                         Q_Freund_10_fun_Conc(350),
                         Q_Freund_20_fun_Conc(350),
                         Q_Freund_25_fun_Conc(350),
                         Q_Freund_30_fun_Conc(350)))

AK_Q_Act_230<-data.frame(c(Q_Freund_5_fun(230),
                         Q_Freund_10_fun(230),
                         Q_Freund_20_fun(230),
                         Q_Freund_25_fun(230),
                         Q_Freund_30_fun(230)))

#----------------------------------------------------------------------


AK_Q_Act_300_Think<-data.frame(c(Q_Freund_5_fun_Think(300),
                         Q_Freund_10_fun_Think(300),
                         Q_Freund_20_fun_Think(300),
                         Q_Freund_25_fun_Think(300),
                         Q_Freund_30_fun_Think(300)))

AK_Q_Conc_300_Think<-data.frame(c(Q_Freund_5_fun_Think_Conc(300),
                         Q_Freund_10_fun_Think_Conc(300),
                         Q_Freund_20_fun_Think_Conc(300),
                         Q_Freund_25_fun_Think_Conc(300),
                         Q_Freund_30_fun_Think_Conc(300)))

AK_Q_Conc_400_Think<-data.frame(c(Q_Freund_5_fun_Think_Conc(400),
                         Q_Freund_10_fun_Think_Conc(400),
                         Q_Freund_20_fun_Think_Conc(400),
                         Q_Freund_25_fun_Think_Conc(400),
                         Q_Freund_30_fun_Think_Conc(400)))



AK_O_C_EA<-data.frame(c(0.197,
0.234,
0.272,
0.283,
0.302))


0.197
0.234
0.245
0.272
0.283
0.302

AK_XPS_C<-c(80.93, 80.23, 79.41, 78.41, 76.10)
AK_XPS_O<-c(19.07,19.77, 20.59,21.59, 23.90 )
AK_XPS_O_C<-((AK_XPS_O/AK_XPS_C)*(12/16))


AK_XPS_O_C<-data.frame(AK_XPS_O_C)

AK_Name<-data.frame(as.factor(c("AK",
                  "AK",
                  "AK",
                  "AK",
                  "AK")))

AK_O_C_vs_Sorp_Dens<-data.frame(cbind(AK_Name,AK_O_C_EA,AK_XPS_O_C,AK_Q_Conc_350,AK_Q_Act_230,AK_Q_Act_300_Think,AK_Q_Conc_300_Think,AK_Q_Conc_400_Think))
    
colnames(AK_O_C_vs_Sorp_Dens)<-(c("ID","O_C_EA","O_C_XPS","Q_Conc_350","Q_Act_230","Q_Act_Think_300","Q_Conc_300_Think","Q_Conc_400_Think"))



```

Plotting O:C vs. Sorption Density for fit based on region where I think isotherm is applicable

```{r}
AK_O_C_EA_Plot_Act_Think<- ggplot(AK_O_C_vs_Sorp_Dens,aes(x=O_C_EA,y=Q_Act_Think_300, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (Elemental)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Activity of 300 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_O_C_EA_Plot_Act_Think
```

##Plotting O:C vs. Sorption Density

#For Q based on Activity

```{r}
AK_O_C_EA_Plot_Act<- ggplot(AK_O_C_vs_Sorp_Dens,aes(x=O_C_EA,y=Q_Act_230, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (Elemental)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_O_C_EA_Plot_Act
```

```{r}
AK_O_C_XPS_Plot_Act<- ggplot(AK_O_C_vs_Sorp_Dens,aes(x=O_C_XPS,y=Q_Act_230, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (XPS)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Activity of 230 mM")+
   theme_classic(base_size=18)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_O_C_XPS_Plot_Act
```

##Plotting O:C vs. Sorption Density

#For Q based on Concentration

```{r}
AK_O_C_Plot_Conc<- ggplot(AK_O_C_vs_Sorp_Dens,aes(x=O_C,y=Q_Conc_350, na.rm=TRUE)) +
  geom_point(shape=16, size =4)+
  # facet_wrap(~ Cation_Species, scales = "free")+ ###to separate into 3 plots
  xlab("O:C (Elemental)")+
  ylab("Q (mmol NH4/g biochar")+
  ggtitle("O:C vs. Sorption Density at Concentration of 350 mM")+
   theme_classic(base_size=12)+
  theme(text=element_text(family = "Times"),
        legend.position='bottom',
        axis.text.x=element_text(size=16),
        axis.text.y=element_text(size=16),
        axis.title.x = element_text(margin = margin(t=20), size=16),
        axis.title.y = element_text(margin = margin(r=20), size=16),
        panel.border = element_rect(color="black",
                                    fill = NA,
                                    size = 1))
         #scale_x_continuous(expand = c(0.0,0), limits = c(0,550))
AK_O_C_Plot_Conc
```

#10/24/22 END - I need to decide what value to use (350mM for concentration currently and 225mM for activity) = Need to find a way to relate the two so it's not just an arbitrary number

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
